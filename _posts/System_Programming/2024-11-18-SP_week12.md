---
layout: post
title: "[시스템 프로그래밍] 12주차 - The Memory Hierarchy"
excerpt: ""  

tags:
  - [시스템 프로그래밍]

toc: true

date: 2024-11-18
last_modified_at: 2024-11-18
---
## Storage Technologies and Trends
### 1. Random-Access Memory (RAM)
- 주요 특징
  - RAM은 chip으로 패키징 되어있다.  
  - Basic storage unit은 일반적으로 **cell**이다. (one bit per cell)
  - 여러 개의 RAM chip들이 모여 memory를 구성한다.  

  <br>

- RAM은 두 종류로 나뉜다.  
  - SRAM (Static RAM)
  - DRAM (Dynamic RAM)  
  ![sram_vs_dram][def]  

  <br>

- Nonvolatile Memories
  - DRAM과 SRAM은 volatile memory 이다.  
    - 전원이 꺼지면 정보를 잃는다.  

  - Nonvolatile memories는 전원이 꺼지더라도 값을 유지한다.  
    - Read-only memory (ROM)
    - Programmable ROM (PROM)
    - Erasable PROM (EPROM)
    - Electrically EPROM (EEPROM)
    - Flash memory

  - Noonvolatile memories의 사용처
    - ROM에 저장되어 있는 Firmware programs (BIOS, controllers for disks, network cards, etc.)  
    - SSD(Solid State Disk)
    - Disk caches  

    <br>

### 2. Memory Read Transactions `movq A, %rax`  
- Bus는 주소, 데이터, 제어 신호를 전달하는 병령 통로 집합이다.  
- Buses들은 주로 여러 devices들 간에 공유된다.  
![bus_structure][def2]  

<br>  

- CPU는 주소 `A`를 메모리 Bus에 올려둔다.  
![memory_read1][def3]  

- Main Memory는 메모리 Bus로부터 주소 `A`를 읽고,  
주소로부터 word `x`를 회수해서,  
다시 Bus에 올려둔다.  
![memory_read2][def4]  

- CPU는 Bus로부터 word `x`를 읽어들인다.  
그리고 register `%rax`에 복사한다.  
![memory_read3][def5]  

<br>

### 3. Memory Write Transactions `movq %rax, A`
- CPU는 주소 `A`를 Bus에 올려둔다.  
Main Memory는 그것을 읽어서, 이에 해당하는 도착할 word 데이터를 기다린다.  
![memory_write1][def6]  

- CPU는 word `y`를 Bus에 올려둔다.  
![memory_write2][def7]  

- Main Memory는 Bus로부터 word `y`를 읽어들이고,  
주소 `A`에 해당 word를 저장한다.  
![memory_write3][def8]  

<br>

### 4. Disk Drive
- Inside a Disk Drive  
![disk_drive][def9]  

<br>

- Disk Geometry
  - Disk는 **platters**로 구성되어 있고,  
  각 platter는 두 개의 surfaces를 가진다.  
  - 각 surface는 **tracks**라고 불리는 concentric rings로 구성되어 있다.  
  - 각 track는 **sectors**로 구성되어 있고, 이들은 **gaps**로 구분된다.  
  ![disk_geometry][def10]  
    - Multiple-Platter View  
    ![disk_geometry2][def11]  

<br>

- Computing Disk Capacity  
  - Capacity = (# bytes/sector) x (avg. # sectors/track) x (# tracks/surface) x (# surfaces/platter) x (# platters/disk)

  <br>


- Disk Operation(Single-Platter View)  
![disk_operation][def12]  
- Disk Operation(Multiple-Platter View)  
![disk_operation2][def13]  

<br>

-  Disk Structure(top view of single platter)  
![disk_structure][def14]  
  - Surface는 tracks로 구성되고, Tracks는 sectors로 나뉨.  

<br>

- Disk Access
  - (1) Head가 track의 위에 위치  
  ![disk_access1][def15]  

  - (2) 회전 방향은 반시계 방향  
  ![disk_access2][def16]  

  - (3) blue sector를 읽으려 함  
  ![disk_access3][def17]  

  - (4) blue sector를 읽은 후  
  ![disk_access4][def18]  

  - (5) red는 다음으로 읽어야 할 sector  
  ![disk_access5][def19]  

  - (6) red track을 찾으려함  
  ![disk_access6][def20]  
  
  - (7) 회전하여 red sector를 기다림  
  ![disk_access7][def21]  

  - (8) red 읽기 완료  
  ![disk_access8][def22]  

- Service Time Components  
![service_time][def23]  
  - Data transfer
  - Seek
  - Rotational latency  
  - Data transfer  

  <br>

- Disk Access Time
  - target sector를 access하는데 걸리는 평균 시간의 추정치  
    - `Taccess` = `Tavg seek` + `Tavg rotation` + `Tavg transfer`
  - Seek time (Tavg seek)
    - head가 target track으로 이동하는데 걸리는 시간  
  - Rotational latency (Tavg rotation)
    - target sector가 head에 도달하는데 걸리는 시간  
    - `Tavg rotation` = `1/2` x `1/RPMs` x `60 sec/1 min`  
    - Typical Tavg rotation = 7200 RPMs
  - Transfer time (Tavg transfer)
    - target sector에서 bits를 읽어오는데 걸리는 시간
    - `Tavg transfer` = `1/RPM` x `1/(avg # sectors/track)` x `60 sec/1 min`  

<br>

- Logical Disk Blocks  
  - 현대 Disk들은 복잡한 sector geometry를 단순화하여 Logical Disk Blocks의 연속으로 모델링한다.  
  - Logical Blocks들과 실제 Sector들 사이의 매핑은 Disk controller에 의해 수행된다.  
    - Disk controller는 Logical Block을 {surface, track, sector}로 변환한다.  
  - Disk controller는 각 영역에 대하여 **spare cylinders**를 둔다. (bad sectors 대비)  
    - 최대 용량과 포맷된 용량에 차이가 발생하는 이유 !

  <br>

### 5. Reading a Disk Sector
- I/O Bus  
![io_bus][def24]  

<br>

- CPU는 명령어, logical block number, 그리고 Disk controller와 관련된 port에 대한 목적지 주소를 작성함으로서, disk read를 시작한다.  
![disk_read1][def25]  

- Disk controller는 sector를 읽고, Main memory로 DMA(Direct Memory Access) transfer를 수행한다.  
![disk_read2][def26]  

- DMA transfer가 완료되면, Disk controller는 CPU에게 interrupt를 보낸다.  
![disk_read3][def27]  

<br>

### 6. Solid State Disks (SSDs)  
![ssd][def28]  
- Pages: 512KB ~ 4KB, Blocks: 32 ~ 128 pages  
- Data는 page 단위로 읽고 쓰기가 가능하다.
- Page는 속해있는 block이 지워진 후에야 쓰기가 가능하다. (overwrite 불가능)  
- 하나의 Block은 약 100000번 지우고 나면 wear-out !  

<br>

- SSD Performance Characteristics
  - Sequential read tput : 550 MB/s
  - Sequential write tput : 470 MB/s
  - Random read tput : 365 MB/s
  - Random write tput : 303 MB/s
  - Avg seq read time : 50 us
  - Avg seq write time : 60 us

- Sequential access는 Random access보다 빠르다.  
  - Sequential access : 데이터가 하나의 Block에 연속적으로 저장되어 있을 때  
  - Random access : 데이터가 여러 Block에 흩뿌져려 있을 때  

- Random writes는 다소 느릴 수도 있다.  
  - block을 지우는 것은 시간이 오래걸린다. (~1ms)
  - block page를 수정하는 것은 다른 모든 pages들이 새로운 block에 복사되도록 해야한다.  
  - 예전 SSDs들은, read/write gap이 훨씬 컸다.  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">  

이 포스팅은 강원대학교 송원준 교수님의 시스템 프로그래밍 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.  

</div>
</details>

[def]: https://i.imgur.com/xIE4AeY.png
[def2]: https://i.imgur.com/6KbdJAy.png
[def3]: https://i.imgur.com/DYg0LXh.png
[def4]: https://i.imgur.com/MeygVdu.png
[def5]: https://i.imgur.com/xNL4mgB.png
[def6]: https://i.imgur.com/2SR5ufh.png
[def7]: https://i.imgur.com/rLVn7JU.png
[def8]: https://i.imgur.com/ObH7Iqr.png
[def9]: https://i.imgur.com/ma9ycgR.png
[def10]: https://i.imgur.com/27kFa32.png
[def11]: https://i.imgur.com/g2Bslhe.png
[def12]: https://i.imgur.com/RzY3PnE.png
[def13]: https://i.imgur.com/CHZBtCZ.png
[def14]: https://i.imgur.com/0APatkw.png
[def15]: https://i.imgur.com/I3rbpXS.png
[def16]: https://i.imgur.com/vp8T3F1.png
[def17]: https://i.imgur.com/usqh12G.png
[def18]: https://i.imgur.com/fbjABWs.png
[def19]: https://i.imgur.com/rsaaX9Z.png
[def20]: https://i.imgur.com/Exb14Er.png
[def21]: https://i.imgur.com/qcZq26P.png
[def22]: https://i.imgur.com/X2nWovK.png
[def23]: https://i.imgur.com/Xz11D3E.png
[def24]: https://i.imgur.com/w6DePps.png
[def25]: https://i.imgur.com/kJ8fx46.png
[def26]: https://i.imgur.com/DdpKSVW.png
[def27]: https://i.imgur.com/dOfnep8.png
[def28]: https://i.imgur.com/41sjIIs.png