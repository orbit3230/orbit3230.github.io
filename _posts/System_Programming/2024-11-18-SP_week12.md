---
layout: post
title: "[시스템 프로그래밍] 12주차 - The Memory Hierarchy"
excerpt: ""  

tags:
  - [시스템 프로그래밍]

toc: true

date: 2024-11-18
last_modified_at: 2024-11-18
---
## Storage Technologies and Trends
### 1. Random-Access Memory (RAM)
- 주요 특징
  - RAM은 chip으로 패키징 되어있다.  
  - Basic storage unit은 일반적으로 **cell**이다. (one bit per cell)
  - 여러 개의 RAM chip들이 모여 memory를 구성한다.  

  <br>

- RAM은 두 종류로 나뉜다.  
  - SRAM (Static RAM)
  - DRAM (Dynamic RAM)  
  ![sram_vs_dram][def]  

  <br>

- Nonvolatile Memories
  - DRAM과 SRAM은 volatile memory 이다.  
    - 전원이 꺼지면 정보를 잃는다.  

  - Nonvolatile memories는 전원이 꺼지더라도 값을 유지한다.  
    - Read-only memory (ROM)
    - Programmable ROM (PROM)
    - Erasable PROM (EPROM)
    - Electrically EPROM (EEPROM)
    - Flash memory

  - Noonvolatile memories의 사용처
    - ROM에 저장되어 있는 Firmware programs (BIOS, controllers for disks, network cards, etc.)  
    - SSD(Solid State Disk)
    - Disk caches  

    <br>

### 2. Memory Read Transactions  
- Bus는 주소, 데이터, 제어 신호를 전달하는 병령 통로 집합이다.  
- Buses들은 주로 여러 devices들 간에 공유된다.  
![bus_structure](TODO)  

<br>  

- CPU는 주소 `A`를 메모리 Bus에 올려둔다.  
![memory_read1](TODO)  

- Main Memory는 메모리 Bus로부터 주소 `A`를 읽고,  
주소로부터 word `x`를 회수해서,  
다시 Bus에 올려둔다.  
![memory_read2](TODO)  

- CPU는 Bus로부터 word `x`를 읽어들인다.  
그리고 register `%rax`에 복사한다.  
![memory_read3](TODO)  

<br>

### 3. Memory Write Transactions
- CPU는 주소 `A`를 Bus에 올려둔다.  
Main Memory는 그것을 읽어서, 이에 해당하는 도착할 word 데이터를 기다린다.  
![memory_write1](TODO)  

- CPU는 word `y`를 Bus에 올려둔다.  
![memory_write2](TODO)  

- Main Memory는 Bus로부터 word `y`를 읽어들이고,  
주소 `A`에 해당 word를 저장한다.  
![memory_write3](TODO)  

<br>

### 4. Disk Drive
- Inside a Disk Drive  
![disk_drive](TODO)  

<br>

- Disk Geometry
  - Disk는 **platters**로 구성되어 있고,  
  각 palatter는 두 개의 surfaces를 가진다.  
  - 각 surface는 **tracks**라ㅏ고 불리는 concentric rings로 구성되어 있다.  
  - 각 track는 **sectors**로 구성되어 있고, 이들은 **gaps**로 구분된다.  
  ![disk_geometry](TODO)  
    - Multiple-Platter View  
    ![disk_geometry2](TODO)  

<br>

- Computing Disk Capacity  
TODO

- Disk Operation(Single-Platter View)  
![disk_operation](TODO)  
- Disk Operation(Multiple-Platter View)  
![disk_operation2](TODO)  

<br>

-  Disk Structure(top view of single platter)  
![disk_structure](TODO)  
  - Surface는 tracks로 구성되고, Tracks는 sectors로 나뉨.  

<br>

- Disk Access
  - (1) Head가 track의 위에 위치  
  ![disk_access1](TODO)  

  - (2) 회전 방향은 반시계 방향  
  ![disk_access2](TODO)  

  - (3) blue sector를 읽으려 함  
  ![disk_access3](TODO)  

  - (4) blue sector를 읽은 후  
  ![disk_access4](TODO)  

  - (5) red는 다음으로 읽어야 할 sector  
  ![disk_access5](TODO)  

  - (6) red track을 찾으려함  
  ![disk_access6](TODO)  
  
  - (7) 회전하여 red sector를 기다림  
  ![disk_access7](TODO)  

  - (8) red 읽기 완료  
  ![disk_access8](TODO)  

- Service Time Components  
![service_time](TODO)  
  - Data transfer
  - Seek
  - Rotational latency  
  - Data transfer  

  <br>

- Disk Access Time
  - target sector를 access하는데 걸리는 평균 시간의 추정치  
    - `Taccess` = `Tavg seek` + `Tavg rotation` + `Tavg transfer`
  - Seek time (Tave seek)
    - head가 target track으로 이동하는데 걸리는 시간  
  - Rotational latency (Tavg rotation)
    - target sector가 head에 도달하는데 걸리는 시간  
    - `Tavg rotation` = `1/2` x `1/RPMs` x `60 sec/1 min`  
    - Typical Tavg rotation = 7200 RPMs
  - Transfer time (Tavg transfer)
    - target sector에서 bits를 읽어오는데 걸리는 시간
    - `Tavg transfer` = `1/RPM` x `1/(avg # sectors/track)` x `60 sec/1 min`  

<br>

- Logical Disk Blocks  
  - TODO  

  <br>

### 5. Reading a Disk Sector
- I/O Bus  
![io_bus](TODO)  

<br>

- CPU는 명령어, logical block number, 그리고 Disk controller와 관련된 port에 대한 목적지 주소를 작성함으로서, disk read를 시작한다.  
![disk_read1](TODO)  

- Disk controller는 sector를 읽고, Main memory로 DMA(Direct Memory Access) transfer를 수행한다.  
![disk_read2](TODO)  

- DMA transfer가 완료되면, Disk controller는 CPU에게 interrupt를 보낸다.  
![disk_read3](TODO)  

<br>

### 6. Solid State Disks (SSDs)  
![ssd](TODO)  
- Pages: 512KB ~ 4KB, Blocks: 32 ~ 128 pages  
- Data는 page 단위로 읽고 쓰기가 가능하다.
- Page는 속해있는 block이 지워진 후에야 쓰기가 가능하다. (overwrite 불가능)  
- 하나의 Block은 약 100000번 지우고 나면 wear-out !  

<br>

- SSD Performance Characteristics
  - Sequential read tput : 550 MB/s
  - Sequential write tput : 470 MB/s
  - Random read tput : 365 MB/s
  - Random write tput : 303 MB/s
  - Avg seq read time : 50 us
  - Avg seq write time : 60 us

- Sequential access는 Random access보다 빠르다.  
  - Sequential access : 데이터가 하나의 Block에 연속적으로 저장되어 있을 때  
  - Random access : 데이터가 여러 Block에 흩뿌져려 있을 때  

- Random writes는 다소 느릴 수도 있다.  
  - block을 지우는 것은 시간이 오래걸린다. (~1ms)
  - block page를 수정하는 것은 다른 모든 pages들이 새로운 block에 복사되도록 해야한다.  
  - 예전 SSDs들은, read/write gap이 훨씬 컸다.  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">  

이 포스팅은 강원대학교 송원준 교수님의 시스템 프로그래밍 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.  

</div>
</details>

[def]: https://i.imgur.com/xIE4AeY.png