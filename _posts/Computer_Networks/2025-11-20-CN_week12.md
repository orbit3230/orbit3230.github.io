---
layout: post
title: "[컴퓨터네트워크] 12주차 - LANs"
excerpt: "Addressing, Address Resolution Protocol (ARP), Ethernet, Switches, VLANs"

tags:
  - [컴퓨터네트워크]

toc: true

date: 2025-11-20
last_modified_at: 2025-11-27
---
## LANs
### 1. Addressing, Address Resolution Protocol (ARP)  
- MAC address
  - 32-bit IP address (128-bit address in IPv6)
    - 각 인터페이스에 할당된 네트워크 계층 주소
    - Layer 3 forwarding에 사용됨
    - e.g., `143.70.234.100`
  
  - 48-bit MAC address (a.k.a. LAN or physical or Ethernet address)
    - 한 인터페이스에서 다른 인터페이스에 physically 연결되어, 프레임을 가져오기 위해 "locally" 사용되는 주소
    - NIC ROM에 박혀져서 나온다. (종종 software settable)
    - e.g., `1A-2F-BB-76-09-AD`  

<br>

- MAC address  
![mac_address][def]  
  - LAN의 각 인터페이스는
    - Unique 48-bit MAC address를 가짐
    - locally unique 32-bit IP address를 가짐

  - MAC address는 IEEE에 의해 관리되고 할당됨
  - Manufacturer는 MAC 주소 공간의 일부를 구매한다.
  - MAC address는 flat 하다.
    - Portability에 유리
    - 한 LAN에서 다른 LAN으로 이동 가능
    - 이에 반해, IP address는 portable하지 않다. 노드가 속한 IP subnet에 종속적이다.  

<br>

- Why do we need MAC address ?
  - 이론적으로, 네트워크는 IP address만으로도 동작할 수 있다.  
  - 하지만 실제로는...
    - 우리는 각 노드에 unique한 IP 주소를 제공하는 접근법을 가지고 있지 않다.
      - 누군가 수동적으로 자신의 기기에 IP 주소를 할당할 수도 있다.
      - 이렇게 되면 두 명 이상의 사람이 동시에 메시지를 받게 될 수 있다.
    - 기존 아키텍쳐때문에, MAC이 필요하다.
      - 만약 MAC 주소가 사용되지 않는다면, L2 계층은 수신한 어떠한 data frame이든 network layer로 곧바로 흘려보낼 것이다.  

    <br>

- Address Resolution Protocol (ARP)  
  - Question - 우리는 일반적으로 목적지 IP 주소와 함께 메시지를 보낸다. (DNS가 주는 IP 주소)  
  그러면, MAC 주소는 어떻게 메시지에 포함되고 메시지 전달에 사용되는가?  
    - Answer - IP 주소와 MAC 주소 간의 Address translation  
  ![arp_example][def2]  
    - ARP Table
      - LAN의 각 IP 노드(호스트, 라우터)는 table을 가짐
      - 몇몇 LAN 노드에 대한 IP/MAC 주소 매핑  
      `<IP address, MAC address, TTL>`  
      - TTL(Time-To-Live) 타이머가 지난 주소 매핑은 버려짐 (일반적으로 20분 정도)

- ARP protocol in action
  - e.g., `A`는 `B`에게 datagram을 보내길 원함  
    - `B`의 MAC 주소가 `A`의 ARP table에 없어서, `A`가 ARP 프로토콜을 사용하여 `B`의 MAC 주소를 찾으려 하는 상황  
  ![arp_process_1][def3]  
  ![arp_process_2][def4]  
  ![arp_process_3][def5]  

  - Routing to another subnet
    - e.g., `A`는 `B`에게 datagram을 보내길 원함. 이 때, `R`이라는 라우터가 `A`와 `B` 사이에 있음  
      - IP & MAC 계층에서의 addressing에 초점
      - 가정하길,
        - `A`는 `B`의 IP 주소를 알고 있음
        - `A`는 first hot 라우터 `R`의 IP 주소를 알고 있음 (how?)  
        - 따라서 `A`는 `R`의 MAC 주소도 알 수 있음 (how?)  
      ![arp_routing_process_1][def6]  
    
    - `A`는 source IP = `A`, destination IP = `B`인 datagram을 생성함  
    - `A`는 `A`-to-`B` datagram을 포함한 link-layer frame을 생성함
      - `R`의 MAC address가 frame의 destination MAC address가 됨  
    ![arp_routing_process_2][def7]  

    - frame이 `A`에서 `R`로 전송됨
    - frame이 `R`에 도달하면, datagram은 폐기되고 IP 계층으로 전달됨  
    ![arp_routing_process_3][def8]  

    - `R`은 outgoing 인터페이스를 결정하고, source IP = `A`, destination IP = `B`인 datagram를 link layer로 전달  
    ![arp_routing_process_4][def9]  

    - `R`은 `A`-to-`B` datagram을 포함한 link-layer frame을 생성함  
    - frame의 destination MAC address는 `B`의 MAC address가 될 것임  
    ![arp_routing_process_5][def10]  

    - `B`가 frame을 수신하면, `B`를 목적지로 한 IP datagram을 추출함
    - `B`는 IP 프로토콜 스택을 따라 datagram을 올려보냄  
    ![arp_routing_process_6][def11]  

<br>

### 2. Ethernet
- Dominant wired LAN technology
  - 처음으로 널리 사용된 LAN 테크놀로지
  - 간단하고, 저렴하다.
  - Speed race를 계속 중 (10Mbps -> 400Gbps...)
  - Single chip, Multiple speeds (e.g., Broadcom BCM 5761)

<br>

- Physical Topology of Ethernet  
  - Bus  
  ![ethernet_bus_topology][def12]
    - 90년대 중반까지 popular
    - 모든 노드가 같은 collision domain에 속함 (서로 충돌 가능)

  - Switched  
  ![ethernet_switched_topology][def13]  
    - 오늘날 만연히 사용됨
    - 중앙에 link-layer(L2) 스위치를 활성화
    - 각 "spoke(연결된 노드)"는 별도의 Ethernet 프로토콜을 실행 (노드들은 서로 충돌하지 않음)  

<br>

- Ethernet frame structure
  - IP datagram을 캡슐화하는 인터페이스를 전송  
  ![ethernet_frame_structure][def14]  

<br>

- Ethernet: Unreliable, Connectionless
  - Connectionless : 송신 & 수신 NIC 간 handshake 없음
  - Unreliable : 수신 NIC는 송신 NIC에 ACKs나 NAKs를 보내지 않음
    - 드랍된 프레임의 데이터는 오직 최초 송신자가 상위 계층에서 RDT(e.g., TCP)를 사용할 때만 복구됨
    - 그렂히않으면, 드랍된 데이터는 소실됨
  - Ethernet의 MAC 프로토콜 : unspotted CSMA/CD with binary backoff

<br>

- IEEE 802.3 Ethernet standards: link & physical layers  
![ieee_802_3_standards][def15]  
  - 서로다른 Ethernet 표준이 많이 존재
    - MAC 프로토콜과 frame 포맷은 동일
    - 서로 다른 속도 : 2Mbps, 10Mbps, 100Mbps, 1Gbps, 10Gbps, 40Gbps, ...
    - 서로 다른 physical layer media : fiber, cable, ...

<br>

### 3. Switches
- Ethernet 스위치
  - active role을 수행하는 link-layer 디바이스
  - Ethernet frames를 저장하고, 포워딩
  - 들어오는 프레임의 MAC address를 확인하고, 하나 이상의 outgoing 링크로 selectively 포워딩
  - 프레임이 세그먼트로 포워딩 될 때, CSMA/CD가 세그먼트에 접근하는데 사용됨
  - **Transparent** : 호스트는 스위치의 존재를 모름
  - **Plug-and-Play**, **self-learning** : 스위치는 특별한 설정 없이도 동작함  

- 여기서 Store-and-forward vs. cut-through
  - Store-and-forward  
  ![store_and_forward_switch][def16]  
    - 포워딩 결정이 이루어지려면, 전체 프레임이 수신되어야 함
    - 장점 : CRC 오류 검출 가능
  - Cut-through  
  ![cut_through_switch][def17]  
    - 프레임의 Destination MAC address를 얻으면 가능한 빨리 포워딩 결정이 이루어짐  
    - 장점 : 낮은 지연 시간 (Real-time 애플리케이션에 유리)  

<br>

- Switch: multiple simultaneous transmissions  
![switch_multiple_simultaneous_transmissions][def18]  
  - 호스트는 스위치에 dedicated(direct) 연결을 가짐
  - 스위치는 패킷을 buffer함
  - 각각의 들어오는 링크에 Ethernet 프로토콜이 실행됨
    - No collision; full-duplex
    - 각 링크는 독립적인 collision domain
  - Switching
    - `A`-to-`A'`와 `B`-to-`B'` 전송이 충돌 없이 동시에 일어날 수 있음  
    - 다만 `A`-to-`A'`와 `C`-to-`A'` 는 동시에 일어날 수 없다 !

  <br>

- Switch forwarding table  
![switch_forwarding_table][def19]  
  - 스위치는 `A'`가 인터페이스 `4`를 통해 reachable하고, `B'`는 인터페이스 `5`를 통해 reachable하다는 것을 어떻게 알 수 있나?  
    - 각 스위치는 switch table을 가진다. 각 엔트리는,
      - (호스트의 MAC address, 호스트에 도달하기 위한 인터페이스, 타임스탬프) 로 구성
      - 마치 routing table과 유사
  - 어떻게 엔트리들이 생성되고 스위치 테이블 내에서 유지될까?  
    - routing table과 같은 방식일까?

- Switch: self-learning  
![switch_self_learning][def20]  
  - 스위치는 어느 호스트가 어느 인터페이스를 통해 도달 가능한지 "학습한다."
    - 프레임이 수신되면, 스위치는 sender의 위치를 "학습한다.": incoming LAN segment
    - 이는 스위치 테이블에 sender/location 쌍으로 기록된다.  

- Switch: frame filtering/forwarding  
![switch_frame_filtering_forwarding][def21]
  - 프레임이 스위치에서 수신되면,
    - 들어오는 링크와 sending 호스트의 MAC address를 기록한다.
    - MAC destination address를 사용하여 스위치 테이블을 lookup 한다.
      - 만약 destination에 대한 엔트리가 발견되면
        - 만약 도착한 프레임의 segment의 destination이 같은 segment라면, 프레임을 폐기한다. (필터링)
        - 그렇지 않으면, 프레임을 엔트리에 표시된 인터페이스로 포워딩한다.
      - 만약 destination에 대한 엔트리가 발견되지 않으면, 프레임을 모든 인터페이스로 브로드캐스트한다. (except the incoming link)  

  - example 1  
  ![switch_example_1][def22]  

  - example 2  
  ![switch_example_2][def23]  

<br>

- Interconnecting switches
  - Self-learning 스위치들은 서로 연결될 수 있다.  
  ![interconnecting_switches][def24]  
    - `A`->`G`로 전송 - `S1`은 `S4`와 `S3`를 통해 `G`로 프레임을 포워딩할 수 있음을 어떻게 아는가?  
    -> self-learning !  

    - example  
    ![interconnecting_switches_example][def25]  

<br>

- Small institutional network  
![small_institutional_network][def26]  

<br>

- Switches vs. Routers  
![switches_vs_routers][def27]  
  - 둘 다 store-and-forward.
    - 라우터 : 네트워크 계층 디바이스. (네트워크 계층 헤더를 검사)
    - 스위치 : 링크 계층 디바이스. (링크 계층 헤더를 검사)
  
  - 둘 다 forwarding table을 가짐.
    - 라우터 : 라우팅 알고리즘과 IP 주소를 사용하여 테이블 계산
    - 스위치 : flooding, self-learning, MAC 주소를 사용하여 포워딩 테이블 학습

<br>

### 4. VLANs  
- Virtual LANs(VLANs): motivation
  - **Single broadcast domain**  
  ![broadcast_domain][def28]  
    - Scaling : 모든 layer-2 브로드캐스트 트래픽이 반드시 전체 LAN을 cross
    - 효율성, 보안, 프라이버시 이슈
  
  - **Administrative issues**  
  ![administrative_issues][def29]  
    - 만약 `CS`부서의 사용자가 `EE`부서로 이동했다면 - 물리적으로는 `EE` 스위치에 연결되어 있지만, 여전히 logically `CS` 스위치에 연결되어 있길 원할 수 있음

  <br>

- Port-based VLANs  
![port_based_vlans][def30]  
  - 스위치 포트는 switch management software에 의해 그룹화됨  
  -> 각 그룹은 각 virtual LAN에 대응됨  

  - **Virtual Local Area Network (VLAN)**  
  ![vlan_example][def31]  
    - VLAN을 지원하는 스위치는 하나의 물리적 LAN 인프라 위에 여러 virtual LANs를 정의하여 설정할 수 있음.  

  - **Traffic isolation**
    - 포트 `1` ~ `8`로 오고 가는 프레임은 오직 포트 `1` ~ `8`로만 포워딩됨  
    - VLAN은 또한 엔드포인트의 MAC addresses에 기반하여 정의된다. (스위치 포트 대신)

  - **Dynamic membership**
    - 포트는 VLANs를 동적으로 할당받을 수 있음

  - **Forwarding between VLANs**
    - 라우팅을 통해 이루어짐 (분리된 스위치처럼)
    - 실제로, vendor들은 스위치와 라우터 기능을 결합한 장비를 판매함

- VLANs spanning multiple switches  
![vlans_spanning_multiple_switches][def32]  
  - **Trunk port**는 물리적으로분리된 여러 스위치 간에 정의된 VLANs 사이에서 프레임을 운반한다.
    - 스위치 간 VLAN 내에서 포워딩된 프레임은 vanilla 802.1 프레임이 될 수 없다. (반드시 VLAN ID info를 포함해야 함)
    - 802.1Q 프로토콜은 trunk port 간 포워딩된 프레임에 대해 추가적인 헤더 필드를 더하고/제거했다.  

- 802.11Q VLAN frame format  
![ieee_802_1q_vlan_frame_format][def33]  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 김도형 교수님의 컴퓨터네트워크 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/OEEipbR.png
[def2]: https://i.imgur.com/foAee2Y.png
[def3]: https://i.imgur.com/8FkHy9C.png
[def4]: https://i.imgur.com/8AlOrx4.png
[def5]: https://i.imgur.com/iqjxSrt.png
[def6]: https://i.imgur.com/yEnsY3p.png
[def7]: https://i.imgur.com/hVHVzt8.png
[def8]: https://i.imgur.com/qmdy2x9.png
[def9]: https://i.imgur.com/G1fWLqa.png
[def10]: https://i.imgur.com/rqlhglY.png
[def11]: https://i.imgur.com/v6tm4qZ.png
[def12]: https://i.imgur.com/gsNz6dQ.png
[def13]: https://i.imgur.com/VwggpMo.png
[def14]: https://i.imgur.com/iDdlEL3.png
[def15]: https://i.imgur.com/cDRpZiu.png
[def16]: https://i.imgur.com/T80sFcp.png
[def17]: https://i.imgur.com/ATXijNQ.png
[def18]: https://i.imgur.com/3VcNtKH.png
[def19]: https://i.imgur.com/3VcNtKH.png
[def20]: https://i.imgur.com/cJ2nB6b.png
[def21]: https://i.imgur.com/KoAHAjN.png
[def22]: https://i.imgur.com/qUYD7iv.png
[def23]: https://i.imgur.com/rdNpYRq.png
[def24]: https://i.imgur.com/OGC7coH.png
[def25]: https://i.imgur.com/GRqygjO.png
[def26]: https://i.imgur.com/SOBlHqi.png
[def27]: https://i.imgur.com/QU2wltb.png
[def28]: https://i.imgur.com/tk4sSOu.png
[def29]: https://i.imgur.com/rj7Y3z5.png
[def30]: https://i.imgur.com/TlExZZs.png
[def31]: https://i.imgur.com/kG6OM33.png
[def32]: https://i.imgur.com/Bl2W9XW.png
[def33]: https://i.imgur.com/Ebx926i.png