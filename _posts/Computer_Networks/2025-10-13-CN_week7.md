---
layout: post
title: "[컴퓨터네트워크] 7주차 - Introduction to routing protocols in practice"
excerpt: "Introduction to routing protocol in practice, Intra-ISP routing (OSPF), Routing among ISPs: BGP"

tags:
  - [컴퓨터네트워크]

toc: true

date: 2025-10-13
last_modified_at: 2025-10-16
---
## Routing Protocol
### 1. Introduction to routing protocol in practice, Intra-ISP routing (OSPF)
- 지금까지의 라우팅 연구들은 아래와 같은 가정에 기반했다.
  - 모든 라우터들은 "identical"
  - 네트워크는 "flat"
  - ... 그러나 실제로는 그렇지 않다.  

- 실제로는
  - Scale : 수십억개의 destinations
    - 모든 destinations를 라우팅 테이블에 저장할 수 없음
    - 라우팅 테이블 교환은 link를 넘치게 할 것임
  - Administrative autonomy
    - 인터넷은 네트워크들의 네트워크
    - 각 네트워크 관리자는 자신의 네트워크 내에서 라우팅을 컨트롤하길 원할 것임

<br>

- 라우터들은 "autonomous systems"(AS) 라고 불리는 도메인(domain)들로 그룹화된다.
  
- Intra-AS (a.k.a. intra-domain)
  - 같은 AS(도메인) 내에서 라우팅
  - 같은 AS 내 모든 라우터들은 반드시 같은 intra-domain routing protocol을 사용해야 함
  - 서로 다른 AS의 라우터들은 다른 intra-domain routing protocol을 사용할 수 있음
  - Gateway router
    - own AS의 edge에 위치
    - 다른 AS 내 라우터에 연결된 link를 가짐

- Inter-AS (a.k.a. inter-domain)  
  - AS들 간의 라우팅
  - Gateway들은 inter-domain routing을 수행 (as well as inter-domain routing)

<br>

- Interconnected ASes  
  - 포워딩 테이블은 intra-AS 라우팅 알고리즘과 inter-AS 라우팅 알고리즘에 의해 채워짐  
  ![interconnected_ases][def]  
    - Intra-AS 라우팅은 AS 내의 목적지들에 대한 엔트리를 결정  
    ![intra_as_routing][def2]  
    - Inter-AS & Intra-AS 라우팅이 외부 목적지들에 대한 엔트리를 결정  
    ![inter_as_routing][def3]  

- Inter-AS routing
  - AS1에 있는 라우터가 AS1의 밖에 있는 목적지를 가진 패킷을 받았다고 하자.  
  그렇다면, 라우터는 AS1의 gateway 라우터로 패킷을 보내야 할 것이다.  
  그런데 어느 gateway 라우터로 보내야 할까?  
  ![which_gateway_router][def4]  
  - AS1 inter-domain 라우팅은 반드시...
    - AS2로 갔을 때 도달 가능한 목적지와 AS3로 갔을 때 도달 가능한 목적지를 학습해야 한다.
    - 그리고 AS1 내 모든 라우터에게 이 reachability 정보를 전달해야 한다.  

  <br>

- Intra-AS routing 
  - 가장 널리 사용되는 intra-AS 라우팅 프로토콜 (a.k.a. IGP, Interior Gateway Protocol)  
    - Routing Information Protoco (RIP) [RFC 1723]  
      - Classic DV : DVs를 30초마다 교환
      - 더 이상 사용되지 않음
    - Enhanced Interior Gateway Routing Protocol (EIGRP)  
      - DV-based
      - 십여년간 Cisco-proprietary protocol로 사용  
    - **Open Shortest Path First (OSPF)** [RFC 2328]  
      - Link-state (LS) protocol
      - IS-IS protocol (ISO standard, not RFC standard)도 근본적으로 OSPF와 동일  

- Open Shortest Path First (OSPF)
  - "Open" : 공개 표준
  - Class link-state
    - 각 라우터는 OSPF link-state advertisements를 전체 AS 내 모든 다른 라우터들에게 흘려보냄
    - 여러가지 link cost metric을 지원 (e.g., bandwidth, delay, etc.)  
    - 각 라우터는 Dijkstra's algorithm을 사용하여 포워딩 테이블을 계산하고, full topology map을 유지함
  - Security
    - 모든 OSPF 메시지들은 인증됨 (malicious intrusion으로부터 보호)  

- Hierarchical OSPF
  - 그러나 AS의 규모가 매우 큰 경우도 있음
  - Local area와 Backbone 개념
  - Link-state advertisement는 오직 area 내에, 또는 backbone에만 흘려보내짐
  - 각 노드는 자신의 area topology만 상세히 알고, 오직 다른 destination에 도달하기 위한 방향만 알고 있음  
  ![hierarchical_ospf][def5]  

<br>  

### 2. Routing among ISPs: BGP
- Inter-AS routing: BGP
  - Border Gateway Protocol (BGP) [RFC 4271]
    - 사실상의 inter-domain routing 프로토콜
    - "인터넷을 하나로 묶는 glue"

  - 서브넷으로 하여금 **자신의 존재**와 **도달 가능한 목적지들**을 인터넷에 알리도록 함
    - "나 여기 있어. 이건 내가 도달할 수 있는 목적지들과 그 방향이야."

  - BGP는 주요 기능에 따라 두 가지로 나뉨
    - eBGP (external BGP) : 주변 AS들로부터 서브넷 reachability 정보를 수집하기 위해
    - iBGP (internal BGP) : 모든 AS 내 라우터들에게 reachability 정보를 전달하기 위해

  - **Reachability 정보**와 **policy**에 기반하여 다른 네트워크로의 good routes를 결정한다.  

<br>

- eBGP, iBGP  
![ebgp_ibgp](TODO)  

<br>

- BGP basics
  - **BGP session**
    - 두 BGP 라우터("peers")는 세미-영구적인 TCP 연결을 통해 BGP 메시지를 교환  
    - 다른 목적지 네트워크 prefixes에 **paths**를 광고 (BGP는 "path-vector" 프로토콜)
      - distance vector와 BGP의 핵심 차이점! ★
        - distance vector는 목적지까지의 거리(홉 수)만을 광고
        - BGP는 목적지까지의 전체 경로(AS들의 리스트)를 광고 (count-to-infinity 문제 해결)  

  - e.g., `AS3` 게이트웨이인 `3a`가 `AS3`-`X` path를 `AS2`의 게이트웨이인 `2c`에게 광고한다고 하자.  
    - `AS3`은 `AS2`에게 자신이 `X`로 datagram을 forward 할 것을 약속  
    ![bgp_advertisement](TODO)  

<br>

- Path attributes & BGP routes
  - BGP advertised route : **네트워크 prefix** + **path attributes**
    - Prefix : advertise될 목적지
    - 두 가지 중요한 attributes
      - `AS-PATH` : prefix advertisement가 통과되어 지나온 AS들의 리스트
      - `NEXT-HOP` : next-hop AS로의 특정 internal-AS 라우터(의 IP 주소)

  - **Policy-based routing**
    - 게이트웨이가 수신한 route advertisement는 **import policy**를 사용하여 수신될 지/or 수신되지 않을 지 결정 (e.g., never route through AS Y)  
    - AS policy는 또한 주변 AS에 어떤 path를 광고할 지 결정  

    <br>

- BGP path advertisement  
![bgp_path_advertisement_1](TODO)  
  - `AS2` 라우터 `2c`는 `AS3, X` path advertisement를 `AS3` 라우터 `3a`로부터 수신
  - `AS2` policy에 기반하여, `AS2` 라우터 `2c`는 `AS3, X`를 accept하고 `AS2` 내 모든 라우터들에게 propagate
  - TODO  
![bgp_path_advertisement_2](TODO)
  - TODO

  <br>

- BGP messages
  - TCP 연결에서 peer들 간에는 BGP 메시지들이 교환된다.  
  - BGP 메시지 유형
    - `OPEN`
      - TODO
    - `UPDATE`
      - TODO
    - `KEEPALIVE`
      - TODO
    - `NOTIFICATION`
      - TODO

    <br>

- BGP path advertisement (Cont'd)  
![bgp_path_advertisement_3](TODO)  
  - TODO
![bgp_path_advertisement_4](TODO)  
  - TODO

  <br>  
  
- 왜 Intra-AS 라우팅과 Inter-AS 라우팅을 분리하는가?
  - Policy
    - Inter-AS : 관리자가 트래픽이 라우팅되는 방식과 누가 그 라우팅을 할 수 있는지를 제어하고 싶어함
    - Intra-AS : single admin, 따라서 policy가 필요 없음

  - Scale
    - Hierarchical 구조는 테이블 크기와 트래픽 갱신을 줄여줌
  
  - Performance
    - Inter-AS : policy가 우선시됨
    - Intra-AS : 성능에 집중  

  <br>

- Hot potato routing  
![hot_potato_routing](TODO)  
  - 특정 목적지로 가는 여러 경로가 있을 때, 가장 적은 intra-domain cost를 가지는 local gateway를 선택
  (e.g., `2d`는 `2a`를 선택. 비록 `X`로의 더 많은 hop이 걸리더라도)
  - intra-domain cost에 대해서는 걱정하지 않는다.  

<br>

- BGP: Implementing policy via advertisement  
![bgp_implementing_policy_via_advertisement](TODO)
  - TODO

<br>

- BGP route selection  
  - TODO

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 김도형 교수님의 컴퓨터네트워크 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/vBXpnmS.png
[def2]: https://i.imgur.com/yhC3fI3.png
[def3]: https://i.imgur.com/sEKXMjj.png
[def4]: https://i.imgur.com/NPOflGq.png
[def5]: https://i.imgur.com/vNHaohQ.png