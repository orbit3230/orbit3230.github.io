---
layout: post
title: "[컴퓨터네트워크] 3주차 - Internet Protocol (IP)"
excerpt: "IP - the Internet Protocol"

tags:
  - [컴퓨터네트워크]

toc: true

date: 2025-09-15
last_modified_at: 2025-09-18
---
## Internet Protocol (IP)
### 1. IP - the Internet Protocol
- Network layer: Internet  
  - Host, routher network layer functions  
  ![network_layer][def]  

<br>

- IP Datagram format  
![ip_datagram_format_1][def2]  
  - header length : `4` bits
    - IP header의 길이 (단위: 32-bit words)
    - 최소값 : 5 (20 bytes), 최대값 : 15 (60 bytes)
    - 옵션 필드가 없을 경우 : 20 bytes
  - length : `16` bits
    - IP datagram 전체 길이 (단위: bytes)
    - 최소값 : 20 bytes, 최대값 : 65,535 bytes

![ip_datagram_format_2][def3]  

<br>

- IP Fragmentation, Reassembly  
![ip_fragmentation][def4]  
  - 네트워크 링크는 MTU(Maximum Transmission Unit)를 가짐
    - Link-layer frame의 최대 크기
    - 링크 타입은 제각각이므로, MTU도 제각각
      
  - 큰 IP Datagram은 네트워크 내에서 쪼개어져야 할 수도 있음
    - 하나의 Datagram이 여러 datagrams로 쪼개어짐
    - 오직 마지막 도착지에서 Reassembled.
    - 관련된 fragments를 식별하고 순서를 맞추는 데 IP 헤더 비트를 사용  

- Example
  - 4000 byte IP datagram
  - MTU = 1500 bytes인 링크를 통과해야 함  
  ![ip_fragmentation_example][def5]  
    - 마지막 fragment의 크기는 1040 bytes
    - 두 개의 헤더가 추가되었기 때문  
    - 하나의 Datagram에서 쪼개어졌음을 `ID` 필드로 식별  
    - `fragflag` 필드로 마지막 fragment인지 아닌지 식별 (더 있으면 `1`, 마지막이면 `0`)  
    - `offset` 필드로 순서(시작점)를 식별  

- 그러나 Fragmentation은 바람직하지 않음
  - 라우터의 부하 증가
  - Fragment 하나만 손실되어도, 전체 datagram이 손실됨  

- Solution?  
-> Path MTU Discovery  

<br>

- IP Addressing: Introduction  
![ip_addressing_intro][def6]  
  - IP address : 각 호스트(or 라우터) 인터페이스에 할당된 32-bit identifier  

  - Interface
    - 호스트/라우터와 물리적 링크 간의 연결
    - 라우터는 일반적으로 여러 인터페이스를 가짐
    - 호스트는 일반적으로 하나 or 두 개의 인터페이스를 가짐 (유선, 무선)  

  - Q. 인터페이스들은 실제로 어떻게 연결되는가?  
  ![ip_addressing_intro_answer][def7]  
  -> 추후 다룹니다.  

  <br>

- Subnet
  - What's a subnet?  
  -> 라우터의 개입 없이 직접 물리적으로 서로 도달할 수 있는 디바이스 인터페이스  
  -> 즉, 라우터 이전의 내부 네트워크 집합  
  - IP 주소는 두 부분으로 나뉨
    - (1) Subnet ID : 호스트가 속한 subnet을 식별 (상위 `n`비트)
    - (2) Host ID : 호스트를 식별 (e.g., 하위 `32-n`비트)
  - 상위 `n`비트가 Subnet ID이면, `/n` 표기법을 사용하여, `x.x.x.x/n`으로 표현 (Subnet mask)  

<br>

- 과거에는 32-bit IP 주소를 다섯 개의 클래스로 나뉘었음  
![ip_addressing_classful_1][def8]  
![ip_addressing_classful_2][def9]  
  - 예를 들어 class A를 가져가면, `2^24`개의 호스트를 가질 수 있음  
  - 그래서 많은 주소가 낭비됨  

<br>

- IP addressing: CIDR (Classless Inter-Domain Routing)
  - "cider"라고 발음
  - 주소의 **subnet 부분**에 대해 임의의 길이가 허용됨
  - format : `a.b.c.d/x` (x = 주소에서 subnet 부분의 비트 수)  
  ![ip_addressing_cidr](TODO)  

<br>

- 그렇다면 두 가지 질문이 생긴다.
  - (1) 호스트는 네트워크 내에서 IP 주소를 어떻게 얻는가? (주소의 host part)  
  - (2) 네트워크 자신은 IP 주소를 어떻게 얻는가? (주소의 subnet part(network part))
  - 즉, IP 주소를 어떻게 얻는가?

- Q1. How does a host get IP address?
  - (1) config 파일 내 sysadmin으로 하드 코딩 (e.g., /etc/rc.config in UNIX)
  - (2) DHCP (Dynamic Host Configuration Protocol)  
    - 서버로부터 동적으로 주소를 get
    - "Plug-and-play"  

- Dynamic Host Configuration Protocol (DHCP)  
  - 목표 : 호스트가 네트워크에 "join"할 때, 네트워크 서버로부터 IP 주소를 얻음
    - 사용 중인 주소에 대한 임대 갱신 가능  
    - 주소에 대한 재사용 가능
    - 네트워크르르 들락날락하는 모바일 유저들에 대한 지원  

  - DHCP overview
    - (1) 호스트는 **DHCP discover** 메시지를 브로드캐스트로 보냄
    - (2) DHCP 서버는 **DHCP offer** 메시지로 응답 (가능한 IP 주소를 제안)
    - (3) 호스트는 **DHCP request** 메시지로 IP 주소를 요청
    - (4) DHCP 서버는 **DHCP ACK** 메시지로 요청을 승인  
    ![dhcp_overview_1](TODO)  
    ![dhcp_overview_2](TODO)  
    ![dhcp_overview_3](TODO)  

  - (1), (2) 두 단계는 만약 클라이언트가 이전에 할당되었던 네트워크 주소를 기억하고 재사용하길 원한다면 생략될 수 있음  

  - 왜 (2) 단계에서 받은 IP 주소를 바로 사용하지 않는가?
    - 클라이언트는 브로드캐스트로 discover 메시지를 보냈기 때문에, 여러 DHCP 서버로부터 offer 메시지를 받을 수 있음  
    - 따라서 클라이언트는 그 중 하나를 선택하여 request 메시지를 보내야 하기 때문  

  - DHCP는 단순히 IP 주소 뿐만 아니라, 더 많은 정보도 반환해줌
    - 클라이언트의 first-hop 라우터 주소
    - DNS 서버의 이름과 IP 주소
    - 네트워크 마스크 (network vs host의 비율을 나타내는)  
    
  - 이 모든 정보들이 네트워킹을 위한 인터페이스를 설정하는 데 필요함

  - DHCP example  
  ![dhcp_example_1](TODO)  
  ![dhcp_example_2](TODO)  

- Q2. How does network get subnet part of IP address?
  - 자신의 provider ISP의 주소 공간의 할당된 일부를 get  
  ![how_does_network_get_subnet_part_of_ip_address](TODO)  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 김도형 교수님의 컴퓨터네트워크 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/90UJWVt.png
[def2]: https://i.imgur.com/Jskn5eM.png
[def3]: https://i.imgur.com/HEfhlUJ.png
[def4]: https://i.imgur.com/QWs5PUt.png
[def5]: https://i.imgur.com/v8ol4n2.png
[def6]: https://i.imgur.com/Fm8Bxz3.png
[def7]: https://i.imgur.com/1jzYcMY.png
[def8]: https://i.imgur.com/APsFqEW.png
[def9]: https://i.imgur.com/xxf0Ooz.png