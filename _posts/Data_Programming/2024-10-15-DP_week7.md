---
layout: post
title: "[데이터 분석 프로그래밍] 7주차 - Pandas"
excerpt: "Instruction to Pandas, Pandas Data Structures, Data Exploration"

tags:
  - [데이터 분석 프로그래밍, Python]

toc: true

date: 2024-10-15
last_modified_at: 2024-10-15
---
## Introduction to Pandas
- ***Pandas***
  - **데이터 조작과 분석**을 위한 파이썬 오픈소스 라이브러리
  - 데이터 조작과 분석이 **쉽고 직관적**이게 디자인 되었다.  
  - 빠르고 간편한 **Data cleaning**, **exploration**, 그리고 **analysis 편의성** 제공  
  - **다양한 데이터 처리 함수**를 제공함으로써 데이터 분석을 보다 쉽게 만들어준다.  
    - Data cleaning / Missing value processing / Data transformation  
  - **NumPy를 기반**으로 만들어졌다. 가장 큰 차이는, Pandas는 table 형태의 heterogeneous data를 다루는데 특화되어 있다.  
  - **Pan**el **Da**ta 의 줄임말이다.  

<br>

- **Easy Data Import and Export**
  - 다양한 파일 포맷으로부터 손쉽게 데이터 load. (CSV, Excel, SQL, etc.)  
  - 처리한 데이터를 매끄럽게 export.

- **Data Exploration**
  - 빠른 data 요약과 통계 분석
  - 트렌드, 패턴, 이상치 파악

- **Data Cleaning** and **Preprocessing**
  - 효율적인 Missing value 처리
  - Rename, filter, or drop columns
  - 데이터를 변환하는 데에 유용한 함수 제공

- **Data Manipulation**
  - 데이터 aggregation에 `groupby` 함수 수행
  - dataset을 merge & concatenate

- **Time Series Analysis**
  - 시계열 데이터를 다루는데 훌륭한 지원  
  - 간편한 날짜/시간 데이터 처리

- **Integration with other libraries**
  - 다른 파이썬라이브러리와 매끄러운 호환성
  - NumPy, Matplotlib, Scikit-learn, etc.

  <br>

- Version check  
`!pip show pandas`

```py
import pandas as pd
print(pd.__version__)
```

- Installation  
`!pip install pandas`  

<br> 

## Pandas
### 1. Pandas Data Structures
- **DataFrame**
  - Pandas에서 **table 형태의 데이터를 저장하는 object**이다.
  - 행/열 구조의 **2차원 데이터 구조**. Excel sheet와 유사하다.
  - **여러 개의 Series**로 이루어져있다.  

- **Series**
    - Pandas에서 **1차원 데이터를 저장하는 object**이다.  
    **DataFrame의 각 열**이 Series이다.  
    - 각 데이터 조각을 **고유한 index로 관리**한다.  

    <br>

- 즉, 요약하자면 **DataFrame**은 **같은 Index를 고유하는 Series의 집합**이다.  
![dataframe_is_collection_of_series][def]  

<br>

- (1) **직접 Series를 부여**하여 DataFrame 생성  
`pd.Series()`

```py
import pandas as pd
s = pd.Series(["apple", "banana", "melon"])
print(s)
# 0     apple
# 1    banana
# 2     melon
# dtype: object
```

- `index` : labels의 집합, 각 값들을 식별하는 key
- `values` : values의 집합, 주로 같은 데이터 타입.  

```py
print("Index: ", s.index)
# Index:  RangeIndex(start=0, stop=3, step=1)
print("Values: ", s.values)
# Values:  ['apple' 'banana' 'melon']
```

- Series에 **고유한 index를 부여**할 수 있다.  
  - Pandas series를 만들 때, **직접 index를 specify** 할 수 있다.
  - index는 데이터의 각 element에 접근하도록 해주는 label이다.  

```py
s = pd.Series(["apple", "banana", "melon"], index=["A", "B", "C"])
print(s)
# A     apple
# B    banana
# C     melon
# dtype: object
```

```py
s.index = ["first", "second", "third"]
print(s)
# first     apple
# second    banana
# third      melon
# dtype: object
```

<br>

- (2) **Dataset을 Import** 하여 DataFrame 생성  
`pd.read_csv()`
  - `titanic.csv` 파일을 불러와 DataFrame을 생성해보자.

```py
from google.colab import drive
drive.mount('/content/gdrive')
titanic_df = pd.read_csv('/content/gdrive/My Drive/titanic.csv')
```

- 생성된 DataFrame은 일반적으로 매우 크기 때문에, **일부만 읽어볼 수 있는 함수**가 존재한다.  
  - `head(n = 5)` : **처음 n개**의 데이터를 읽어온다.
  - `tail(n = 5)` : **마지막 n개**의 데이터를 읽어온다.  

  ```py
  titanic_df.head(5)
  titanic_df.tail(5)
  ```  

<br>

- (3) `ndarray`로 DataFrame 생성  
`pd.DataFrame()`

```py
import numpy as np
data = np.array([
    (1, "Alice", 25),
    (2, "Bob", 30),
    (3, "Charlie", 22)
], dtype=[('ID', 'int'), ('Name', 'object'), ('Age', 'int')])
df = pd.DataFrame(data)
df
```

![ndarray_to_dataframe][def2]  

<br>

-  (4) list와 dictionary로 DataFrame 생성  
`pd.DataFrame()`

```py
data = [[1, 'Alice', 25], [2, 'Bob', 30], [3, 'Charlie', 22]]
columns = ['ID', 'Name', 'Age']
df = pd.DataFrame(data, columns=columns)
df
```

![list_to_dataframe][def2]  

```py
data = {
    'ID': [1, 2, 3],
    'Name': ['Alice', 'Bob', 'Charlie'],
    'Age': [25, 30, 22]
}
df = pd.DataFrame(data)
df
```

![dict_to_dataframe][def2]  

<br>

### 2. Data Exploration
- 데이터가 주어지면, 우리는 그 데이터에 친숙해져야 한다.  
- 데이터를 알아가는 것은 중요한 단계이다.  
- `shape`
  - DataFrame의 **dimension을 나타내는 tuple**을 반환한다. `(rows, columns)`  
  - 내 dataset의 크기를 빠르게 파악할 수 있다.  
- `info()`
  - 데이터 타입이나 non-null 데이터 개수를 포함한 **DataFrame에 대한 간결한 요약**을 제공한다.  
  - 내 dataset의 구조를 빠르게 파악할 수 있다.  

```py
titanic_df.shape
# (891, 12)
```

```py
titanic_df.info()
# <class 'pandas.core.frame.DataFrame'>
# RangeIndex: 891 entries, 0 to 890
# Data columns (total 12 columns):
#  #   Column       Non-Null Count  Dtype
# ---  ------       --------------  -----
#  0   PassengerId  891 non-null    int64
#  1   Survived     891 non-null    int64
#  2   Pclass       891 non-null    int64
#  3   Name         891 non-null
#  4   Sex          891 non-null    object
#  5   Age          714 non-null    float64
#  6   SibSp        891 non-null    int64
#  7   Parch        891 non-null    int64
#  8   Ticket       891 non-null    object
#  9   Fare         891 non-null    float64
#  10  Cabin        204 non-null    object
#  11  Embarked     889 non-null    object
# dtypes: float64(2), int64(5), object(5)
# memory usage: 83.7+ KB
```

<br>

- `describe()`
  - **수치형 데이터**에 대한 **기술 통계량**을 제공한다.
    - object types는 표시되지 않는다.
  - **count**, **mean**, **std**, **min**, **25%**, **50%**, **75%**, **max**를 제공한다.  

```py
titanic_df.describe()
```

![describe][def3]  

<br>

- `value_counts()`
  - 각 열(Series)의 **unique value의 각 빈도수**를 반환한다.  
    - 빈도수를 담은 새로운 Series로 반환된다.
  - categorical data의 **분포**를 파악할 수 있다.  

```py
titanic_df['Age'].value_counts()
```

![value_counts][def4]  

<br>

- `sample()`  
  - DataFrame에서 **임의의 데이터**를 추출한다.  
  - 주로 데이터셋의 일부를 빠르게 확인하거나 model을 train시킬 때 사용된다.  

```py
titanic_df.sample(n=5)
```

![sample](https://i.imgur.com/4CN5kdO.png)  

<br>

- `unique()`  
  - DataFrame의 특정 열(Series)에 **unique한 값들을 반환**한다.  
  - 중복 값을 제거하고 unique 값들만 확인하는데 사용된다.  

```py
titanic_df['Embarked'].unique()
# array(['S', 'C', 'Q', nan], dtype=object)
```
  
<br>

- `sort_values()`
  - DataFrame을 **특정 열을 기준으로 정렬**한다.
  - `ascending` parameter를 통해 오름차순/내림차순을 설정할 수 있다.
    - descending order : `titanic_df.sort_values(by='Fare', ascending=False)`

```py
titanic_df.sort_values(by='Fare')  # default : ascending order
```

![sort_values][def5]  

<br>

#### Exploring Data with Series
- DataFrame의 각 열들은 Series로 취급될 수 있다.  
- Series는 DataFrame 내에서 **index**와 **데이터**를 가지고 있는 1차원 데이터 column 이다.  

```py
type(titanic_df['Survived'])
# pandas.core.series.Series
type(titanic_df['Age'])
# pandas.core.series.Series

t_survived = titanic_df['Survived']
t_survived.head()
# 0    0
# 1    1
# 2    1
# 3    1
# 4    0

t_age = titanic_df['Age']
t_age.head()
# 0    22.0
# 1    38.0
# 2    26.0
# 3    35.0
# 4    35.0
# Name: Age, dtype: float64
```

<br>

#### Exploring Data with Indices
- Pandas에서 Indices는 non-numerical 할 수 있고, labels나 다른 데이터 타입으로 구성될 수 있다.  
- 이러한 flexibility는 좀 더 의미있고 contextual하게 관련성 있는 indexing을 가능하게 해준다.  

![labeled_and_non_numerical_indices](https://i.imgur.com/lONIXzc.png)  

<br>

- 특정한 column을 index로 설정할 수 있다.  
`set_index()`

```py
titanic_df.set_index('PassengerId', inplace=True)
titanic_df.head()
```

![set_index][def7]  

- Index reset  
`reset_index()`

```py
titanic_df.reset_index(inplace=True)
titanic_df.head(3)
```

![reset_index][def8]  

<br>

#### Creating and Modifying Columns
- Creating new columns  
  - assignment operator `=`를 사용하여 새로운 column과 값들을 추가할 수 있다.  
  - 기존 column을 활용하거나, 함수를 적용하거나, 아니면 list/ndarray를 활용할 수도 있다.  

```py
data = {
    'ID': [1, 2, 3],
    'Name': ['Alice', 'Bob', 'Charlie'],
    'Age': [25, 30, 22]
}
df = pd.DataFrame(data)

df['City'] = ['Seoul', 'Busan', 'Chuncheon']  # add new column (by list)
```  

<br>

- Modifying columns
  - assignment operator `=`를 사용하여 기존 column의 값들을 수정할 수 있다.  
  - Element-wise  

```py
df['Age'] = df['Age'] + 1
# 25 -> 26
# 30 -> 31
# 22 -> 23
```

<br>

- `apply()` : Pandas DataFrame의 각 행/열에 함수를 적용할 수 있게 해주는 매우 강력한 함수이다.  
  - `df.apply(func, axis=0)` : 각 열에 함수를 적용한다. (axis=0 -> default)
  - `df.apply(func, axis=1)` : 각 행에 함수를 적용한다.  
  - 특히 Lambda function과 함께 주로 사용된다.  
  `lambda arguments : expression`  

```py
df['Age Plus 1'] = df['Age'].apply(lambda x: x + 1)
df
```  

![apply_lambda_age_plus_1][def9]

```py
df['Is Adult'] = df['Age'].apply(lambda row: row['Age'] >= 25, axis=1)
```

![apply_lambda_is_adult][def10]  

TO BE CONTINUED...

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 장홍준 교수님의 데이터분석프로그래밍 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details> 

[def]: https://i.imgur.com/wpZ7a87.png
[def2]: https://i.imgur.com/SOCPgdp.png
[def3]: https://i.imgur.com/asBVAAs.png
[def4]: https://i.imgur.com/tEi1qT1.png
[def5]: https://i.imgur.com/xiXA26Q.png
[def6]: https://i.imgur.com/1Z2Z2Zv.png
[def7]: https://i.imgur.com/5Qw4Ikr.png
[def8]: https://i.imgur.com/UCOH5Z3.png
[def9]: https://i.imgur.com/NCDjJ4w.png
[def10]: https://i.imgur.com/xgLgxDY.png