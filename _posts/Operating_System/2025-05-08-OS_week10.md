---
layout: post
title: "[운영체제] 10주차 - Process Synchronization"
excerpt: ""

tags:
  - [운영체제]

toc: true

date: 2025-05-08
last_modified_at: 2025-05-12
---
## Process Synchronization
### 1. Background
- TODO  

<br>

### 2. Critical Section Problem
- TODO

<br>

### 3. Solutions
#### [1] Interrupt-based Solution
- TODO

<br>

#### [2] Peterson's Solution
- TODO

<br>

### 4. Memory Barriers
- TODO

<br>

### 5. Synchronization Hardware
- 많은 시스템들은 critical section code를 보완하기 위한 하드웨어 지원을 제공한다.
- TODO

<br>

- **Test-and-Set** Instruction
  - Definition  

  ```c
  boolean test_and_set(boolean *target) {
      boolean rv = *target;
      *target = true;
      return rv;
  }
  ```

  - Properties
    - TODO

  - Solusion
    - TODO

    ```c
    do {
        while (test_and_set(&lock)) {
            /* do nothing */
        }
        /* critical section */
        lock = false;
        /* remainder section */
    } while (true);
    ```

    <br>

- **Compare-and-Swap** Instruction
  - Definition  

  ```c
  int compare_and_swap(int *value, int expected, int new_value) {
      int temp = *value;
      if (*value == expected)
          *value = new_value; 
      return temp;
  }
  ```

  - Properties
    - TODO

  - Solusion
    - TODO

    ```c
    while(true) {
        while(compare_and_swap(&lock, 0, 1) != 0) {
            /* do nothing */
        }
        /* critical section */
        lock = 0;
        /* remainder section */
    }
    ```

    - 그러나 이 Solution이 critical-section problem을 해결할 수 있는가?
      - No, TODO  

    - Bounded-waiting with compare-and-swap

    ```c
    bool waiting[n] = {false, ...};
    int lock = 0;
    ...
    while(true) {
        waiting[i] = true;
        key = 1;
        while(waiting[i] && key == 1) {
            key = compare_and_swap(&lock, 0, 1);
        }
        waiting[i] = false;
        /* critical section */
        j = (i + 1) % n;
        /* scan the array in the cyclic ordering
        (i+1, i+2, n-1, 0, ... , i-1) */
        while((j != i) && !waiting[j])
            j = (j + 1) % n;
        if (j == i)
            lock = 0;
        else
            waiting[j] = false;
        /* remainder section */
    }
    ```

    - TODO

    <br>

### 6. Atomic Variables
- 일반적으로, compare-and-swap과 같은 명령어들은 다른 synchronization tools를 위한 building block으로 사용된다.  

- 한 가지 도구는 **atomic variables**이다.  
이는 정수형이나 boolean같은 기본 데이터 타입에 대한 atomic(uninterruptible) update를 제공한다.  

- 예를들어,
  - TODO  

- `increment()` 함수는 다음과 같이 구현될 수 있다.

```c
void increment(atomic_int *v) {
    int temp;
    do {
        temp = *v;
    } while(temp != (compare_and_swap(v, temp, temp+1)));
}
// 'include/linux/atomic/atomic-instrumentedd.h' in Linux
```

- Examples  
  - Intel -> 'arch/x86/include/asm/atomic.h'
  - ARM -> 'arch/arm/include/asm/atomic.h'
  - PowerPC -> 'arch/powerpc/include/asm/atomic.h'

<br>

### 7. Mutex Locks
- 바로 이전 솔루션은 정교하고 복잡하며, 일반적으로 애플리케이션 프로그래머들에게는 접근 불가능하다.

- OS 디자이너들이 critical section 문제를 해결하기 위해 소프트웨어 tool을 빌드했다.

- 가장 간단한 것은 **mutex lock**이다.  
  - **Boolean** 변수를 사용해 lock이 활성화 되었는지 아닌지 나타낸다.

- Critical section을 이렇게 보호한다.
  - 우선, `acquire()` a lock
  - 그리고, `release()` a lock  

- `acquire()`와 `release()` 호출은 반드시 atomic이어야 한다.
  - 일반적으로 하드웨어 atomic 명령어를 통해 구현된다. (such as compare-and-swap)

- 그러나 이 솔루션은 **busy waiting**을 유발한다.
  - 이 lock은 또한 **spinlock**이라고도 불린다.

<br>

- Solution to CS Problem using Mutex Locks

```c
while(true) {
    acquire(&lock);
    /* critical section */
    release(&lock);
    /* remainder section */
}
```

<br>

- Examples
  - Pthread library  
  ![pthread_library](TODO)  

  - Kernel API
    - kernel/locking/mutex.c
    - `mutex_lock()`
    - `mutex_unlock()`
    - ...

    <br>

### 8. Semaphores
- 프로세스가 synchronize하도록 더 정교한 방식을 제공하는 Synchronization tool은 **semaphore**이다.  

- Mutex lock `M` - boolean variable  
Semaphore `S` - integer variable  

- 두 가지 개별 atomic operations를 통해 접근될 수 있다.
  - `wait(S)`
  - `signal(S)`

- Definition of `wait()`  

```c
wait(S) {
    while(S <= 0)
        /* busy wait */
    S--;
}
```

- Definition of `signal()`  

```c
signal(S) {
    S++;
}
```

- TODO  

- Solution to CS Problem using Semaphores
  - TODO

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">  

이 포스팅은 강원대학교 송원준 교수님의 운영체제 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.  

</div>
</details>