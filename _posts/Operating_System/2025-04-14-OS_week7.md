---
layout: post
title: "[ìš´ì˜ì²´ì œ] 7ì£¼ì°¨ - CPU Scheduling"
excerpt: "CPU Scheduler, Preemptive / Non-Preemptive, Scheduling Algorithms, Thread Scheduling, Multiple-processor Scheduling"

tags:
  - [ìš´ì˜ì²´ì œ]

toc: true

date: 2025-04-14
last_modified_at: 2025-04-24
---
## CPU Scheduling
- CPU ë˜í•œ OSì— ì˜í•´ ê´€ë¦¬ë˜ì–´ì•¼ í•˜ëŠ” ì»´í“¨í„° ë¦¬ì†ŒìŠ¤ë“¤ ì¤‘ í•˜ë‚˜ì´ë‹¤.  
- **CPU utilizationì„ ìµœëŒ€í™”**
- CPUê°€ í•­ìƒ ë°”ì˜ê²Œ ì¼í•˜ë„ë¡ ìœ ì§€í•´ì•¼ í•œë‹¤.
- CPU-I/O burst Cycle  
![CPU-I/O burst Cycle][def]  
  - í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ì€ CPU executionê³¼ I/O wait **cycle**ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.
  - CPU burst ë¶„ë°°ê°€ ì£¼ìš” ê´€ì‹¬ì‚¬ê°€ ëœë‹¤.  
- Multiprogrammingì„ ê°€ëŠ¥í•˜ê²Œë” í•œë‹¤.  
- ìš©ì–´ (ëª¨ë‘ ê°™ì€ ì˜ë¯¸)
  - CPU scheduling
  - Process scheduling
  - Kernel thread scheduling

<br>

- CPU-burst íŒ¨í„´ì„ ë¶„ì„í•´ë³´ë©´, ì•„ë˜ì™€ ê°™ì€ ê·¸ë˜í”„ë¡œ ë‚˜íƒ€ë‚œë‹¤.  
![CPU-burst][def2]
  - ë§ì€ ìˆ˜ì˜ ì§§ì€ CPU burst
  - ì ì€ ìˆ˜ì˜ ê¸´ CPU burst
  - ì´ ë¶„í¬ëŠ” CPU-schedular ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•  ë•Œ ì¤‘ìš”í•˜ë‹¤.  

  <br>

### 1. CPU Scheduler
- **CPU schedular**ëŠ” ready queueì— ìˆëŠ” í”„ë¡œì„¸ìŠ¤ ì¤‘ì—ì„œ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬, CPU ì½”ì–´ì—ê²Œ í• ë‹¹í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.  
  - QueueëŠ” ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì„ ìˆ˜ ìˆë‹¤.  

- CPU scheduing decisionì€ í¬ê²Œ ë„¤ ê°€ì§€ ìˆœê°„ì— ì´ë£¨ì–´ì§„ë‹¤.  
  - (1) running -> waiting (I/O burst)
  - (2) running -> ready
  - (3) waiting -> ready
  - (4) Terminates

- (1)ê³¼ (4) ìƒí™©ì˜ ê²½ìš°, ë°˜ë“œì‹œ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ê°€ í• ë‹¹ì´ ë˜ì–´ì•¼ í•œë‹¤. (no choice)
- ê·¸ëŸ¬ë‚˜ (2)ì™€ (3)ì˜ ê²½ìš°, There is a choice.

<br>

### 2. Preemptive / Non-Preemptive
- ìŠ¤ì¼€ì¥´ë§ì´ (1)ë²ˆê³¼ (4)ë²ˆ ìƒí™©ì—ì„œ ì´ë£¨ì–´ì§ˆ ë•Œ, Scheduling schemeì€ **non-preemptive**ì´ë‹¤.

- ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, **preemptive**ì´ë‹¤.  

- Non-preemptive scheduling í•˜ì—ì„œ, ì¼ë‹¨ CPUê°€ í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ë˜ì—ˆë‹¤ë©´ í”„ë¡œì„¸ìŠ¤ëŠ” CPUê°€ terminating or waiting ìƒíƒœê°€ ë˜ì–´ ë†“ì•„ì¤„ ë•Œê¹Œì§€ CPUë¥¼ ì ìœ í•œë‹¤.

- ê·¸ë˜ì„œ ê±°ì˜ ëª¨ë“  í˜„ëŒ€ OSë“¤ì€ preemptive schedulingì„ ì‚¬ìš©í•œë‹¤.

<br>

- **Preemptive Schedulingê³¼ Race Conditions**
  - Preemptive Schedulingì€ Race Conditionì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.
  - ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ê°™ì€ ë°ì´í„°ë¥¼ ê³µìœ í•˜ê³  ìˆëŠ” ê²½ìš°ë¥¼ ê³ ë ¤í•´ë³´ì.  
  ì¼ë‹¨ í•œ í”„ë¡œì„¸ìŠ¤ê°€ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´, preemptedë˜ë¯€ë¡œ ë‘ ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í•  ìˆ˜ ìˆë‹¤.  
  ë‘ ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ê°€ ê·¸ ë°ì´í„°ë¥¼ ì½ìœ¼ë ¤ê³  í•˜ë©´, ê·¸ ë°ì´í„°ëŠ” ì¼ê´€ë˜ì§€ ì•Šì€(inconsistent) ìƒíƒœê°€ ëœë‹¤.  
  - ì´ Issueì— ëŒ€í•´ì„œëŠ” Chapter 6ì—ì„œ ìì„¸íˆ ë‹¤ë£¬ë‹¤.  

<br>

### 3. Scheduling Algorithms
- **Dispatcher** ëª¨ë“ˆì€ CPU ìŠ¤ì¼€ì¥´ëŸ¬ì— ì˜í•´ ì„ íƒëœ í”„ë¡œì„¸ìŠ¤ì—ê²Œ CPUì˜ ì œì–´ë¥¼ ë„˜ê²¨ì£¼ëŠ” ì—­í• ì„ í•œë‹¤; this involves  
  - switching context
  - switching to user mode
  - jumping to the proper location  

- **Dispatch latency** : Dispatcherê°€ í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¤‘ì§€í•˜ê³  ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„.  
![Dispatch latency][def3]  

<br>

- **Scheduling Criteria**
  - **CPU utilization** : CPUê°€ ê°€ëŠ¥í•œ ë°”ì˜ê²Œ ì¼í•˜ë„ë¡ í•˜ëŠ” ê²ƒ
  - **Throughput** : unit timeì— executionì„ ì™„ë£Œí•œ í”„ë¡œì„¸ìŠ¤ì˜ ìˆ˜
  - **Turnaround time** : íŠ¹ì • í”„ë¡œì„¸ìŠ¤ê°€ execute í•˜ëŠ”ë° ê±¸ë¦° ì´ ì‹œê°„ (CPU ì‚¬ìš©, waiting in I/O, ready queue ëª¨ë‘ í¬í•¨)
  - **Waiting time** : í”„ë¡œì„¸ìŠ¤ê°€ ready queueì—ì„œ ê¸°ë‹¤ë¦° ì´ ì‹œê°„
  - **Response time** : requestê°€ ì œì¶œë˜ê³ , ì²« responseê°€ ëŒì•„ì˜¤ê¸°ê¹Œì§€ ê±¸ë¦° ì‹œê°„.   

<br>

- CPU Scheduling ì•Œê³ ë¦¬ì¦˜
  - "CPU"ë¼ëŠ” ë¶„ì•¼ëŠ” ì •í–ˆì§€ë§Œ, ì–´ëŠ í”„ë¡œì„¸ìŠ¤ê°€ ready queueì— ìˆì„ ì§€, CPU ì½”ì–´ì— í• ë‹¹ë  ì§€ì— ëŒ€í•œ ì§ˆë¬¸ì´ ë‚¨ì•„ìˆë‹¤.  
  -> CPU scheduilngì— ëŒ€í•œ ì•Œê³ ë¦¬ì¦˜ì´ í•„ìš”í•˜ë‹¤.

- **First-Come, First-Serverd (FCFS)**
- **Shortest Job First (SJF)**
- **Priority Scheduling**
- **Round Robin Scheduling (RR)**

- Scheduling ì•Œê³ ë¦¬ì¦˜ì„ ë¹„êµí•˜ê¸° ìœ„í•´, ìš°ë¦¬ëŠ” ì£¼ë¡œ í‰ê·  ëŒ€ê¸° ì‹œê°„ì„ metricìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.  

#### [1] First-Come, First-Served (FCFS)
- CPUì— ë¨¼ì € requestí•œ í”„ë¡œì„¸ìŠ¤ê°€ CPUì— ë¨¼ì € í• ë‹¹ëœë‹¤.
- FCFS ì•Œê³ ë¦¬ì¦˜ì€ FIFO queue structureë¥¼ ì‚¬ìš©í•´ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.  
![FCFS][def4]  
  - í”„ë¡œì„¸ìŠ¤ê°€ ready queueì— ë“¤ì–´ì˜¤ë©´, í”„ë¡œì„¸ìŠ¤ì˜ PCBê°€ FIFO êµ¬ì¡°ì˜ ì‹œì‘ë¶€ë¶„ì— ì‚½ì…ëœë‹¤.
  - CPUê°€ idle ìƒíƒœê°€ ë˜ë©´, FIFO êµ¬ì¡°ì˜ ëì— ìˆëŠ” PCBê°€ CPUì— í• ë‹¹ëœë‹¤.  

- ì„¸ ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ `P1`, `P2`, `P3` ìˆœì„œëŒ€ë¡œ ë„ì°©í–ˆë‹¤ê³  ê°€ì •í•˜ì.  
![FCFS_example][def5]  

- Gantt charëŠ” íŠ¹ì •í•œ ìŠ¤ì¼€ì¥´ë§ì„ í‘œí˜„í•˜ëŠ”, ê° í”„ë¡œì„¸ìŠ¤ì˜ ì‹œì‘ ì‹œê°„ê³¼ ë ì‹œê°„ì„ í¬í•¨í•˜ëŠ” ë°” ì°¨íŠ¸ì´ë‹¤.
- ìœ„ì— ëŒ€í•œ Gantt chartëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  
![FCFS_Gantt][def6]  
- ê° í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ Waiting timeì€, `P1 = 0`, `P2 = 24`, `P3 = 27`  
- **í‰ê·  ëŒ€ê¸° ì‹œê°„** = `(0 + 24 + 27)` / `3` = `17`

<br>

- ê·¸ëŸ°ë° ë§Œì•½ í”„ë¡œì„¸ìŠ¤ë“¤ì´ `P2`, `P3`, `P1` ìˆœì„œë¡œ ë„ì°©í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì.   

- ê·¸ë ‡ë‹¤ë©´ Gantt chartëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  
![FCFS_Gantt2][def7]  

- ê° í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ Waiting timeì€, `P1 = 6`, `P2 = 0`, `P3 = 3`
- **í‰ê·  ëŒ€ê¸° ì‹œê°„** = `(6 + 0 + 3)` / `3` = `3`   
- ì´ì „ ì¼€ì´ìŠ¤ë³´ë‹¤ í›¨ì”¬ ì¢‹ë‹¤.
- **Convoy effect** : ì§§ì€ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ê¸´ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ë’¤ì—ì„œ ëŒ€ê¸°í•˜ëŠ” í˜„ìƒ.  

<br>

- FCFS Scheduling ì•Œê³ ë¦¬ì¦˜ì€ **non-preemptive**ì´ë‹¤.  
  - ì¼ë‹¨ CPUê°€ í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ë˜ë©´, ê·¸ í”„ë¡œì„¸ìŠ¤ëŠ” CPUë¥¼ ì ìœ í•œë‹¤.
  - Interactive systemì—ì„œëŠ” ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤.  

<br>

- Example  
![FCFS_example2][def8]  

<br>

#### [2] Shortest Job First (SJF)  
- ì´ ì•Œê³ ë¦¬ì¦˜ì€ ê° í”„ë¡œì„¸ìŠ¤ì˜ ë‹¤ìŒ CPU burst timeì˜ ê¸¸ì´ì™€ ê´€ë ¨ì´ ìˆë‹¤.
- CPUì— ë‹¤ìŒ CPU burst timeì´ ê°€ì¥ ì§§ì€ í”„ë¡œì„¸ìŠ¤ë¥¼ í• ë‹¹í•œë‹¤.  
- SJF ì•Œê³ ë¦¬ì¦˜ì€ ì£¼ì–´ì§„ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì— ëŒ€í•œ minimum average waiting timeì„ ë³´ì¥í•œë‹¤.  

<br>

- ë‹¤ìŒê³¼ ê°™ì€ CPU burstë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì„ ê°€ì •í•´ë³´ì.  
![SJF_example][def9]  

- ìœ„ ì˜ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì— ëŒ€í•´, SJF ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ Gantt chartê°€ ë‚˜ì˜¨ë‹¤.  
![SJF_Gantt][def10]  

- **í‰ê·  ëŒ€ê¸° ì‹œê°„** = `(0 + 3 + 9 + 16)` / `4` = `7`  
  - ì°¸ê³ ë¡œ FCFS ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œëŠ” `10.25`ms !  

<br>

- Non-preemptive vs. Preemptive
  - Non-preemptive SJF - ë§Œì•½ CPUê°€ í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ë˜ë©´, ì˜¤ì§ í”„ë¡œì„¸ìŠ¤ê°€ CPU burstë¥¼ ì™„ë£Œí•  ë•Œê¹Œì§€ CPUë¥¼ ì ìœ í•œë‹¤.
  - Preemptive SJF - ë§Œì•½ ë„ì°©í•œ í”„ë¡œì„¸ìŠ¤ê°€ shortest-next-CPU burstë¼ë©´, í˜„ì¬ CPUë¥¼ ì‚¬ìš©í•˜ë˜ í”„ë¡œì„¸ìŠ¤ëŠ” CPU ì ìœ ë¥¼ ë†“ì•„ì£¼ê³  ë„ì°©í•œ í”„ë¡œì„¸ìŠ¤ê°€ CPUë¥¼ ì ìœ í•œë‹¤.  
  -> a.k.a, **Shortest Remaining Time First (SRTF)**  

<br>

- non-preemptive SJF ìŠ¤ì¼€ì¥´ë§ì˜ Example  
![SJF_example2][def11]  
  - Burst timeì´ ê°™ë‹¤ë©´, Arrival timeì´ ë¹ ë¥¸ ê²ƒì„ ìš°ì„ 

- Gantt chartëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  
![SJF_Gantt2][def12]  

- **í‰ê·  ëŒ€ê¸° ì‹œê°„** = `(0 + 6 + 3 + 7)` / `4` = `4`  

<br>

- Preemptive SJF ìŠ¤ì¼€ì¥´ë§ì˜ Example  
![SJF_example3][def13]  

- Gantt chartëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  
![SJF_Gantt3][def14]  

- **í‰ê·  ëŒ€ê¸° ì‹œê°„** = `(9 + 1 + 0 + 2)` / `4` = `3`  

<br>

- Example of Preemptive SJF  
![SJF_example4][def15]  

- Example of Non-preemptive SJF  
![SJF_example5][def16]  

<br>

- SJF Schedulingì˜ ë‹¨ì  - next CPU burstê°€ ì–¼ë§ˆì¸ ì§€ ì–´ë–»ê²Œ ì•„ëŠ”ê°€ ?!  
-> ë‹¤ìŒ CPU burstë¥¼ ì•Œ ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ì—†ë‹¤. í•˜ì§€ë§Œ..

- lengthë¥¼ ì¶”ì •í•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰, ì´ì „ ê²ƒê³¼ ë¹„ìŠ·í•  ê²ƒì´ë¼ê³  ê°€ì •í•˜ëŠ” ê²ƒì´ë‹¤.  
  - ê·¸ë¦¬ê³ ëŠ” ê°€ì¥ CPU burstê°€ ì§§ì„ ê²ƒì´ë¼ ì˜ˆì¸¡í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ê³ ë¥¸ë‹¤.

- ì§€ìˆ˜ í‰ê· ì„ ì‚¬ìš©í•´, ì´ì „ CPU burstsì˜ ê¸¸ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ë£¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤.  
  - (1) `t`<sub>`n`</sub> = `n`thì˜ ì‹¤ì œ CPU burst time
  - (2) `ğœ`<sub>`n+1`</sub> = `n+1`thì˜ ì˜ˆì¸¡í•œ CPU burst time
  - (3) `ğ›¼`, `0 <= ğ›¼ <= 1`
  - (4) Define:

- ì¼ë°˜ì ìœ¼ë¡œ, `ğ›¼` set `ğœ`<sub>`n+1`</sub> = `ğ›¼t`<sub>`n`</sub>+`(1 - ğ›¼)ğœ`<sub>`n`</sub>

- ë‹¤ìŒ CPU burstì˜ ê¸¸ì´ ì˜ˆì¸¡ Example  
![SJF_example6][def17]  

<br>

- SJF ì•Œê³ ë¦¬ì¦˜ì˜ ì‹¤ì œ ì‚¬ìš© ì˜ˆ  
  - "Information-Agnostic Flow Scheduling for Commodity Data Centers", Wei Bai, et al., USENIX NSDI, 2015  
  ![SJF_example7][def18]  
  ![SJF_example8][def19]

  - "DRAM Scheduling Policy for GPGPU Architectures Based on a Potential Functionâ€, Nagesh, et al., IEEE CAL, 2012  
  ![SJF_example9][def20]  
  ![SJF_example10][def21]  

  <br>

#### [3] Round Robin (RR)
- ê° í”„ë¡œì„¸ìŠ¤ëŠ” ì‘ì€ unit CPU time (**time quantum** `q`) ë™ì•ˆ CPUë¥¼ ì ìœ í•œë‹¤.  
ì´ëŠ” ì£¼ë¡œ 10-100ms ì •ë„ì´ë©°, ì´ ì‹œê°„ì´ ëë‚˜ë©´ í”„ë¡œì„¸ìŠ¤ëŠ” preemptedë˜ê³ , ready queueì˜ ëì— ì‚½ì…ëœë‹¤.  

- `n`ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ready queueì— ìˆê³  time quantumì´ `q`ë¼ê³  í•˜ë©´,  
ê° í”„ë¡œì„¸ìŠ¤ëŠ” CPU timeì˜ `1/n` ì •ë„ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ì–´ë– í•œ í”„ë¡œì„¸ìŠ¤ë„ `(n-1)q`ë³´ë‹¤ ë” ë§ì€ CPU timeì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.  

- TimerëŠ” ë§¤ quantumë§ˆë‹¤ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤ì¼€ì¥´ë§ í•˜ê¸° ìœ„í•´ interruptë¥¼ ë°œìƒì‹œí‚¨ë‹¤.  

- ì„±ëŠ¥ì€ time quantumì˜ í¬ê¸°ì— í¬ê²Œ ì˜ì¡´í•œë‹¤.  
  - ë§Œì•½ `q`ê°€ ê·¹ë„ë¡œ í¬ë‹¤ë©´ -> FCFSì™€ ê°™ì•„ì§„ë‹¤.
  - ë§Œì•½ `q`ê°€ ê·¹ë„ë¡œ ì‘ë‹¤ë©´ -> context switchê°€ ë„ˆë¬´ ë§ì´ ë°œìƒí•˜ì—¬, overheadê°€ ë„ˆë¬´ ì»¤ì§„ë‹¤.  

<br>

- ë‹¤ìŒê³¼ ê°™ì€ CPU burstë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì„ ê°€ì •í•´ë³´ì.  
![RR_example][def22]  

- ìœ„ ì˜ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì— ëŒ€í•´, RR ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ Gantt chartê°€ ë‚˜ì˜¨ë‹¤.  
![RR_Gantt][def23]  

- ì¼ë°˜ì ìœ¼ë¡œ SJFì˜ í‰ê·  ì†Œìš” ì‹œê°„ë³´ë‹¤ í¬ë‹¤. (e.g., context-switching overhead)  
í•˜ì§€ë§Œ, ë” ë‚˜ì€ **Response**ë¥¼ ì œê³µí•œë‹¤.  

- `q`ëŠ” context switch timeê³¼ ë¹„êµí–ˆì„ ë•Œ, ì¶©ë¶„íˆ ì»¤ì•¼ í•œë‹¤.  
  - `q`ëŠ” ì¼ë°˜ì ìœ¼ë¡œ 10-100ms ì •ë„ì´ë‹¤.
  - Context switch timeì€ 10msë³´ë‹¤ ì‘ë‹¤.  

<br>

- Time Quantum and Context Switch Time  
![RR_example2][def24]  
  - í”„ë¡œì„¸ìŠ¤ì˜ CPU burst timeì´ `10`ì´ë¼ê³  í•´ë³´ì.  
    - ë§Œì•½ time sliceê°€ `12`ë¼ë©´, í”„ë¡œì„¸ìŠ¤ëŠ” CPUë¥¼ ê³„ì† ì ìœ í•˜ì—¬ context-switch overheadê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ë§Œì•½ time sliceê°€ `1`ì´ë¼ë©´, í”„ë¡œì„¸ìŠ¤ëŠ” ì´ `9`ë²ˆì˜ context switchë¥¼ í•´ì•¼ í•œë‹¤.  

    <br>

- ì†Œìš” ì‹œê°„ì€ time quantumì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.  
![RR_example3][def25]  
  - time-quantum sizeì˜ ì¦ê°€ëŠ” í‰ê·  ì†Œìš”ì‹œê°„ í–¥ìƒì— í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.
  - í‰ê·  ì†Œìš”ì‹œê°„ì€ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì„¸ìŠ¤ê°€ single time quantumì— ì™„ìˆ˜ë  ë•Œì— í–¥ìƒëœë‹¤.
  - ëŒ€ì²´ë¡œ 80%ì˜ CPU burstsëŠ” time quantum `q`ë³´ë‹¤ ì§§ì•„ì•¼ í•œë‹¤.  

<br>

#### [3] Priority Scheduling  
- ê° í”„ë¡œì„¸ìŠ¤ì™€ ê´€ë ¨ëœ priority numberê°€ ìˆë‹¤.  

- CPUëŠ” ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ëœë‹¤.  
(ì—¬ê¸°ì„œëŠ” `0`ì´ ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ë¼ê³  ê°€ì •í•œë‹¤.)
  - Preemptive
  - Non-preemptive -> ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ready queueì˜ í—¤ë“œì— ì‚½ì…  

- SJFëŠ” ìš°ì„ ìˆœìœ„ê°€ ì˜ˆì¸¡í•œ ë‹¤ìŒ CPU burst timeì˜ ì—­ìˆœì¸ Priority schedulingì˜ íŠ¹ìˆ˜í•œ ê²½ìš°ì´ë‹¤.  

- ë¬¸ì œ : **Starvation** - ë‚®ì€ ìš°ì„ ìˆœìœ„ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì«„ì«„ êµ¶ëŠ”ë‹¤.

- Solution : **Aging** - ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ í”„ë¡œì„¸ìŠ¤ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ë†’ì¸ë‹¤.  

<br>

- ë‹¤ìŒê³¼ ê°™ì€ CPU burstë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì„ ê°€ì •í•´ë³´ì.   
![Priority_example][def26]  

- ìœ„ ì˜ í”„ë¡œì„¸ìŠ¤ ì§‘í•©ì— ëŒ€í•´, Priority scheduling ì•Œê³ ë¦¬ì¦˜ (Non-preemptive) ì„ ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ Gantt chartê°€ ë‚˜ì˜¨ë‹¤.  
![Priority_Gantt][def27]

<br>

#### [4] Multi-level Queue
- Single queue êµ¬ì¡°ì—ì„œ, ê°€ì¥ ë†’ì€ ìš°ì„ ìˆ˜ìœ„ë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ë¥¼ ê²°ì •í•˜ëŠ” ë° `O(n)`ì˜ íƒìƒ‰ì´ í•„ìš”í•˜ë‹¤.  

- Priority Schedulingê³¼ í•¨ê»˜, ê° ìš°ì„ ìˆœìœ„ì— ëŒ€í•œ ê°ê°ì˜ queueë¥¼ ê°€ì§€ëŠ” ë°©ì‹ì´ë‹¤.  

- highest-priority queueì—ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤ì¼€ì¥´ë§í•˜ì !  
![Multi-level Queue][def28]  

- ìš°ì„ ìˆœìœ„ ê²°ì •ì€ í”„ë¡œì„¸ìŠ¤ íƒ€ì…ì— ê¸°ë°˜í•œë‹¤.  

- Examples
  - ë‘ ê°œì˜ queueë¡œ ì´ë£¨ì–´ì§„ Multi-level queue scheduling algorithm
    - foreground(interactive) í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•œ queue
    - background(batch) í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•œ queue  

  - ë„¤ ê°œì˜ queueë¡œ ì´ë£¨ì–´ì§„ Multi-level queue scheduling algorithm  
  ![Multi-level Queue2][def29]  

  <br>

- ë””ìì¸ì— ë”°ë¼ queue ìŠ¤ì¼€ì¥´ë§ì„ ê²°ì •í•œë‹¤.  
  - **Fixed-priority scheduling**
    - ê° queueëŠ” ì •í•´ì§„ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ë‹¤.
    - e.g., ë‚®ì€ ìš°ì„ ìˆœìœ„ì˜ í ë‚´ í”„ë¡œì„¸ìŠ¤ëŠ” ì˜¤ì§ ë†’ì€ ìš°ì„ ìˆœìœ„ì˜ íê°€ ë¹„ì–´ìˆì„ ë•Œë§Œ CPUë¥¼ ì ìœ í•  ìˆ˜ ìˆë‹¤.  

  - **Time slice scheduling**
    - ê° queueì—ëŠ” ê°€ì¤‘ì¹˜ê°€ ë¶€ì—¬ë  ìˆ˜ ìˆê³ , CPUëŠ” ê°€ì¤‘ì¹˜ì— ë”°ë¼ ìŠ¤ì¼€ì¥´ë§ëœë‹¤.
    - e.g., foreground queueê°€ 80%ì˜ CPU timeì„ ì ìœ í•˜ëŠ” ë°˜ë©´, background queueëŠ” 20%ì˜ CPU timeì„ ì ìœ í•  ìˆ˜ë„ ìˆë‹¤.  

- ê° queueëŠ” ìì‹ ë§Œì˜ scheduling algorithmì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.  
  - e.g., multi-level queueì˜ ëª¨ë“  queuesê°€ RR scheduling algorithmì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
  - e.g., ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ì˜ íë§Œ RRì„ ì‚¬ìš©í•˜ê³ , ê°€ì¥ ë‚®ì€ ìš°ì„ ìˆœìœ„ì˜ íëŠ” FCFSë¥¼ ì±„íƒí•  ìˆ˜ë„ ìˆë‹¤.  

  <br>

#### [5] Multi-level Feedback Queue
- multi-level queueëŠ” ìŠ¤ì¼€ì¥´ë§ overheadê°€ ì‘ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, **Inflexible**í•˜ë‹¤. (e.g., starvation)

- **Multi-level feedback queue**ëŠ” ê°€ì¥ generalí•œ CPU-scheduling ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.  

- í”„ë¡œì„¸ìŠ¤ê°€ ë‹¤ì–‘í•œ queues ì‚¬ì´ì—ì„œ ì´ë™í•  ìˆ˜ ìˆë‹¤.  

- Multi-level feedback queue ìŠ¤ì¼€ì¥´ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŒŒë¼ë¯¸í„°ë¡œ ì •ì˜ëœë‹¤.  
  - queueì˜ ê°œìˆ˜
  - ê° queueì˜ ìŠ¤ì¼€ì¥´ë§ ì•Œê³ ë¦¬ì¦˜
  - í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¹ì§„ì‹œí‚¬ ë•Œë¥¼ ì •í•˜ëŠ” ê¸°ì¤€
  - í”„ë¡œì„¸ìŠ¤ë¥¼ ê°•ë“±ì‹œí‚¬ ë•Œë¥¼ ì •í•˜ëŠ” ê¸°ì¤€
  - í”„ë¡œì„¸ìŠ¤ê°€ ì„œë¹„ìŠ¤ë¥¼ í•„ìš”ë¡œ í•  ë•Œ ì–´ëŠ queueì— ë“¤ì–´ê°ˆ ê²ƒì¸ì§€ ì •í•˜ëŠ” ê¸°ì¤€  

- **Aging**ì€ multi-level feedback queueë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë  ìˆ˜ ìˆë‹¤.  

<br>

- Example
  - ì„¸ ê°œì˜ queues
    - `Q0` - `8`ms quantum RR (interactive)
    - `Q1` - `16`ms quantum RR (interactive)
    - `Q2` - FCFS (batch)  

  - Scheduling  
  ![Multi-level feedback queue][def30]  
    - ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ê°€ RRì„ ì œê³µí•˜ëŠ” `Q0`ì— ë“¤ì–´ê°„ë‹¤.
      - ì´ í”„ë¡œì„¸ìŠ¤ê°€ CPUë¥¼ ì–»ì„ ë•Œ, í”„ë¡œì„¸ìŠ¤ëŠ” `8`msë¥¼ ë°›ëŠ”ë‹¤.
      - ë§Œì•½ `8`ms ë‚´ì— ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´, í”„ë¡œì„¸ìŠ¤ëŠ” `Q1`ë¡œ ì´ë™í•œë‹¤.

    - `Q1`ì—ì„œ í”„ë¡œì„¸ìŠ¤ëŠ” `16`msë¥¼ ë°›ëŠ”ë‹¤.
      - ê·¸ëŸ¬ë‚˜ ì—¬ì „íˆ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´, preemptedë˜ê³  `Q2`ë¡œ ì´ë™í•œë‹¤.  

    <br>

### 4. Thread Scheduling
- user-level ì“°ë ˆë“œì™€ kernel-level ì“°ë ˆë“œê°€ ìˆë‹¤.

- ì“°ë ˆë“œê°€ ì§€ì›ë  ë•Œì—ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì•„ë‹ˆë¼ ì“°ë ˆë“œê°€ ìŠ¤ì¼€ì¥´ë§ëœë‹¤.

- Many-to-oneê³¼ Many-to-many ëª¨ë¸ì—ì„œ, ì“°ë ˆë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ user-level ì“°ë ˆë“œë¥¼ ìŠ¤ì¼€ì¥´ë§í•œë‹¤.
  - **process-contention scope**(PCS)ë¡œ ì•Œë ¤ì ¸ìˆë‹¤. (í”„ë¡œì œìŠ¤ ë‚´ì—ì„œ ìŠ¤ì¼€ì¥´ë§ ê²½ìŸì´ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì—)
  - ì»¤ë„ì€ user-level ì“°ë ˆë“œì— ëŒ€í•´ ì•Œì§€ ëª»í•œë‹¤.

- One-to-one ëª¨ë¸ì—ì„œ,
  - ê° user-level ì“°ë ˆë“œëŠ” ëŒ€ì‘ë˜ëŠ” kernel-threadë¥¼ ê°€ì§€ë©° OSì— ì˜í•´ ìŠ¤ì¼€ì¥´ë§ëœë‹¤.
  - **system-contention scope**(SCS)ë¡œ ì•Œë ¤ì ¸ìˆë‹¤. (ì‹œìŠ¤í…œ ë‚´ ëª¨ë“  ì“°ë ˆë“œì™€ ê²½ìŸí•˜ê¸° ë•Œë¬¸ì—)  

<br>

### 5. Multiple-Processor Scheduling
- CPU ìŠ¤ì¼€ì¥´ë§ì€ ì—¬ëŸ¬ ê°œì˜ CPUë“¤ì´ availableí•  ë•Œ ë” ë³µì¡í•´ì§„ë‹¤.  

- Multi-processëŠ” ì•„ë˜ ì•„í‚¤í…ì²˜ë“¤ ì¤‘ í•˜ë‚˜ì¼ ê²ƒì´ë‹¤.
  - Multicore CPUs
  - Multithreads cores
  - NUMA systems
  - Heterogeneous multiprocessing

<br>

- Symmetric Multiprocessing (SMP) : ê° í”„ë¡œì„¸ì„œê°€ self-scheduling

- ëª¨ë“  ì“°ë ˆë“œë“¤ì€ common ready queueì— ìˆì„ ìˆ˜ ìˆë‹¤.
  - locking ë©”ì»¤ë‹ˆì¦˜ì´ ì—†ë‹¤ë©´, í”„ë¡œì„¸ì„œ ê°„ ì ì¬ì ì¸ race conditionì´ ìˆì„ ìˆ˜ ìˆë‹¤.  
  - single shared-queueì™€ locking ë©”ì»¤ë‹ˆì¦˜ì€ ë³‘ëª© í˜„ìƒì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.

- ê° í”„ë¡œì„¸ì„œëŠ” ì“°ë ˆë“œ ë‹¹ ìì‹ ë§Œì˜ private queueë¥¼ ê°€ì§ˆ ìˆ˜ë„ ìˆë‹¤.  
![ready_queue][def31]  

<br>

- ë§Œì•½ SMPê°€ íš¨ìœ¨ì„ ìœ„í•´ ëª¨ë“  CPUsê°€ loadedë˜ë„ë¡ ìœ ì§€í•  í•„ìš”ê°€ ìˆë‹¤ë©´,
- **Load balancing**ì€ ëª¨ë“  ì›Œí¬ë¡œë“œê°€ evení•˜ê²Œ ë¶„ë°°ë˜ë„ë¡ ì‹œë„í•œë‹¤.
- **Push migration** : periodic task checkê°€ ê° í”„ë¡œì„¸ì„œì— ë¡œë“œ
- **Pull migration** : idle í”„ë¡œì„¸ì„œê°€ busy í”„ë¡œì„¸ì„œì—ê²Œ taskë¥¼ ìš”ì²­
- e.g., Linuxì—ì„œ, ê° CPUëŠ” migration jobsë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ í•˜ë‚˜ì˜ migration daemonì„ ê°€ì§„ë‹¤.  

<br>

- ì“°ë ˆë“œê°€ í•˜ë‚˜ì˜ í”„ë¡œì„¸ì„œì—ì„œ ë™ì‘í–ˆì„ ë•Œ, ê·¸ í”„ë¡œì„¸ì„œì˜ ìºì‹œ ì½˜í…ì¸ ëŠ” ê·¸ ì“°ë ˆë“œì— ì˜í•´ ì ‘ê·¼ë˜ëŠ” ë©”ëª¨ë¦¬ì— ì €ì¥ëœë‹¤.
- ìš°ë¦¬ëŠ” ì´ê²ƒì„ "ì“°ë ˆë“œê°€ í”„ë¡œì„¸ì„œì— ëŒ€í•´ **affinity**ë¥¼ ê°€ì§„ë‹¤** ë¼ê³  ë§í•œë‹¤. (ì¦‰ **processor affinity**)
- ë¡œë“œ ë°¸ëŸ°ì‹±ì€ processor affinityì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤. ì“°ë ˆë“œê°€ í•œ í”„ë¡œì„¸ì„œì—ì„œ ë‹¤ë¥¸ í”„ë¡œì„¸ì„œë¡œ ì´ë™í•¨ìœ¼ë¡œì¨.  
ì“°ë ˆë“œê°€ ê°€ì§€ê³  ìˆì–¸ í”„ë¡œì„¸ì„œì— ëŒ€í•œ ìºì‹œ ì½˜í…ì¸ ë¥¼ ì´ë™í•˜ë©´ì„œ ìƒì–´ë²„ë¦¬ê¸° ë•Œë¬¸ì´ë‹¤.  
- **Soft affinity** - ìš´ì˜ì²´ì œê°€ ì“°ë ˆë“œë¡œ í•˜ì—¬ê¸ˆ ê°™ì€ í”„ë¡œì„¸ì„œì—ì„œ ë™ì‘í•˜ë„ë¡ ì‹œë„ (no guarantees)
- **Hard affinity** - í”„ë¡œì„¸ì„œë¡œ í•˜ì—¬ê¸ˆ ê·¸ ìœ„ì—ì„œ ë™ì‘í•  ìˆ˜ ìˆëŠ” í”„ë¡œì„¸ì„œì˜ ì§‘í•©ì„ ì§€ì •í•˜ë„ë¡ í•¨ (guarantees)

<br>

- **Multicore Processors**
  - ìµœê·¼ íŠ¸ë Œë“œëŠ” ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ ì½”ì–´ë¥¼ í•˜ë‚˜ì˜ ë¬¼ë¦¬ì  ì¹©ì— ë‘ëŠ” ê²ƒì´ë‹¤.

  - ë” ë¹ ë¥´ì§€ë§Œ, ì „ë ¥ì€ ëœ ì†Œëª¨í•œë‹¤.  

  - ì½”ì–´ ë‹¹ ì—¬ëŸ¬ ê°œì˜ ì“°ë ˆë“œë¥¼ ë‘ëŠ” ê²ƒ ë˜í•œ ë³´í¸í™”ë˜ì—ˆë‹¤.
    - memory retrieveê°€ ì¼ì–´ë‚˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì“°ë ˆë“œê°€ ë¬´ì–¸ê°€ í•  ìˆ˜ ìˆë„ë¡ memory stallì˜ ì´ì ì„ ì±™ê¸´ë‹¤.  

  - Figure  
  ![figure][def32]  

<br>

- **Multithreaded Multicore System**
  - ê° ì½”ì–´ê°€ í•˜ë‚˜ë³´ë‹¤ ë§ì€ ê°œìˆ˜ì˜ ì“°ë ˆë“œë¥¼ ê°€ì§€ëŠ” ê²ƒì´ë‹¤.
  - ë§Œì•½ í•œ ì“°ë ˆë“œê°€ memory stall ìƒíƒœë¼ë©´, ë‹¤ë¥¸ ì“°ë ˆë“œë¥¼ ì‹¤í–‰í•œë‹¤.  
  ![thread_stall][def33]
  - **Chip-multithreading(CMT)**ëŠ” ê° ì½”ì–´ì— ì—¬ëŸ¬ ê°œì˜ ì“°ë ˆë“œë¥¼ í• ë‹¹í•œë‹¤. (hyperthreading)
  - ì™„ì „í•œ ì•„í‚¤í…ì²˜ state ì§‘í•©ì„ ìœ ì§€í•œë‹¤.  
  ![chip_multithreading][def34]
    - General purpose registers
    - Control register
    - Advanced Programmable Interrupt Controller (APIC) register  
      - ê° ì¸í„°ëŸ½íŠ¸ê°€ ê°œë³„ì ìœ¼ë¡œ ë‹¤ë£¨ì–´ì§ˆ ìˆ˜ ìˆê²Œ í•œë‹¤.
  - ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ëŠ” ê³µìœ ëœë‹¤.
    - Caches
    - Execution units
    - Control logics

  <br>

  - ì˜ˆë¥¼ ë“¤ì–´, 4ê°œì˜ ì½”ì–´ë¥¼ ê°€ì§„ ì‹œìŠ¤í…œì´ ê° ì½”ì–´ ë‹¹ 2ê°œì˜ ì“°ë ˆë“œë¥¼ ê°€ì§„ë‹¤ê³  ê°€ì •í•´ë³´ì.  
    - ê·¸ë ‡ë‹¤ë©´ ìš´ì˜ì²´ë„¤ëŠ” 8ê°œì˜ logical processorë¡œ ì¸ì‹í•œë‹¤.  
    ![4_core_2_threads][def35]

  - 16 ì½”ì–´ ì‹œìŠ¤í…œì´ ê° ì½”ì–´ ë‹¹ 2ê°œì˜ ì“°ë ˆë“œë¥¼ ê°€ì§„ë‹¤ë©´,  
    - ìš´ì˜ì²´ì œëŠ” 32ê°œì˜ logical processorë¡œ ì¸ì‹í•œë‹¤.  
    `$ lscpu`  
    `$ cat /proc/cpuinfo`  

    <br>

  - Two levels of scheduling  
  ![two_levels_of_scheduling][def36]  
    - (1) ìš´ì˜ì²´ì œëŠ” ì–´ëŠ software threadë¥¼ logical CPU ìœ„ì—ì„œ ì‘ë™ì‹œí‚¬ ì§€ ê²°ì •í•œë‹¤.
    - (2) ê° ì½”ì–´ëŠ” ì–´ëŠ hardware threadë¥¼ physical core ìœ„ì—ì„œ ì‘ë™ì‹œí‚¬ ì§€ ê²°ì •í•œë‹¤.

<br>

  - NUMA & CPU Scheduling  
  ![NUMA_CPU_Scheduling][def37]  
    - NUMA ì‹œìŠ¤í…œì€ ë©€í‹° í”„ë¡œì„¸ì„œ ì‹œìŠ¤í…œ ë‚´ ë©”ëª¨ë¦¬ ë””ìì¸ìœ¼ë¡œì„œ,  
    í”„ë¡œì„¸ì„œê°€ ìì‹ ë§Œì˜ local memoryë¥¼ ê°€ì§€ë©° ì´ë“¤ì€ remote memoryë³´ë‹¤ ë¹ ë¥´ê²Œ ì•¡ì„¸ìŠ¤ ë  ìˆ˜ ìˆê²Œ í•œë‹¤.  

  - SMT ì„±ëŠ¥ ë¹„êµ  
  ![SMT_performance][def38]  

  - NUMA & CPU Scheduling - cont'd
    - ë§Œì•½ ìš´ì˜ì²´ì œê°€ NUMA-awareë¼ë©´,  
    ë©”ëª¨ë¦¬ë¥¼ ì“°ë ˆë“œê°€ ì‘ë™ì¤‘ì¸ CPUì— ê°€ê¹ê²Œ í• ë‹¹í•  ê²ƒì´ë‹¤.  
    ![numa_aware][def39]

    - **NUMA non-aware** vs. **aware OS scheduler**
    - **Authomatic NUMA Balancing**
      - strategies based on (NEED TO REWRITE)
        - CPU follows memory -> ë©”ëª¨ë¦¬ê°€ ìˆëŠ” ë…¸ë“œì— ì‘ì—…ì„ ì˜®ê¹€ (task migration)
          - e.g., ì–´ë–¤ í˜ì´ì§€ê°€ ê³„ì† node 1ì— ì ‘ê·¼ë˜ë©´, ì‘ì—… ìì²´ë¥¼ node 1ë¡œ ì´ë™
        - Memory follows CPU -> ì‘ì—…ì´ ìˆëŠ” ë…¸ë“œë¡œ ë©”ëª¨ë¦¬ í˜ì´ì§€ë¥¼ ë³µì‚¬ (page migration)
          - e.g., ì‘ì—…ì´ node 0ì—ì„œ ì‹¤í–‰ë˜ë©´, ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ í˜ì´ì§€ë¥¼ node 0ìœ¼ë¡œ ì˜®ê¹€


      - Examples
        - Task grouping  
        ![task_grouping][def40]  
          - ë©€í‹° ìŠ¤ë ˆë“œë¥¼ ë§ì´ ì“°ëŠ” í”„ë¡œê·¸ë¨ (e.g., JVM, ê°€ìƒë¨¸ì‹ , ì›¹ë¸Œë¼ìš°ì €)
          - ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ (e.g., DB)

        - Pseudo-interleaving  
        ![pseudo-interleaving][def41]  
          - ì‘ì—…ì„ ì—¬ëŸ¬ ë…¸ë“œì— evení•˜ê²Œ ë¶„ì‚°ì‹œì¼œì„œ ë©”ëª¨ë¦¬ ëŒ€ì—­í­ì„ ê·¹ëŒ€í™”  

<br>
  
  - **OS and Interconnect**
    - **Interconnect contention in NUMA system**
      - NUMA system challenges
        - Remote memory latency and performance (ì›ê²© ë©”ëª¨ë¦¬ ì ‘ê·¼ ì§€ì—°)
          - CPUê°€ ìì‹ ì˜ ë…¸ë“œê°€ ì•„ë‹Œ ë‹¤ë¥¸ ë…¸ë“œì˜ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ë©´ big latency

        - **Interconnect contention** (ì¸í„°ì»¤ë„¥íŠ¸ í˜¼ì¡)
          - CPUì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” interconnectê°€ ê³¼ë¶€í•˜ë˜ë©´ ì„±ëŠ¥ì´ ê¸‰ê²©íˆ ì €í•˜

      - Related work  
        - Localization [ASPLOS '13]
          - Thread migration
          - Memory (page) migration  

        - Memory Interleaving
        - Placement optimization
          - Asymmetry interconnect [ATC '15]
          - Cache, Memory and interconnect [ATC '18]  
          ![adaptive_routing_in_NUMA_interconnect][def42]


      - Observation  
        - ê¸°ë³¸ ë¦¬ëˆ…ìŠ¤ ìŠ¤ì¼€ì¥´ëŸ¬ : First-touch policy (ì²˜ìŒ ë°ì´í„°ë¥¼ ì ‘ê·¼ í•œ CPU ë…¸ë“œì— ë©”ëª¨ë¦¬ í• ë‹¹)
        - NUMA-aware ìŠ¤ì¼€ì¥´ëŸ¬ : NUMA techniques (Redhas's NUMA automatic balancing)  
        ![numa_aware][def43]
          - ê·¸ëŸ¬ë‚˜ ê·¼ë³¸ì ìœ¼ë¡œ interconnect trafficì„ ì¤„ì—¬ì£¼ì§€ëŠ” ì•ŠëŠ”ë‹¤.
      
      - Example of fixed routing paths among 4 NUMA nodes  
      ![example][def44]

      - Bandwidth utilizations on the routing paths  
      ![example_bandwidth][def45]

      - Interconnect contentionì„ ìµœì†Œí™”í•˜ëŠ” ë°©ë²•ìœ¼ë¡œì„œ "Software-based Adaptive Routing in NUMA systems" ì—°êµ¬ê°€ ìˆì—ˆë‹¤. [ICCD 2019]  
      ![software_based_adaptive_routing][def46]

      <br>

### 6. Linux Scheduling Algorithm
- ì»¤ë„ ë²„ì „ `2.5` ì „ ê¹Œì§€ëŠ”, `O(n)` í‘œì¤€ ìŠ¤ì¼€ì¥´ë§ ì•Œê³ ë¦¬ì¦˜ì˜ ë°”ë¦¬ì—ì´ì…˜ì„ ì‚¬ìš©í–ˆë‹¤.

- `2.5` ë²„ì „ì€ constant order `O(1)` ìŠ¤ì¼€ì¥´ë§ ì‚¬ìš©í–ˆë‹¤. (preemptive)  
  - `O(1)` ìŠ¤ì¼€ì¥´ë§ì€ **í”„ë¡œì„¸ì„œë§ˆë‹¤ runqueue(RQ)ë¥¼ ê°€ì§€ëŠ” êµ¬ì¡°**ì´ë©°,  
  **ìƒìˆ˜ ì‹œê°„** ë‚´ì— í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤ì¼€ì¥´ë§í•  ìˆ˜ ìˆëŠ” ë””ìì¸ì´ë‹¤.  
  (OSì—ì„œ ë™ì‘í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ ê°œìˆ˜ì— ìƒê´€ì—†ì´)  

  - RQ structure
    - ê° í”„ë¡œì„¸ì„œ RQ ë§ˆë‹¤ **Active** & **expired** arrays
    - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ì— ë‚¨ì€ ì‹œê°„ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê°€ëŠ¥í•œ ê¸´ Task (**Active**)
    - ì‹œê°„ì´ ë‚¨ì§€ ì•Šì•˜ë‹¤ë©´(**Expired**), ë‹¤ë¥¸ ëª¨ë“  tasksê°€ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ê¹Œì§€ not run-able

  - ì™œ `O(1)` ì¸ê°€?
    - RQ arrayëŠ” í¬ì¸í„° ì—°ì‚°ì„ ì‚¬ìš©í•´ ì•¡ì„¸ìŠ¤ëœë‹¤.
    - ë”ì´ìƒ activeê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´, expiredì™€ actieë¥¼ ìŠ¤ìœ„ì¹˜ (í¬ì¸í„° ì—°ì‚°ìœ¼ë¡œ ë¹ ë¥´ê²Œ)  
    - ìœ„ ê³¼ì •ë“¤ì´ ìŠ¤ì¼€ì¥´ë§ ê²°ì •ì„ ìƒìˆ˜ ì‹œê°„ ë‚´ì— ê°€ëŠ¥í•˜ë„ë¡ í•´ì¤€ë‹¤. (í”„ë¡œì„¸ì„œ ìˆ˜ì— ìƒê´€ì—†ì´)  

  - Limitation?
    - í° ì„œë²„ ì›Œí¬ë¡œë“œì— ì¢‹ë‹¤. (interative processesê°€ ì ì€)  
    - ê·¸ëŸ¬ë‚˜ `O(1)` ìŠ¤ì¼€ì¥´ëŸ¬ëŠ” **latency-sensitive** ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤ì¼€ì¥´ë§ì—ì„œëŠ” ì¢‹ì§€ ëª»í•˜ë‹¤.  
    (ì¦‰, interactive processesì— ëŒ€í•´ì„œ poor response times)  
    - Unfairness  

<br>

- í˜„ëŒ€ ë¦¬ëˆ…ìŠ¤ ìŠ¤ì¼€ì¥´ëŸ¬ëŠ” ëª¨ë“ˆí™”ë˜ì–´ ìˆê³ , ì„œë¡œ ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜ì´ ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤ì¼€ì¥´ë§ í•  ìˆ˜ ìˆê²Œ í•œë‹¤.  
  - Called schedular class  
  `sched.h`  

- Traditional Unix-like system scheduling  
  - ë‘ ê°€ì§€ ê³µí†µ ì»¨ì…‰
    - í”„ë¡œì„¸ìŠ¤ ìš°ì„ ìˆœìœ„ (ì–¼ë§ˆë‚˜ ìì£¼ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í• ê¹Œ?)
    - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ (ì–¼ë§ˆë‚˜ ì˜¤ë˜ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í• ê¹Œ?)
  - ìš°ì„ ìˆœìœ„ëŠ” nice-value í˜•íƒœë¡œ user-spaceë¡œ export ë˜ì—ˆë‹¤.
    - `-20` ~ `19` (`100` ~ `139`) -> nice valueê°€ ì‘ì„ ìˆ˜ë¡(`-20`), ë” ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ë‹¤.  
    (niceí•œ valueëŠ” ì„±ê²©ì´ niceí•´ì„œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ìš°ì„ ìˆœìœ„ë¥¼ ë‚´ì¤€ë‹¤)

<br>

- Consideration on the nice value  
  - ì–´ë–»ê²Œ nice valuesë¥¼ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ì— ë§¤í•‘ì‹œí‚¤ëŠ”ê°€?
    - Naiveí•œ ì ‘ê·¼ë²• -> ê° nice valueì— ê³ ì •ëœ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ë§¤í•‘
      - e.g., RQì— ì„œë¡œ ë‹¤ë¥¸ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ìˆì„ ë•Œ
        - í•˜ë‚˜ì˜ default nice value (`zero`)ë¥¼ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ `100`msì— ë§¤í•‘
        - ë‹¤ë¥¸ ê°€ì¥ ë†’ì€ nice value (`+20`, the lowest priority)ëŠ” íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ `5`msì— ë§¤í•‘
        - `20`/`21` (`100` out of `105`ms)
        - `1`/`21` (`5` out of `105`ms)  

      - e.g., RQì— ë‚®ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ìˆì„ ë•Œ
        - ê° í”„ë¡œì„¸ìŠ¤ê°€ ì˜¤ì§ ê·¸ ìˆœê°„ì— `5`ms (`5` out of `10`ms each) ?

    - ì´ëŸ° Naiveí•œ ì ‘ê·¼ë²•ì—ëŠ” ë¬¸ì œê°€ ìˆë‹¤.
      - e.g., `O(1)` ìŠ¤ì¼€ì¥´ëŸ¬ì—ì„œ ë‘ í”„ë¡œì„¸ìŠ¤ê°€
        - `0`ê³¼ `1`ì˜ nice valueë¥¼ ê°€ì§„ë‹¤ë©´ -> íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ `100`msì™€ `95`msì— ë§¤í•‘
        - ë‘ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ê°€ ê±°ì˜ ê°€íƒ€ì„œ, í•˜ë‚˜ ì°¨ì´ë‚˜ëŠ” nice value ê°„ ì°¨ì´ê°€ ì‘ë‹¤
        - ê·¸ëŸ¬ë‚˜ nice value `18`ê³¼ `19`ì˜ ì°¨ì´ëŠ” ì–´ë– í•œê°€? -> `10`msì™€ `5`msì— ë§¤í•‘  
        -> 2x íƒ€ì„ìŠ¬ë¼ì´ìŠ¤

    - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìŠ¤ì¼€ì¥´ëŸ¬ì—ì„œ í”„ë¡œì„¸ì„œë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì€ interactive tasksë¥¼ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•˜ê¸¸ ì›í•œë‹¤.  
      - ëŒ€í‘œì ìœ¼ë¡œ I/O-bound í”„ë¡œì„¸ìŠ¤ê°€ ìˆëŠ”ë°, ë¹ ë¥´ê²Œ ì‘ë‹µí•´ì¤Œìœ¼ë¡œì¨ ì¾Œì í•œ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•œë‹¤.
      - ì´ëŸ¬í•œ ì‹œìŠ¤í…œì—ì„œ, í•œê°€ì§€ ìµœì í™” í…Œí¬ë‹‰ì€ "ë°©ê¸ˆ ê¹¨ì–´ë‚œ(woken-up) taskì—ê²Œ ìš°ì„ ê¶Œì„ ì£¼ëŠ” ê²ƒì´ë‹¤.  
      (ë¹„ë¡ íƒ€ì„ ìŠ¬ë¼ì´ìŠ¤ê°€ ë§Œë£Œë˜ì—ˆë”ë¼ê³ , ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ boost ì œê³µ)  
      -> í”„ë¡œì„¸ìŠ¤ê°€ **unfair**í•œ CPU timeì„ ì œê³µë°›ì„ ìˆ˜ ìˆë‹¤.  

    - Motivation  
      - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ ì¬ì„¤ê³„ í•„ìš”
      - Fairness

      <br>

- **Linux Scheduling in Version 2.6.8.1+**
  - **Completely Fair Scheduler (CFS)**
    - fair-share ìŠ¤ì¼€ì¥´ë§ êµ¬í˜„
      - ê° jobì´ **íŠ¹ì • í¼ì„¼í…Œì´ì§€**ì˜ CPU timeì„ ê°–ë„ë¡ ë³´ì¥í•œë‹¤. (not time-slice)
    - íš¨ìœ¨ì ì´ê³  Scalable
      - ë¹ ë¥´ê²Œ ìŠ¤ì¼€ì¥´ë§ ê²°ì •ì„ ë‚´ë¦°ë‹¤. -> use Rbtree (just ê°€ì¥ ì™¼ìª½ ë ë¦¬í”„ë…¸ë“œë¥¼ ê³ ë¥´ëŠ” ë°©ì‹)
    - ìŠ¤ì¼€ì¥´ë§ í¼í¬ë¨¼ìŠ¤ê°€ ì¤‘ìš”
      - Googleì˜ Datacenter CPU timeì˜ 5%ë§Œ ìŠ¤ì¼€ì¥´ë§ì´ ì°¨ì§€í•œë‹¤.  

  - **CFSëŠ” normal processesë¥¼ ìœ„í•œ schedular classë¡œì„œ, Linuxì—ì„œ `SCHED_NORMAL`ë¼ê³  ë¶ˆë¦°ë‹¤.**  
  `kernel/sched/fair.c`  

  - **CFS Operation Basics**
    - ëª¨ë“  competing í”„ë¡œì„¸ìŠ¤ê°€ CPUë¥¼ evení•˜ê²Œ ê³µí‰í•˜ê²Œ ë‚˜ëˆ„ëŠ” ê²ƒ
      - ê³ ì •ëœ time sliceë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ 
    - í”„ë¡œì„¸ìŠ¤ì˜ "**virtual runtime**(vruntime)"ì„ ì‚¬ìš©í•œë‹¤.  
      - í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í•¨ì— ë”°ë¼ ëˆ„ì ëœë‹¤.
        - ì™œ?
        - Considering
          - Switching cost
          - Overhead of swap-out / in
          - the effects on caches
      - í”„ë¡œì„¸ìŠ¤ë¥¼ ìŠ¤ì¼€ì¥´ë§ í•  ë•Œ, ê°€ì¥ ì‘ì€ vruntimeì„ ê³ ë¥´ë©´ ëœë‹¤.

    - ì–¸ì œ ìŠ¤ì¼€ì¥´ë§í•˜ëŠ”ê°€?
      - ìŠ¤ìœ„ì¹­ì„ ìì£¼ í•˜ë©´ fairnessë¥¼ í–¥ìƒì‹œí‚¤ì§€ë§Œ overheadê°€ ì»¤ì§
      - ìŠ¤ìœ„ì¹­ì„ ì ê²Œ í•˜ë©´ ì„±ëŠ¥ì´ í–¥ìƒë˜ì§€ë§Œ fairnessë¥¼ ëŒ€ê°€ë¡œ í•¨

    - `sysctl_sched_latency` íŒŒë¼ë¯¸í„°ì— ì˜í•´ ì»¨íŠ¸ë¡¤ ëœë‹¤. (upperbound)
      - A.k.a., `target latency`  
      ![sysctl_sched_latency][def47]  
      - Maximum time : í”„ë¡œì„¸ìŠ¤ê°€ ìŠ¤ìœ„ì¹­í•˜ê¸° ì „ ë™ì‘ ê°€ëŠ¥í•œ ì‹œê°„ (e.g., `20`ms)  
      - ì´ ì‹œê°„ì€ í”„ë¡œì„¸ìŠ¤ê°€ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì–»ê¸° ìœ„í•´, ì‹¤í–‰ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ì˜ ê°œìˆ˜ë¡œ ë‚˜ëˆ„ì–´ì§„ë‹¤.
      - CFSëŠ” ì´ time periodì— ìˆì–´ completely fairí•  ê²ƒì´ë‹¤.

  - **CFS Example**
    - `sysctl_sched_latency` = `48`ms
    - ë„¤ ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰í•  ì¤€ë¹„ê°€ ë˜ì–´ìˆë‹¤.
      - ê° í”„ë¡œì„¸ìŠ¤ì˜ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ëŠ” `12`ms
      - `vruntime`ì€ `0`ì—ì„œ ì‹œì‘
    - ê°€ì¥ ì‘ì€ `vruntime`ì„ ê°€ì§„ jobì„ ì„ íƒ (ì´ ê²½ìš°, `A`, `B`, `C`, `D`)
    -  job `A`ë¥¼ `vruntime`ì´ `12`msê°€ ë  ë•Œê¹Œì§€ ì‹¤í–‰
      - ê·¸ë¦¬ê³ ëŠ” ìŠ¤ì¼€ì¥´ë§ ê²°ì •ì„ ë‚´ë¦°ë‹¤.
      - ë‹¤ìŒ ê°€ì¥ ì‘ì€ `vruntime`ì„ ê°€ì§„ jobì„ ì„ íƒ (ì´ ê²½ìš°, `B`, `C`, `D`)
    - `C`ì™€ `D`ê°€ real time `96`msì— ëë‚¬ë‹¤ë©´,  
      - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ê°€ `24`ms (`48`/`2`)  
    ![cfs_example][def48]  

    <br>

  - **Too many processes runnable?**
    - ê° í”„ë¡œì„¸ìŠ¤ì˜ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ëŠ” `sysctl_sched_latency` / ì‹¤í–‰ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ ìˆ˜
      - ë§ì€ ìˆ˜ì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ì‘ì€ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¡œ ì—°ê²°ëœë‹¤.
        - ì´ëŠ” ê³§ ë” ë§ì€ context switchì™€ ë” ë§ì€ overhead

    - "`sysctl_sched_min_granularity`" íŒŒë¼ë¯¸í„° (lower bound)
      - í”„ë¡œì„¸ìŠ¤ì˜ ìµœì†Œ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì •ì˜ (e.g., `6`ms)
      - CFSëŠ” ì ˆëŒ€ ì´ ê°’ë³´ë‹¤ ì‘ì€ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.
      - ì´ ê²½ìš°, CFSëŠ” **ì™„ë²½í•˜ê²Œ fairí•˜ì§€ ì•Šì„ ìˆ˜ë„** ìˆë‹¤.
        - e.g., `sysctl_sched_latency` = `48`ms ì´ë©° `10`ê°œì˜ ì‹¤í–‰ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ê°€ ìˆë‹¤ë©´
        - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ `4.8` -> `6`ms ë¡œ ì„¤ì • (lower boundì— ì˜í•´)
        - ëª¨ë“  jobë“¤ì´ `48`ms ë‚´ì— ëë‚˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.  
      ![sysctl_sched_min_granularity][def47]

<br>

  - **Niceness levels**
    - ì‚¬ìš©ìì—ê²Œ í”„ë¡œì„¸ìŠ¤ ìš°ì„ ìˆœìœ„ì— ëŒ€í•œ ì»¨íŠ¸ë¡¤ì„ ì œê³µ
      - ëª‡ëª‡ í”„ë¡œì„¸ìŠ¤ì— ë” ë†’ì€ CPU shareë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤.

    - í”„ë¡œì„¸ìŠ¤ì˜ **nice** ë ˆë²¨
      - jobì´ ì–¼ë§ˆë‚˜ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë“¤ì— ëŒ€í•´ nice í•œ ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì²™ë„ (introduced before)
      - `19` (ê°€ì¥ ë‚®ì€ ìš°ì„ ìˆœìœ„)
      - `-20` (ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„)

    - **[updated] Nice levelì´ í”„ë¡œì„¸ì„œì— ìˆì–´ íš¨ìœ¨ì ì¸ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ê³„ì‚°í•˜ëŠ”ë° ì‚¬ìš©ëœ ê°€ì¤‘ì¹˜(weight)ì— ë§¤í•‘ëœë‹¤.**  

  - **Niceness Weightings**  
  ![niceness_weightings][def49]  
    - ëª¨ë“  nice value ë³€í™”ì— ë”°ë¼ `10`% ì •ë„ì˜ ë³€í™”ê°€ ì¡´ì¬í•œë‹¤. (`0` ~ `39`)
      - í•œ ë‹¨ê³„ ì˜¬ë¼ê°€ë©´, `-10`%ì˜ CPU ì‚¬ìš©ëŸ‰
      - í•œ ë‹¨ê³„ ë‚´ë ¤ê°€ë©´, `+10`&ì˜ CPU ì‚¬ìš©ëŸ‰ 
    ![timeslice_weightings][def50]  

  - **Niceness Weightings Example**
    - ë‘ í”„ë¡œì„¸ìŠ¤ `A`ì™€ `B`ê°€ ìˆì„ ë•Œ,
      - `A`ì˜ niceness levelì€ `-5` (boost in priority)  
      - `B`ì˜ niceness levelì€ `0` (default)
    - `A`ì™€ `B`ì— ëŒ€í•œ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ ê³„ì‚°
      - weight `A` : `3121`, weight `B` : `1024`, total weight : `4145`
      - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ `A` : `3121`/`4145` = `0.753` * `sysctl_sched_latency`
      - íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ `B` : `1024`/`4145` = `0.247` * `sysctl_sched_latency`  
    - `48`ms `sysctl_sched_latency`ë¥¼ ê°€ì •í•˜ë©´,
      - `A`ëŠ” ì•½ `75`%ì˜ `sysctl_sched_latency`ë¥¼ ê°€ì§
      - `B`ëŠ” ì•½ `25`%ì˜ `sysctl_sched_latency`ë¥¼ ê°€ì§

    - Example  
    ![niceness_weightings_example][def51]  
      - ì¦‰, CPU timeì€ weight ë¿ë§Œ ì•„ë‹ˆë¼ RQ ë‚´ í”„ë¡œì„¸ìŠ¤ì˜ ê°œìˆ˜ì—ë„ ì˜ì¡´í•œë‹¤.  

    <br>

  - **Calculating vruntime**
    - ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ í”„ë¡œì„¸ì„œê°€ ë” ê¸´ íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ë¥¼ ê°–ëŠ”ë‹¤.
    - í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ë‹¤ìŒ ì‹¤í–‰í•  í”„ë¡œì„¸ìŠ¤ë¡œì„œ `vruntime`ì´ ê°€ì¥ ì‘ì€ ê²ƒì„ ê³ ë¥¸ë‹¤.
      - ìš°ì„ ìˆœìœ„ë¥¼ ì ì ˆí•˜ê²Œ ë‹¤ë£¨ê¸° ìœ„í•´, `vruntime`ì€ ë°˜ë“œì‹œ ìš°ì„ ìˆœìœ„ì™€ ë°˜ë¹„ë¡€í•´ì•¼í•œë‹¤.
    - ì´ì „ Exampleì—ì„œ,
      - `A`ì˜ `vruntime`ì€ `B`ì˜ ì•½ `1/3`ìœ¼ë¡œ ëˆ„ì ë˜ì–´ì•¼í•œë‹¤.  
      ![vruntime_of_a][def52]  

      - `weight`ì´ ë†’ì„ ìˆ˜ë¡, ìš°ì„ ìˆœìœ„ê°€ ë‚®ì„ ê²ƒì´ë‹¤.  

    <br>

  - **CFS efficiency**
    - ìŠ¤ì¼€ì¥´ëŸ¬ëŠ” ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ ë‹¤ìŒìœ¼ë¡œ ì‹¤í–‰í•  jobì„ ì°¾ì„ ìˆ˜ ìˆì„ê¹Œ?  
      - ë¦¬ìŠ¤íŠ¸ ìë£Œêµ¬ì¡°ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ìˆ˜ì²œ ê°œ ìˆì„ ë•Œ millisecond ë‚´ì— íƒìƒ‰í•˜ê¸° ì¢‹ì§€ ì•Šì„ ê²ƒì´ë‹¤.

    - CFSëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ **red-black tree** ì— ìœ ì§€í•œë‹¤.  
      - balanced treeì˜ ì¼ì¢…
      - low depthë¥¼ ìœ ì§€í•˜ëŠ” ë° í¬ê²Œ ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤
      - ê° ì—°ì‚° (search, insert, delete)ì— `O(log n)`
    ![red_black_tree][def53]  
    ![struct_cfs_rq][def54]  

    - CFSëŠ” ì´ íŠ¸ë¦¬ êµ¬ì¡° ë‚´ì—ì„œ ì˜¤ì§ ì‹¤í–‰ì¤‘ì¸/ì‹¤í–‰ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ë§Œ ìœ ì§€/ê´€ë¦¬í•œë‹¤.
      - ë§Œì•½ í”„ë¡œì„¸ìŠ¤ê°€ I/Oì—ì„œ ëŒ€ê¸° ì¤‘ì´ë¼ë©´, íŠ¸ë¦¬ì—ì„œ ì‚­ì œë˜ê³  ì–´ë”˜ê°€ì—ì„œ ê³„ì† track ë  ê²ƒì´ë‹¤.
      - í”„ë¡œì„¸ìŠ¤ê°€ ê¹¨ì–´ë‚˜ë©´(wakes up) ë¬´ì—‡ì„ í• ê¹Œ?
        - `vruntime`ì´ ë‹¤ë¥¸ ê²ƒë“¤ ë³´ë‹¤ ë’¤ì²˜ì§ˆ ê²ƒì´ë©°, CPUë¥¼ ë…ì í•  ê²ƒì´ë‹¤.
        - CFSëŠ” í•´ë‹¹ jobì˜ `vruntime`ì„ íŠ¸ë¦¬ì—ì„œ ì°¾ì€ ìµœì†Ÿê°’ìœ¼ë¡œ ì„¤ì •í•  ê²ƒì´ë‹¤.  
        ![vruntime_wake_up][def55]

<br>

  - **Linux CFS Summary**
    - í˜„ì¡´í•˜ëŠ” ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ” fair-share ìŠ¤ì¼€ì¥´ëŸ¬
    - ì•½ê°„ weighted round-robin with dynamic time-slice ê°™ì€ ê²ƒì´ë‹¤.
    - í™•ì¥ì„±ê³¼ ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥

<br>
<br>
<br>
<br>
<details>
<summary>ì£¼ì˜ì‚¬í•­</summary>
<div markdown="1">  

ì´ í¬ìŠ¤íŒ…ì€ ê°•ì›ëŒ€í•™êµ ì†¡ì›ì¤€ êµìˆ˜ë‹˜ì˜ ìš´ì˜ì²´ì œ ìˆ˜ì—…ì„ ë“¤ìœ¼ë©° ë‚´ìš©ì„ ì •ë¦¬ í•œ ê²ƒì…ë‹ˆë‹¤.  
ìˆ˜ì—… ë‚´ìš©ì— ëŒ€í•œ ì €ì‘ê¶Œì€ êµìˆ˜ë‹˜ê»˜ ìˆìœ¼ë‹ˆ,  
ë‹¤ë¥¸ ê³³ìœ¼ë¡œì˜ ë¬´ë¶„ë³„í•œ ë‚´ìš© ë³µì‚¬ë¥¼ ìì œí•´ ì£¼ì„¸ìš”.  

</div>
</details>

[def]: https://i.imgur.com/0mW82jZ.png
[def2]: https://i.imgur.com/F4Jvquc.png
[def3]: https://i.imgur.com/1rddWL9.png
[def4]: https://i.imgur.com/6gqa7gz.png
[def5]: https://i.imgur.com/rHzeWTO.png
[def6]: https://i.imgur.com/V5bKxVL.png
[def7]: https://i.imgur.com/r20nfYp.png
[def8]: https://i.imgur.com/4PuAZxJ.png
[def9]: https://i.imgur.com/DeVzZOF.png
[def10]: https://i.imgur.com/GbnmRhb.png
[def11]: https://i.imgur.com/RZR1JEN.png
[def12]: https://i.imgur.com/4iqnLfv.png
[def13]: https://i.imgur.com/N3G5DDh.png
[def14]: https://i.imgur.com/PKoxhLl.png
[def15]: https://i.imgur.com/NXp3zSL.png
[def16]: https://i.imgur.com/raTnO6t.png
[def17]: https://i.imgur.com/u47CeYi.png
[def18]: https://i.imgur.com/ABdsb17.png
[def19]: https://i.imgur.com/aMpUt1C.png
[def20]: https://i.imgur.com/jTyQJWq.png
[def21]: https://i.imgur.com/A1RsMH1.png
[def22]: https://i.imgur.com/K6ZyQzy.png
[def23]: https://i.imgur.com/BnbXcKD.png
[def24]: https://i.imgur.com/mfmpIlQ.png
[def25]: https://i.imgur.com/84bmman.png
[def26]: https://i.imgur.com/vEHR12e.png
[def27]: https://i.imgur.com/L7rm7YO.png
[def28]: https://i.imgur.com/YOc8tiy.png
[def29]: https://i.imgur.com/DSAZH5p.png
[def30]: https://i.imgur.com/up3dI0K.png
[def31]: https://i.imgur.com/jrVC2Jv.png
[def32]: https://i.imgur.com/hiVlxYy.png
[def33]: https://i.imgur.com/gOPoQrJ.png
[def34]: https://i.imgur.com/n1HJ8Bc.png
[def35]: https://i.imgur.com/4ai5Vqc.png
[def36]: https://i.imgur.com/ISqcdXu.png
[def37]: https://i.imgur.com/b50S6BC.png
[def38]: https://i.imgur.com/Lq2UQQR.png
[def39]: https://i.imgur.com/zepyurh.png
[def40]: https://i.imgur.com/yu5Yd05.png
[def41]: https://i.imgur.com/R5Udbwt.png
[def42]: https://i.imgur.com/a7UodzF.png
[def43]: https://i.imgur.com/ONbbjVb.png
[def44]: https://i.imgur.com/DwevK7x.png
[def45]: https://i.imgur.com/TuthGlN.png
[def46]: https://i.imgur.com/WyT9rWa.png
[def47]: https://i.imgur.com/7q3qnCW.png
[def48]: https://i.imgur.com/3zCbT6D.png
[def49]: https://i.imgur.com/eWPCiV1.png
[def50]: https://i.imgur.com/xzOqiLR.png
[def51]: https://i.imgur.com/VKwze7R.png
[def52]: https://i.imgur.com/kntxR6o.png
[def53]: https://i.imgur.com/osgWNDw.png
[def54]: https://i.imgur.com/7an2qF4.png
[def55]: https://i.imgur.com/BXpI3OJ.png