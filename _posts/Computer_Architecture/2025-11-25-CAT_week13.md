---
layout: post
title: "[컴퓨터구조] 13주차 - MIPS Microarchitecture (Multi-cycle)"
excerpt: "Introduction, Control Unit, Main Controller FSM, Multi-Cycle Processor Datapath, Further Information, A Simple Little Computer 3b"

tags:
  - [컴퓨터구조]

toc: true

date: 2025-11-25
last_modified_at: 2025-12-02
---
## MIPS Microarchitecture (Multi-cycle)
### 1. Instroduction
- Multi-cycle Microarchitecture의 목표 : 각 instruction들이 실제로 필요로 하는 시간 만큼만 오직 사용하도록 하는 것

- Multi-cycle Design의 Benefits
  - Critical path design : 어떠한 명령어의 worst-case processing time에 독립적으로 critical path를 설계할 수 있다.
  - 빵과 버터 (common case) 디자인
    - 가장 중요한 곳에 시간과 리소스를 투자할 수 있다. (즉, machine이 정말로 하고자 하는 일을 향상시킬 수 있다.)
    - Common case vs. Uncommon case Example : ADD vs. DIV
  - 균형잡힌 디자인
    - 리소스 `X`를 여러번 필요로 하는 명령어가 구현되기 위해서 `X`를 여러번 복제할 필요가 없다.
    - 더 효율적인 하드웨어로 이어짐 : 명령어에 여러번 필요한 하드웨어 컴포넌트를 재사용할 수 있다.
    - e.g., multiple ALUs in the single cycle machine  

- Multi-cycle Design의 Downsides
  - 각 clock cycle의 끝에서 **중간 결과를 저장해야 한다.**
    - 레지스터에 있어 하드웨어 오버헤드
    - 하나의 명령어에 레지스터 setup/load 오버헤드가 여러번 발생

<br>

- A Basic Multi-cycle Microarchitecture
  - 명령어 processing cycle은 "states"로 나뉜다.
    - 명령어 처리 사이클이 여러 states를 가질 수 있다.
  - 명령어 처리에 state -> state로의 Multi-cycle microarchitecture sequence
    - 이 행동은 오로지 해당 state의 control signal들에 의해서만 결정된다.
  - 전체 프로세스의 행동은 finite state machine(FSM)에 의해 완전히 구체화된다.
  - State(clock cycle)에서, control signal은 두 가지를 컨트롤한다.
    - 어떻게 **datapath**가 데이터를 처리해야 하는지
    - 어떻게 **다음 clock cycle에 대한 control signal을 생성해야 하는지**

<br>

### 2. Control Unit
![control_unit_multi_cycle][def]

<br>

### 3. Multi-Cycle Processor Datapath  
![multi_cycle_datapath][def10]  

<br>

### 4. Main Controller FSM
- Common FSM
  - (1) Fetch  
  ![fsm_fetch_multi_cycle][def2]  

  - (2) Decode  
  ![fsm_decode_multi_cycle][def3]  

  - (3) Address Calculation  
  ![fsm_address_calculation_multi_cycle][def4]  

- LW FSM  
![fsm_lw_multi_cycle][def5]  

- SW FSM  
![fsm_sw_multi_cycle][def6]  

- R-type FSM  
![fsm_rtype_multi_cycle][def7]  

- BEQ FSM  
![fsm_beq_multi_cycle][def8]  

<br>

- Complete Multi-cycle Controller FSM  
![fsm_complete_multi_cycle][def9]  

<br>

- Main Controller FSM: addi  
![fsm_addi_multi_cycle][def11]  

<br>

### 5. Further Information
- 만약 메모리가 한 사이클 이상 소모한다면 ?
  - 메모리가 데이터를 리턴할 때까지 같은 "memory access" state에 머무른다.
  - "Memory ready?" bit는 control logic에 들어가는, 다음 state를 결정하는 input이다.  

  <br>

- Microprogrammed Control Terminology
  - Microinstruction : 현재 state와 관련된 control signal들의 집합
  - Microsequencing : 한 state에서 다음 state로의 전환. 다음 state와, 이에 대한 microinstruction을 결정하는 것.
  - Control Store : 모든 가능한 state에 대한 control signal을 저장. 즉, 전체 FSM에 대한 microinstructions를 저장.
  - Microsequencer : 다음 clock cycle(즉, 다음 state)에 어던 control signal이 사용될 지를 결정.

<br>

- 한 Clock Cycle 내에서 어떤 일이 일어나는가 ?
  - 현재 state에 대한 control signal(microinstruction)이 두 가지를 컨트롤한다.
    - Datapath 내에서의 processing
    - 다음 cycle에 대한 control signal(microinstruction)의 생성
  - Datapath와 microsequencer는 병렬로 작동한다.
  - 여기서 질문, 현재 cycle에 대한 control signal을 현재 cycle 내에서 생성하는건 왜 안되나 ?
    - 이는 clock cycle을 더 길게 만들 것이다.
    - 왜 ?
      - A Clock cycle  
      ![clock_cycle_good][def12]
      - A Bad Clock cycle  
      ![clock_cycle_bad][def13]  

<br>

### 6. A Simple Little Computer 3b
- An educational ISA  
![simple_little_computer_3b_isa][def14]  
  - 16 bits instruction
  - `opcode [15:12]` : 16 different opcodes  

- Control & Datapath  
![simple_little_computer_3b_datapath][def15]  

- Next-State Control Signals를 결정하는 것은?
  - 현재 clock cycle에서 일어나는 일
    - "Control" block에서 오는 9 control signals을 본다.
  - 실행될 명령어
    - `IR` = Instruction Register (즉, PC)
    - Data Path에서 오는 `IR[15:12]`  
  - 만약 처리된 명령어가 branch라면, branch의 조건
    - `BEN` = Branch Enable (0: deasserted, 1: asserted)
    - Data Path에서 오는 `BEN` bit
  - 만약 처리중이라면, 현재 cycle에서 수행되고 있는 memory operation
    - `R` = Ready
    - Memory에서 오는 `R` bit

  <br>

- Multi-Cycle processing을 위한 State machine
  - Little Computer 3b uArch의 behavior는 순전히 아래에 의해 결정된다.
    - 35개의 control signals
    - control logic으로 들어가는 추가적인 7 bits

  - 35개의 control signal들은 control structure의 상태를 완전하게 정의한다.  

  - 우리는 Little Computer 3b의 behavior를 정의하는 state machine을 설계할 수 있다. 즉, 각 상태에 대응되는 노드와, 각 상태에서 다음 상태로의 flow를 보여주는 Arcs로 구성된 Directed graph로.  

<br>

- Little Computer 3b의 Datapath  
![simple_little_computer_3b_datapath_full][def16]  
  - Single bus datapath design
    - 어느 포인트에서든, 오직 하나의 value만이 bus에 올라올 수 있다.  
    - 장점 : 적은 하드웨어 비용 (하나의 bus)
    - 단점 : Concurrency의 감소 - 만약 명령어가 bus를 두 번 필요로 한다면, 서로 다른 state에서 일어나야 한다.  

  - Control signals는 datapath에서 한 clock cycle 내에서 일어나는 일을 결정한다.  
    
  <br>

  - Microprogrammed Control Structure  
  ![simple_little_computer_3b_microprogrammed_control](TODO)  
    - 세 가지 구성요소 : Microinstruction, Control Store, Microsequencer
    - **Microinstruction** : Datapath를 컨트롤하고, 다음 state를 결정하도록 돕는 control signal들의 집합
    - 각 mircor instruction은 **control store** 내 unique location에 저장된다.  
      - unique location : microinstruction에 대응되는 상태의 주소
    - **Microsequencer**는 다음 microinstruction의 주소를 결정한다.  

  <br>

- State Machine for LDW  
![simple_little_computer_3b_fsm_ldw][def17]  

<br>

- Exercise in Microprogramming  
![control_signals_and_datapath][def18]  
![exercise_in_microprogramming_1][def19]  
![exercise_in_microprogramming_2][def20]  
![exercise_in_microprogramming_3][def21]  
![exercise_in_microprogramming_4][def22]  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">  

이 포스팅은 강원대학교 송원준 교수님의 컴퓨터구조 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.  

</div>
</details>

[def]: https://i.imgur.com/I9e1wLA.png
[def2]: https://i.imgur.com/EI246bq.png
[def3]: https://i.imgur.com/l02u4tT.png
[def4]: https://i.imgur.com/0EoeDCc.png
[def5]: https://i.imgur.com/MooZJ1e.png
[def6]: https://i.imgur.com/i97UWJ1.png
[def7]: https://i.imgur.com/GR1Q9LJ.png
[def8]: https://i.imgur.com/Hr4HGLt.png
[def9]: https://i.imgur.com/ywgr9Ml.png
[def10]: https://i.imgur.com/E7q59A9.png
[def11]: https://i.imgur.com/W2ObysJ.png
[def12]: https://i.imgur.com/Xy9qNeS.png
[def13]: https://i.imgur.com/rXVG9vd.png
[def14]: https://i.imgur.com/RgKTcbu.png
[def15]: https://i.imgur.com/XxodAAS.png
[def16]: https://i.imgur.com/JlFzIcx.png
[def17]: https://i.imgur.com/hjk089I.png
[def18]: https://i.imgur.com/CAyen6D.png
[def19]: https://i.imgur.com/fZvoO42.png
[def20]: https://i.imgur.com/4ohYlsy.png
[def21]: https://i.imgur.com/v1SpEhA.png
[def22]: https://i.imgur.com/EomGIiI.png