---
layout: post
title: "[컴퓨터구조] 4주차 - Performance III"
excerpt: "Run-time Variations"

tags:
  - [컴퓨터구조]

toc: true

date: 2025-09-23
last_modified_at: 2025-09-24
---
## Performances
### 1. Run-time Variations  
- 더 실제 환경에서의 평가
  - 여러 워크로드, multi-threaded 워크로드
  - "History-Based Arbitration for Fairness in Processor-Interconnect of NUMA Servers", Wonjun Song et al., ASPLOS  
  ![run_time_variations][def]  

- Noise의 원인을 최소화하려면..
  - Linux와 BIOS 모두에서 DVFS (or CPU frequency scaling) 비활성화  
    - e.g., performance governor in Linux (performance, powersave, ondemand)  
    - `/sys/devices/system/cpu/cpu*/cpufreq/scaling_governor`  
  - SMT (a.k.a. HT) 비활성화 (SMT : Simultaneous Multi-Threading, HT : Hyper-Threading)  
  - Linux scheduling policy를 `SCHED_FIFO`로 설정
    - `GRUB_CMDLINE_LINUX_DEFAULT="isolcpus=0,1"`
    - 아래를 grub parameter로 추가  
    ![isolcpus][def2]  
  - 워크로드 생성 후 특정 코어에 바인딩 (pin, 마이그레이션 비활성화)  
  - 워크로드 여러 번 실행 후 평균값 계산  
    - `perf`는 같은 워크로드를 여러 번 실행하는 기능을 지원하고, 각 카운트 값의 평균과 표준편차를 제공  
    ![perf_stat][def3]  

<br>

### 2. Profiling
- perf tool은 성능 수집 및 분석과 데이터 추적을 위한 풍부한 명령어 세트를 제공
  - `stat`, `record`, `report` 등

- `$ perf record -h`
  - 명령어를 실행하고 프로파일을 `perf.data` 파일에 기록  

- `$ perf report -h`  
  - `perf.data` 파일을 읽고 프로파일을 디스플레이  

- Profiling Example  
![perf_example_1](TODO)  
![perf_example_2](TODO)  

- Perf 결과 시각화  
  - Flame, Pprof, Hotspot 등  
  - Example on Flame  
  ![perf_flamegraph](TODO)  

- Profiling Example (cont'd)  
![perf_example_3](TODO)  

- 프로그램의 개선  
![improved_program](TODO)  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">  

이 포스팅은 강원대학교 송원준 교수님의 컴퓨터구조 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.  

</div>
</details>

[def]: https://i.imgur.com/cpafTdj.png
[def2]: https://i.imgur.com/xCqa4Bf.png
[def3]: https://i.imgur.com/Kux8Mog.png