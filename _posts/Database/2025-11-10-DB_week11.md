---
layout: post
title: "[데이터베이스] 11주차 - 정규화"
excerpt: "이상현상, 함수 종속성, 정규화"

tags:
  - [데이터베이스]

toc: true

date: 2025-11-10
last_modified_at: 2025-11-13
---
## 정규화
### 1. 이상현상
- 잘못 설계된 데이터베이스는 이상현상(anomaly)을 초래할 수 있다.  
![anomaly_example][def]  
  - 삭제이상(deletion anomaly)
    - 튜플 삭제 시 같이 저장된 다른 정보까지 연쇄적으로 삭제되는 현상
    - 연쇄 삭제(triggered deletion) 문제 발생

  - 삽입이상(insertion anomaly)
    - 튜플 삽입 시 특정 속성에 해당하는 값이 없어 `NULL`값을 입력해야 하는 현상  
    - `NULL`값 분제 발생

  - 수정이상(update anomaly)
    - 튜플 수정 시 중복된 데이터의 일부만 수정되어 데이터 불일치가 발생하는 현상
    - 불일치(inconsistency) 문제 발생  

<br>

- `Summer` 테이블 생성  

```sql
DROP TABLE Summer;

CREATE TABLE Summer (
    sid NUMBER,
    class VARCHAR2(20),
    price NUMBER,
);

INSERT INTO Summer VALUES (100, 'FORTRAN', 20000);
INSERT INTO Summer VALUES (150, 'PASCAL', 15000);
INSERT INTO Summer VALUES (200, 'C', 10000);
INSERT INTO Summer VALUES (250, 'FORTRAN', 20000);

SELECT * FROM Summer;
```

![summer_table][def2]  

<br>

- 삭제이상
  - `200`번 학생의 계절학기 수강신청을 취소  

  ```sql
  SELECT price 'C 수강료'
  FROM Summer
  WHERE class = 'C';
  ```

  ```sql
  DELETE FROM Summer
  WHERE sid = 200;

  SELECT price 'C 수강료'
  FROM Summer
  WHERE class = 'C';  -- C 수강료 정보 삭제됨
  ```

<br>

- 삽입이상
  - 계절학기에 새로운 자바 강좌 개설

  ```sql
  -- JAVA 강좌 개설 시 수강생이 없어 sid 값을 알 수 없음
  INSERT INTO Summer VALUES (NULL, 'JAVA', 25000);

  SELECT COUNT(*) '수강인원'
  FROM Summer  -- 5

  SELECT COUNT(sid) '수강인원'
  FROM Summer;  -- 4

  SELECT COUNT(*) '수강인원'
  FROM Summer
  WHERE sid IS NOT NULL;  -- 4
  ```

<br>

- 수정이상
  - `FORTRAN` 강좌의 수강료를 `20000`원에서 `15000`원으로 수정

  ```sql
  UPDATE Summer
  SET price = 15000
  WHERE class = 'FORTRAN';  -- 올바른 수정

  UPDATE Summer
  SET price = 15000
  WHERE class = 'FORTRAN' AND sid = 100;  -- 불일치 발생
  ```

<br>

- 수정된 계절학기 수강 테이블  
![summer_table_anomaly][def3]  

<br>

### 2. 함수 종속성
- 학생수강성적 릴레이션의 각 속성 사이에는 의존성이 존재.  
![functional_dependency_example][def4]  
  - 어떤 속성 `A`의 값을 알면 다른 속성 `B`의 값이 유일하게 정해지는 의존 관계를 '속성 `B`는 속성 `A`에 종속한다(dependent)' 혹은 속성 `A`는 속성 `B`를 결정한다(determine)'고 표현.  

- `A` → `B`로 표기하며, `A`를 `B`의 결정자(determinant) 라고 함

- 위 릴레이션에서 종속관계에 있는 예
  - `학생번호` → `학생이름`
  - `학생번호` → `주소`
  - `강좌이름` → `강의실`
  - `학과` → `학과사무실`

- 종속하지 않는 예
  - `학생이름` → `강좌이름`
  - `학과` → `학생번호`
  - `학생이름` → `학과`

- 학생수강성적 릴레이션의 종속관계 시각화  
![functional_dependency_example_graph][def5]  

<br>

- **함수 종속성 다이어그램**(functional dependency diagram)으로 함수 종속성을 나타낼 수 있다.
  - 릴레이션의 속성 : 직사각형
  - 속성 간의 함수 종속성 : 화살표
  - 복합 속성 : 직사각형으로 묶음  
  ![functional_dependency_diagram_example][def6]  

  <br>

- **함수 종속성 규칙**(functional dependency rules, Armstrong's axioms)
  - 부분집합 규칙 : if `Y` ⊆ `X`, then `X` → `Y`
  - 증가 규칙 : if `X` → `Y`, then `XZ` → `YZ`  
  - 이행 규칙 : if `X` → `Y` and `Y` → `Z`, then `X` → `Z`  

<br>

- 함수 종속성과 기본키
  - 릴레이션의 함수 종속성을 파악하기 위해서는 우선 기본키를 찾아야 함.
  - 기본키가 함수 종속성에서 어떤 역할을 하는지 알면, 이상현상을 제거하는 정규화 과정을 쉽게 이해할 수 있음
  - 릴레이션 `R(K, A1, A2, ..., An)`에서 `K`가 기본키이면, `K` → `R`이 성립한다. 즉 기본키는 릴레이션의 모든 속성에 대한 결정자(determinant)이다.  

- 이상현상은 한 개의 릴레이션에 두 개 이상의 정보가 포함되어 있을 때 나타난다.  
즉, **기본키가 아니면서 결정자인 속성이 있을 때 발생한다.**  
![functional_dependency_anomaly_example][def7]  

- 이상현상을 없애려면 릴레이션을 분해한다.
  - 아래는 `(학과, 학과사무실)` 속성을 학생수강성적 릴레이션에서 분리하는 예  
  ![functional_dependency_anomaly_solution_example_1][def8]  
  ![functional_dependency_anomaly_solution_example_2][def9]  
  ![functional_dependency_anomaly_solution_example_3][def10]  

<br>

- 예제 1 - 다음 릴레이션 `R`에서 주어진 함수 종속성이 성립하는지 확인  
![functional_dependency_example_1][def11]  
  - (1) `A` → `B` : 성립하지 않는다. `A`의 `e`에 대해 `B`의 `i`와 `b`가 대응
  - (2) `B` → `C` : 성립한다. `B` 값에 대하여 `C`의 값이 한 개씩만 대응
  - (3) `(B, C)` → `A` : 성립하지 않는다. `(i, f)` 값에 대하여 `e`와 `g`가 대응
  - (4) `(A, B)` → `C` : 성립한다. 모든 튜플의 `(A, B)` 값에 대하여 `C`의 값이 한 개씩만 대응  

<br>

### 3. 정규화
- 정규화(normalization) : 이상현상이 발생하는 릴레이션을 분해하여 이상현상을 제거하는 과정  
![normalization_example][def12]  

- 이상현상이 있는 릴레이션은 이상현상을 일으키는 함수 종속성의 유형에 따라 등급을 나눌 수 있다.
- 릴레이션은 정규형 개념으로 구분하며, 정규형이 높을수록 이상현상이 적다.  
![normal_forms][def13]  

<br>

- 제 1 정규형(1NF)
  - 릴레이션 `R`의 모든 속성 값이 원자값을 가지면, `R`은 제 1 정규형(First Normal Form, 1NF)이다.  
  ![1NF_example_before][def14]  

- 제 2 정규형(2NF)
  - 릴레이션 `R`이 제 1 정규형이고, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속이면, `R`은 제 2 정규형(Second Normal Form, 2NF)이다.  
  - 완전 함수 종속(full functional dependency) : `A`와 `B`가 릴레이션 `R`의 속성이고 `A` → `B` 종속성이 성립할 때, `B`가 `A`의 속성 전체에 함수 종속하고 부분 집합 속성에 함수 종속하지 않을 경우  
    - Before  
    ![2NF_example_before][def15]  
    - After  
    ![2NF_example_after][def16]  

- 제 3 정규형(3NF)  
  - 릴레이션 `R`이 제 2 정규형이고, 기본키가 아닌 속성이 기본키에 비이행적(non-transitive)으로 종속할 때(직접 종속), `R`은 제 3 정규형(Third Normal Form, 3NF)이다.  
  - 이행적 종속 : `A` → `B`이고 `B` → `C`일 때, `A` → `C`  
    - Before  
    ![3NF_example_before][def17]   
    - After  
    ![3NF_example_after][def18]  

- BCNF(Boyce-Codd Normal Form)
  - 릴레이션 `R`에서 함수 종속성 `X` → `Y`가 성립할 때 모든 결정자 `X`가 후보키이면, `R`은 BCNF이다.  
    - Before  
    ![BCNF_example_before][def19]   
    - After  
    ![BCNF_example_after][def20]  

- 무손실 분해(lossless-join decomposition)
  - 릴레이션 `R`을 릴레이션 `R1`, `R2`로 분해할 때, `R1` ⨝ `R2` = `R`이면 무손실 분해.
  - `R1` ∩ `R2` → `R1` 또는 `R1` ∩ `R2` → `R2` 중 하나를 만족해야 한다.  
  ![lossless_decomposition_example][def21]  
  - 위 특강수강 릴레이션의 분해  
  ![lossless_decomposition_example_solution][def22]  
    - [분해 1]의 경우 `R1`, `R2`를 다시 조인하면 원래 릴레이션이 된다.
    - [분해 2]의 경우 `R3`, `R4`를 다시 조인하면 원래 릴레이션이 되지 않는다.  
    ![lossless_decomposition_example_solution_invalid][def23]  

<br>          
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 최황규 교수님의 데이터베이스 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/7Fc1gux.png
[def2]: https://i.imgur.com/eUymPrk.png
[def3]: https://i.imgur.com/GsjfyZe.png
[def4]: https://i.imgur.com/Fph7kHC.png
[def5]: https://i.imgur.com/3pQGFMa.png
[def6]: https://i.imgur.com/Q1cru1u.png
[def7]: https://i.imgur.com/kP72oz2.png
[def8]: https://i.imgur.com/Il3iIB8.png
[def9]: https://i.imgur.com/Of0fzce.png
[def10]: https://i.imgur.com/BTOqhFY.png
[def11]: https://i.imgur.com/w8VKis6.png
[def12]: https://i.imgur.com/Q6sR1wY.png
[def13]: https://i.imgur.com/xYAwY4W.png
[def14]: https://i.imgur.com/unDNr4x.png
[def15]: https://i.imgur.com/M7QkYg9.png
[def16]: https://i.imgur.com/lj9bjwz.png
[def17]: https://i.imgur.com/IreR0zT.png
[def18]: https://i.imgur.com/RYWDDHE.png
[def19]: https://i.imgur.com/NV2tXrY.png
[def20]: https://i.imgur.com/E2rdX34.png
[def21]: https://i.imgur.com/tZdWivK.png
[def22]: https://i.imgur.com/bUz6O4z.png
[def23]: https://i.imgur.com/iGMRyVA.png