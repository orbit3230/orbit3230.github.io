---
layout: post
title: "[데이터베이스] 3주차 - SQL 기초"
excerpt: "SQL 소개, 데이터 조작어, 데이터 정의어"

tags:
  - [데이터베이스]

toc: true

date: 2025-09-22
last_modified_at: 2025-09-25
---
## SQL 기초
### 1. SQL 소개
- SQL을 이용해 자료를 찾는 과정  
![sql_process][def]  

<br>

- SQL과 일반 프로그래밍 언어의 차이점  

|구분|SQL|일반 프로그래밍 언어|  
|---|---|---|  
|용도|데이터베이스에서 데이터를 추출하여 문제 해결|모든 문제 해결|  
|입출력|입력은 테이블, 출력도 테이블|모든 형태의 입출력 가능|  
|번역|DBMS|컴파일러|  
|문법|`SELECT *`<br>`FROM Book;`|`int main()`<br>``{...}`|  

<br>

- SQL 기능에 따른 분류  
  - 데이터 정의어(DDL)
    - 테이블이나 관계의 구조를 생성하는 데 사용
    - `CREATE`, `ALTER`, `DROP`
  - 데이터 조작어(DML)
    - 테이블에 데이터를 검색, 삽입, 수정, 삭제하는 데 사용
    - `SELECT`, `INSERT`, `UPDATE`, `DELETE`
      - `SELECT`문은 특별히 질의어(query)라고 함
  - 데이터 제어어(DCL)
    - 데이터의 사용 권한을 관리하는 데 사용
    - `GRANT`, `REVOKE`  

![sql_classification][def2]  

<br>

- Example  

```sql
SELECT Goals
FROM Player
WHERE name='Ronaldo';
```  

<br>

### 2. 데이터 조작어 - 검색
- `SELECT`문 : 테이블에서 데이터를 검색하는 데 사용
  - 구성요소  
  ![select_statement][def3]  

  - 기본 문법  

  ```sql
  SELECT  [ALL | DISTINCT] 속성이름(들)
  FROM  테이블이름(들)
  [WHERE  검색조건(들)]
  [GROUP BY  속성이름(들)]
  [HAVING  그룹검색조건(들)]
  [ORDER BY  속성이름(들) [ASC | DESC]];
  ```

  - Example 1 - 모든 도서의 이름과 가격 검색

  ```sql
  SELECT  bookname, price
  FROM  Book;
  ```

  ```sql
  SELECT  price, bookname
  FROM  Book;
  ```

  - Example 2 - 모든 도서의 도서번호, 도서이름, 출판사, 가격 검색 (모두)

  ```sql
  SELECT  bookid, bookname, publisher, price
  FROM  Book;
  ```

  ```sql
  SELECT  *
  FROM  Book;
  ```

  - 도서 테이블에 있는 모든 출판사를 검색 (중복제거)  

  ```sql
  SELECT DISTINCT  publisher
  FROM  Book;
  ```

  <br>

  - `WHERE` 절에 조건으로 사용할 수 있는 술어  

  |술어|연산자|사용 예|
  |---|---|---|
  |비교|`=`, `<>`(같지 않음), `<`, `>`, `<=`, `>=`|`price > 20000`|
  |범위|`BETWEEN`|`price BETWEEN 15000 AND 30000`|
  |집합|`IN`, `NOT IN`|`price IN (15000, 20000, 25000)`|
  |패턴|`LIKE`|`bookname LIKE 'Cristiano Ronaldo`|
  |NULL|`IS NULL`, `IS NOT NULL`|`price IS NULL`|
  |복합조건|`AND`, `OR`, `NOT`|`price > 20000 AND bookname LIKE 'Christiano Ronaldo'`|

  - Example 3 - 가격이 20000원 미만인 도서를 검색  

  ```sql
  SELECT  *
  FROM  Book
  WHERE  price < 20000;
  ```

  - Example 4 - 가격이 10000원 이상 20000원 이하인 도서를 검색  

  ```sql
  SELECT  *
  FROM  Book
  WHERE  price BETWEEN 10000 AND 20000;
  ```

  ```sql
  SELECT  *
  FROM  Book
  WHERE  price >= 10000 AND price <= 20000;
  ```

  - Example 5 - 출판사가 'Manchester United' 혹은 'Real Madrid'인 도서를 검색  

  ```sql
  SELECT  *
  FROM  Book
  WHERE  publisher IN ('Manchester United', 'Real Madrid');
  ```

  - Example 6 - 'Christiano Ronaldo'를 출간한 출판사를 검색  

  ```sql
  SELECT  bookname, publisher
  FROM  Book
  WHERE  bookname LIKE 'Christiano Ronaldo';
  ```

  - Example 7 - 도서이름에 'Ronaldo'가 포함된 출판사를 검색  

  ```sql
  SELECT bookname, publisher
  FROM Book
  WHERE bookname LIKE '%Ronaldo%';
  ```

  - Example 8 - 도서이름의 왼쪽 두 번째 위치에 '날'이라는 글자가 포함된 도서를 검색  

  ```sql
  SELECT *
  FROM Book
  WHERE bookname LIKE '_날%';
  ```

  - Example 9 - 'Ronaldo'가 포함된 도서 중 가격이 20000원 이상인 도서를 검색  

  ```sql
  SELECT *
  FROM Book
  WHERE bookname LIKE '%Ronaldo%' AND price >= 20000;
  ```

  - Example 10 - 출판사가 'Manchester United' 혹은 'Real Madrid'인 도서를 검색  

  ```sql
  SELECT *
  FROM Book
  WHERE publisher='Manchester United' OR publisher='Real Madrid';
  ```

<br>

  - 검색 결과의 정렬 : `ORDER BY` 절

  - Example 11 - 도서를 이름 순으로 검색  

  ```sql
  SELECT *
  FROM Book
  ORDER BY bookname;
  ```

  - Example 12 - 도서를 가격순으로 검색하고, 가격이 같으면 이름 순으로 검색

  ```sql
  SELECT *
  FROM Book
  ORDER BY price, bookname;
  ```

  - Example 13 - 도서를 가격의 내림차순으로 검색하고, 가격이 같으면 출판사의 오름차순으로 검색

  ```sql
  SELECT *
  FROM Book
  ORDER BY price DESC, publisher ASC;
  ```
  
    - `ASC`는 생략 가능 (default)  

  <br>

  - 집계 함수 : `COUNT`, `SUM`, `AVG`, `MAX`, `MIN`  

  |집계 함수|문법|사용 예|
  |---|---|---|
  |SUM|`SUM([ALL / DISTINCT] 속성이름)`|`SUM(price)`|
  |AVG|`AVG([ALL / DISTINCT] 속성이름)`|`AVG(price)`|
  |COUNT|`COUNT([ALL / DISTINCT] 속성이름 / *)`|`COUNT(*)`|
  |MAX|`MAX([ALL / DISTINCT] 속성이름)`|`MAX(price)`|
  |MIN|`MIN([ALL / DISTINCT] 속성이름)`|`MIN(price)`|

  - Example 14 - 고객이 주문한 도서의 총 판매액  

  ```sql
  SELECT SUM(saleprice)
  FROM Orders;
  ```

  - Example 15 - 2번 `Ronaldo` 고객이 주문한 도서의 총 판매액  

  ```sql
  SELECT SUM(saleprice) AS Total_Sales
  FROM Orders
  WHERE custid = 2;
  ```

    - `AS`를 사용하여 의미있는 열 이름으로 변경 가능  

  - Example 16 - 고객이 주문한 도서의 총 판매액, 평균값, 최저가, 최고가  

  ```sql
  SELECT SUM(saleprice) AS Total_Sales,
         AVG(saleprice) AS Average_Sales,
         MIN(saleprice) AS Minimum_Sales,
         MAX(saleprice) AS Maximum_Sales
  FROM Orders;
  ```

  - Example 17 - 총 도서 판매 건수  

  ```sql
  SELECT COUNT(*)
  FROM Orders;
  ```

  <br>

  - 속성의 그룹화 : `GROUP BY` 절  

  - Example 18 - 고객별 주문한 도서의 총 수량과 총 판매액  

  ```sql
  SELECT custid, COUNT(*) AS Total_Books, SUM(saleprice) AS Total_Sales
  FROM Orders
  GROUP BY custid;
  ```

  ![group_by_example](TODO)  

  - `HAVING` 절 : `GROUP BY` 절로 그룹화된 결과에 조건을 지정하는 데 사용  

  - Example 19 - 가격이 `8000`원 이상인 도서를 구매한 고객에 대하여 고객별 주문 도서의 총 수량. 단, 두 권 이상 구매한 고객만 검색  

  ```sql
  SELECT custid, COUNT(*) AS Total_Books
  FROM Orders
  WHERE saleprice >= 8000
  GROUP BY custid
  HAVING COUNT(*) >= 2;
  ```

  - `GROUP BY` 절과 `HAVING` 절의 문법과 주의사항  
  ![group_by_having](TODO)  

  <br>

- 두 개 이상의 테이블에서 SQL 질의
  - `Customer` 테이블과 `Orders` 테이블을 조건 없이 연결 (카티션 프로덕트)  

  ```sql
  SELECT *
  FROM Customer, Orders;
  ```

  - **조인** (내부조인)
    - Example 20 - 고객과 고객의 주문에 관한 데이터를 모두 검색 (equi join)  

    ```sql
    SELECT *
    FROM Customer, Orders
    WHERE Customer.custid = Orders.custid;
    ```

    - Example 21 - 고객과 고객의 주문에 관한 데이터를 고객번호 순으로 정렬

    ```sql
    SELECT *
    FROM Customer, Orders
    WHERE Customer.custid = Orders.custid
    ORDER BY Customer.custid;
    ```

    - Example 22 - 고객의 이름과 고객이 주문한 도서의 판매가격을 검색

    ```sql
    SELECT name, saleprice
    FROM Customer, Orders
    WHERE Customer.custid = Orders.custid;
    ```

    - Example 23 - 고객별로 주문한 모든 도서의 총 판매액을 구하고, 고객별로 정렬

    ```sql
    SELECT name, SUM(saleprice)
    FROM Customer, Orders
    WHERE Customer.custid = Orders.custid
    GROUP BY Customer.name
    ORDER BY Customer.name;
    ```

    - Example 24 - 고객의 이름과 고객이 주문한 도서의 이름 검색

    ```sql
    SELECT Customer.name, Book.bookname
    FROM Customer, Orders, Book
    WHERE Customer.custid = Orders.custid AND Orders.bookid = Book.bookid;
    ``` 

    - Example 25 - 가격이 `20000`원인 도서를 주문한 고객의 이름과 도서의 이름 검색

    ```sql
    SELECT Customer.name, Book.bookname
    FROM Customer, Orders, Book
    WHERE Customer.custid = Orders.custid AND Orders.bookid = Book.bookid AND Book.price = 20000;
    ```

- **조인** (외부조인)
  - Example 26 - 도서를 구매하지 않은 고객을 포함하여 고객의 이름과 고객이 주문한 도서의 판매가격을 검색  

  ```sql
  SELECT Customer.name, saleprice
  FROM Customer LEFT OUTER JOIN Orders ON Customer.custid = Orders.custid;
  ```

    - `OUTER`는 생략 가능 (default)  

<br>

- 부속질의 (subquery, nested query) : SQL 속의 SQL  
  - Example 27 - 가장 비싼 도서의 이름 검색  

  ```sql
  SELECT bookname
  FROM Book
  WHERE price = (SELECT MAX(price) FROM Book);
  ```

  - Example 28 - 도서를 구매한 적이 있는 고객의 이름 검색

  ```sql
  SELECT name
  FROM Customer
  WHERE custid IN (SELECT custid FROM Orders);
  ```

  - Example 29 - `Real Madrid`에서 출판한 도서를 구매한 고객의 이름 검색

  ```sql
  SELECT name
  FROM Customer
  WHERE custid IN (SELECT custid
                   FROM Orders
                    WHERE bookid IN (SELECT bookid
                                      FROM Book
                                      WHERE publisher = 'Real Madrid'));
  ```

  ![visualization_1](TODO)  
  ![visualization_2](TODO)  

  <br>

  - 상관 부속질의(correlated subquery) : 상위 부속질의의 튜플을 이용하여 하위 부속질의를 계산 (correlated)  

  - Example 30 - 출판사별로 출판사의 평균 도서 가격보다 비싼 도서 검색

  ```sql
  SELECT b1.bookname
  FROM Book b1
  WHERE b1.price > (SELECT AVG(b2.price)
                    FROM Book b2
                    WHERE b1.publisher = b2.publisher);
  ```

  ![visualization](TODO)  

<br>

- 집합연산 : `UNION`, `MINUS`, `INTERSECT`  
  - Example 31 - 도서를 주문하지 않은 고객의 이름 검색

  ```sql
  SELECT name
  FROM Customer
  MINUS
  SELECT name
  FROM Customer
  WHERE custid IN (SELECT custid FROM Orders);
  ```

    - Oracle은 차집합을 `MINUS`로 표현하지만, SQL 표준은 `EXCEPT`로 표현

<br>

- `EXISTS` 연산자 : 조건에 맞는 튜플이 존재하면 결과에 포함. 즉, 부속질의문의 어떤 행이 조건에 만족하면 True.  
  - `NOT EXISTS` : 부속질의문의 모든 행이 조건에 만족하지 않을 때만 True.  

- Example 32 - 주문이 있는 고객의 이름과 주소 검색  

```sql
SELECT name, address
FROM Customer cs
WHERE EXISTS (SELECT *
              FROM Orders od
              WHERE cs.custid = od.custid);
```  

![visualization](TODO)  

### 3. 데이터 정의어

<br>

### 4. 데이터 조작어 - 삽입, 수정, 삭제

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 최황규 교수님의 데이터베이스 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/9vmYjQW.png
[def2]: https://i.imgur.com/4Kf65dR.png
[def3]: https://i.imgur.com/UMXiZlL.png