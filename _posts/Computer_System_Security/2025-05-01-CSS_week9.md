---
layout: post
title: "[컴퓨터시스템보안] 9주차 - 침입 탐지"
excerpt: "침입자, 침입의 예, 침입 탐지 시스템(IDS), 호스트 기반 IDS(HIDS), 네트워크 기반 IDS(NIDS), 분산 또는 하이브리드 IDS, 허니팟(Honeypots), SNORT"

tags:
  - [컴퓨터시스템보안]

toc: true

date: 2025-05-01
last_modified_at: 2025-05-04
---
## 침입 탐지
### 1. 침입자 (Intruders)
- 일반적으로 **해커(hacker)** 또는 **크래커(cracker)**를 일컫는 말

- 침입 소스
  - **위장된 사용자**(masquerader)
    - 주로 외부인
    - 합법적인 일반 사용자 계정을 악용하기 위해 침투하는 허가받지 않은 개인
    - 침입의 92%
  - **직권 남용자**(misfeasor)
    - 주로 내부인
    - 권한을 남용하는 합법적인 일반 사용자
    - 침입의 14%
  - **비밀 사용자**(clandestine user)
    - 내부인 혹은 외부인
    - 감사와 접근 제어를 회피하거나 감사 자료 수집을 방해하기 위해 관리 권한을 획득한 개인

  <br>

- 시멘틱과 버라이즌에서는 침입자를 다음과 같이 분류
  - 사이버 범죄자 : 재정적인 보상이 목적
  - 활동가 : 정치적, 사회적 홍보가 목적
  - 국가 후원 기관 : APT 공격을 수행하는 정부 후원 기관
  - 기타 : 개인적인 도전이나 명성을 얻기 위한 목적

  <br>

### 2. 침입의 예
- 침입의 예시
  - 원격으로 이메일 서버의 관리자 권한을 획득
  - 웹 서버의 조작/훼손
  - 패스워드의 추측 및 크랙킹
  - 신용카드 번호를 보관하고 있는 데이터베이스의 복제
  - 허가 없이 월급 기록이나 의료정보 같은 개인 정보를 엿보는 행위
  - 사용자 계정과 패스워드를 알아내기 위해 **패킷 스니퍼**(sniffer)를 실행
  - 해적판 소프트웨어와 음악 파일을 배포하기 위해 익명 FTP 서버에서 permission error를 이용하는 행위
  - 보안이 미빟나 모뎀을 통해 네트워크에 접근하는 행위
  - 임원을 가장하여 이메일 패스워드 등 개인 정보를 안내 데스크에 문의/취득
  - 허락없이 로그인되어 있는 빈 워크스테이션을 이용하는 행위

  <br>

- **침입자 행동 패턴**
  - 공격 대상 포착 및 정보 수집
  - 초기 접속
  - 권한 상승
  - 정보 수집(변경) 또는 시스템 취약점 공격
  - 접근 유지/관리
  - 추적 회피

<br>

### 3. 침입 탐지 시스템 (IDS)
- **보안 침입**(Security Intrusion) : 합법적 권한이 없는 침입자가 시스템이나 시스템 자원에 접근하거나 접근을 시도한 **보안 사고**와 관련된 **하나 이상의 보안 사건(event)을 말함**

- **침입 탐지**(Intrusion Detection) : 시스템 이벤트의 지속적인 감시와 분석을 통해서 시스템 자원에 **불법적인 접근 시도**에 대한 **실시간**, 혹은 **거의 실시간 경고**를 제공하는 보안 서비스

<br>

- **침입 탐지 시스템(IDS)**의 논리적 구성 요소
  - (1) Sensor - 데이터 수집
  - (2) Analyzer - 침입 유무에 대해 판단하고 알려줌
  - (3) User Interface - IDS의 출력 내용을 보거나 시스템의 행동을 제어

<br>

- **침입 탐지 시스템(IDS)**의 분류
  - 호스트 기반 IDS (HIDS)
    - **한 호스트의 특성**과 그 안에서 발생하는 **이벤트**들을 감시하면서 의심스러운 활동을 탐지

  - 네트워크 기반 IDS (NIDS)
    - **네트워크의 특정 부분**에서 관찰되는 네트워크 트래픽을 감시하고,  
    네트워크/트랜스포트/애플리케이션 프로토콜을 분석하여 의심스러운 활동을 탐지

  - 분산 혹은 하이브리드 IDS
    - **센서**들과 **호스트 및 네트워크 기반 IDS**들로부터 오는 정보들을 모두 합쳐 침입 활동을 분석

<br>

- 침입자와 일반 사용자의 행동 프로파일  
![intruder_and_authorized_user][def]  
  - 침입자의 행동은 일반 사용자의 행동과 다른 양상을 보임
  - 그러나 침입자와 일반 사용자 행동의 Overlap되는 부분이 문제가 됨
    - 특히, 직권 남용은 구분이 어려움

    <br>

- **침입 탐지 시스템(IDS)**의 요구사항
  - 지속적인 실행
  - 고장 허용 시스템 (fault tolerant)
  - 자신에 대한 공격자의 파괴 행동 감지
  - 시스템에 가해지는 부하의 최소화
  - 보안정책에 따른 환경 설정이 가능
  - 시스템과 사용자 행동의 변화에 대한 적응
  - 많은 호스트 시스템 모니터링을 위한 확장성 지원
  - 일부 구성 요소가 중단된 경우에도 최소한의 서비스 저하
  - 동적 재설정 기능 제공  

  <br>

- **분석 방법**
  - **이상 탐지**(Anomaly Detection)
    - 오랜 기간 수집된 **정상적인 행동 패턴** 데이터를 이용
    - **통계학적인 테스트**를 가장 많이 사용
      - 지식 기반 방식, 기계 학습 방식도 존재
  
  - **시그니처/휴리스틱 탐지**(Signature/Heuristic Detection)
    - **오용 탐지**(misuse detection)라고도 함
    - **알려진 악성 데이터 패턴**과 공격 규칙의 집합을 사용
    - 패턴의 양이 많을 수록 오류 비율 최소화
    - 확보된 규칙/패턴과 일치하는 공격들만 식별
    - 상대적으로 저렴하지만 시그니처 생성에 많은 노력 필요  

    <br>

### 4. 호스트 기반 IDS (HIDS)
- 취약하거나 민감한 시스템에 **보안 소프트웨어 계층**을 추가

- **이상 탐지** 방식과 **시그니처 탐지** 방식 모두 사용 가능

- 의심스러운 행동을 잡아내기 위해 다양한 방식으로 시스템 활동을 감시
  - 이 방식의 주요 목적
    - **침임의 발견**
    - **의심스러운 이벤트 기록**
    - **관리자에게 경고**

  - 네트워크 기반 IDS나 방화벽과 달리 **외부 침입과 내부 침입** 모두 **감지**  

<br>

- 데이터 소스와 센서
  - 침입 탐지의 핵심 구성요소 중 하나는 데이터를 수집하는 **센서**
  - 일반적인 데이터 소스
    - **System call** 추적
    - **감사(로그 파일)** 기록
    - 중요 파일에 대한 **무결성 checksums**
    - **Registry** 접근

    <br>

- **감사 기록**(Audit Records)
  - 운영체제 감사 기록
    - 대부분의 운영체제는 활동 정보를 수집하는 **회계 소프트웨어**를 제공
    - 장점 : 추가적인 수집 소프트웨어가 필요하지 않음
    - 단점 : 필요한 정보가 없을 수도 있고, 정보가 편리한 방식으로 제공되지 않을 수도 있음 
 
  - 침입 탐지-전용 감사 기록
    - IDS가 필요로 하는 정보만을 포함하는 감사 기록을 생성하도록 정보 수집 장비를 구현
    - 장점 : 시스템 제조사와 독립적, 다양한 시스템에 이식 가능
    - 단점 : 하나의 시스템에 두 회계 소프트웨어를 유지하는 것이 부담

<br>

### 5. 네트워크 기반 IDS (NIDS)
- 네트워크 상의 **선택된 지점**에서 트래픽을 감시
- **실시간** 또는 **실시간에 가까운 속도**로 트래픽 패킷을 분석하여 패턴을 발견
- **네트워크, 트랜스포트, 애플리케이션 프로토콜**의 활동 분석 가능
- 수많은 **센서**, NIDS 관리 기능을 위한 **서버**, UI를 위한 **관리자 콘솔**로 구성
- 침입을 감지하기 위한 **트래픽 패턴 분석**은 **센서**에서, **관리 서버**에서, 또는 두 곳 모두에서 수행 가능  

<br>

- **NIDS 센서 배치 모드**
  - **인라인(inline) 센서** 모드
    - 네트워크 **센서를 직접 통과하는 트래픽**만 감지
    - 공격 감지 시, 즉시 트래픽 차단 가능

  - **수동(passive) 센서** 모드  
  ![passive][def2]
    - 네트워크 **트래픽의 복사본**을 감시. 실제 트래픽을 센서를 통과하지 X
    - 더 효율적이고 널리 사용되는 방식  

- NIDS에서 센서를 배치 가능한 위치  
![sensor_location][def3]  
  - 위치 1 - **외부 방화벽의 바로 안쪽**
    - 네트워크 주변 방어막을 뚫고 들어오는 외부 공격 감지 가능
    - 네트워크 방화벽 정책이나 성능에 관한 문제가 드러남
    - 웹 서버나 FTP 서버 등을 공격하는 트래픽 감지 가능
    - 내부의 감염된 서버로부터 외부로 나가는 트래픽을 종종 인식

  - 위치 2 - **외부 방화벽과 인터넷orWAN 사이**
    - 모든 네트워크 트래픽을 여과 없이 감시 가능
    - 인터넷에서 조직의 네트워크를 노리는 공격의 **횟수**와 **종류**를 기록할 수 있음

  - 위치 3 - 위치 1or2의 센서에 추가하여 내부 서버나 데이터베이스에 연결된 **주 backbone**을 보호하기 위해 **내부 방화벽과 하나 이상의 센서를 설치**  
    - 많은 양의 네트워크 트래픽을 감시하여 감지 확률을 높임
    - 조직의 보안 경계 **내부**의 악의적 행동을 감지 가능

  - 위치 4 - 모든 네트워크가 아닌, **사적인 or 금융 관련 네트워크 같은 중요 부분 시스템만 보호**
    - **중요한 시스템이나 자원**을 목표로 하는 공격 감지 가능
    - 가장 중요한 네트워크 자산에 **제한된 자원을 집중** 가능  

    <br>

- **NIDS의 침입 탐지 기법**
  - **시그니처 탐지**에 적합한 공격 유형
    - 애플리케이션 계층 정찰과 공격
    - 트랜스포트 계층 정찰과 공격
    - 네트워크 계층 정찰과 공격
    - 예기치 못한 응용프로그램 서비스
    - 정책 위반(부적적한 웹 사이트, 금지된 응용 프로토콜 사용)

  - **Anomaly 탐지**에 적합한 공격 유형
    - 서비스 거부 공격 (DoS)
    - 스캐닝
    - 웜

    <br>

- **경고 및 로깅**
  - 센서가 잠재적인 위반을 감지하면, **경고**를 전송하고 해당 이벤트와 관련된 정보를 **로깅**
  - NIDS 서버가 기록하는 전형적인 로깅 정보
    - 타임 스탬프
    - 연결 or 세션 ID
    - 이벤트 or 경고 종류
    - etc.

    <br>

### 6. 분산 또는 하이브리드 IDS
- 서로 통신하고 협력하는 **분산형 IDS**
  - 지역 노드에 있는 탐지기가 **비정상적인 활동의 증거** 탐지
  - 지역 노드들이 **의심스러운 공격의 확률 형태로 서로 정보를 교환**하는 **peer-to-peer gossip** 프로토콜 사용

- Intel의 자동화된 전사적 보안 시스템 구조  
![intel][def4]  
  - 각 호스트or네트워크 디바이스에 센서SW를 설치하여 센서로 동작
    - 분산 센서들이 **정보를 교환**하여 공격 여부를 판단

<br>

- IETF Intrusion Detection Working Group
  - 활동 목적 : **침입 탐지** 및 **대응 시스템**, 그리고 이들과 상호작용하는 **관리 시스템** 간 정보를 교환하는데 필요한 **프로토콜 정의**  

<br>

### 7. 허니팟 (Honeypots)
- 공격자를 **유인하기 위한 의도된 거짓 시스템**
  - 공격자를 중요한 시스템에 접근하지 못하게 유인
  - 공격자의 행동 패턴에 대한 정보 수집
  - 공격자가 가능한 오래 머물도록 하여, 필요한 대응을 준비

- 중요해 보이지만 조작된 정보로 채워져 있음

- 실제로 가치를 갖지 않는 리소스
  - 허니팟과의 모든 통신 시도는 공격일 가능성이 매우 높음
  - 허니팟이 외부로 통신을 시도하면, 이미 시스템음 감염된 것
  - 초기에는 선택된 IP 주소를 갖는 하나의 **허니팟 컴퓨터**를 사용  
  최근에는 기업체의 시스템을 흉내 내는 **허니팟 네트워크**를 실제와 유사하게 구성  

  <br>

- 허니팟의 종류
  - 낮은 상호작용(low interaction) 허니팟
    - **실제 시스템의 초기 상호작용**을 **모방**하는 소프트웨어
    - 실제 공격 목표 시스템에는 미치지 못함
    - 임박한 공격을 경고하기 위해 **분산형 IDS**의 구성요소로 사용 가능

  - 높은 상호작용(high interaction) 허니팟
    - **실제 시스템**으로 공격자가 접근 가능한 위치에 배치되어 공격을 관측
    - 공격자가 장기간 머물게 될 정도로 실제 시스템과 유사
    - 많은 리소스 소모가 단점
    - 만약 허니팟이 감염되면 다른 시스템 공격에 악용될 수도 있음  

    <br>

- 허니팟 설치 위치  
![honey_pot_example][def5]
  - 위치 1 - **외부 방화벽 밖**
    - 실제로는 쓰지 않는 IP 주소로의 접근 시도 추적에 유용
    - 내부 네트워크의 위험을 증가시키지 않음
    - 많은 공격자를 유인하므로, 관리 부하를 줄임
    - 단점 : 내부자 공격을 다룰 수 없음

  - 위치 2 - **웹/메일 서버 등이 있는 외부에서 접근 가능한 DMZ 네트워크**
    - 보안 관리자는 DMZ의 다른 시스템을 보호해야 함
    - 단점 : DMZ 내 허니팟으로의 트래픽을 허용하기 위해 필터링을 해제해야 하므로, 보안 위험이 증가하고 허니팟 효과가 감소

  - 위치 3 - **내부 허니팟**
    - 장점 : **내부 공격 탐지**, 외부 트래픽을 잘못 들여보내는 **방화벽의 실수**를 잡아냄
    - 단점 : 허니팟이 감염되면 다른 내부 시스템이 위험, 허니팟 트래픽 허용을 위해 규칙 수정 필요 -> 잠재적 위험 증가  

    <br>

### 8. IDS 예제 시스템: 스노트(SNORT)  
![snort][def6]
- 경량의 IDS - 오픈 소스 & 이식 가능한 **호스트 or 네트워크 기반 IDS**
  - 실시간 패킷 캡쳐, 규칙 분석
  - 대부분의 노드에 쉽게 설치 가능
  - 적은 메모리와 프로세서 사용
  - 짧은 시간에 원하는 보안 대책 구현 가능

  <br>

- 스노트 규칙 - 행동(Action)

|행동|설명|
|:---:|:---:|
|Alert|지정된 경고 방법으로 경고 생성, 패킷 기록|
|Log|패킷 기록|
|Pass|패킷 무시|
|Activate|경고 후 또 다른 동적 규칙 활성화|
|Dynamic|활성화 규칙에 의해 활성화 될 때 까지 대기|
|Drop|패킷 드롭, 패킷 기록|
|Reject|패킷 드롭, 패킷 기록, TCP reset 전송 / ICMP unreachable 전송|
|sdrop|패킷 드롭, 패킷 기록은 X|

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 이헌길 교수님의 컴퓨터시스템보안 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/rUZ87P7.png
[def2]: https://i.imgur.com/Y4YWaus.png
[def3]: https://i.imgur.com/nwUhn1h.png
[def4]: https://i.imgur.com/ftUFlP4.png
[def5]: https://i.imgur.com/5BPm7ew.png
[def6]: https://i.imgur.com/GuZjLrt.png