---
layout: post
title: "[컴퓨터시스템보안] 9주차 - 방화벽과 침입 방지 시스템"
excerpt: "방화벽의 필요성, 방화벽의 특징, 방화벽의 종류, 방화벽 기반과 Bastion Host, 방화벽의 위치와 구조, 침입 방지 시스템, 예제: 통합 위협 관리 제품"

tags:
  - [컴퓨터시스템보안]

toc: true

date: 2025-05-08
last_modified_at: 2025-05-12
---
## 방화벽과 침입 방지 시스템
### 1. 방화벽의 필요성
- **인터넷 연결**은 필수.
  - 그러나 인터넷 연결로 인한 취약점 발생 가능
  - LAN 환경을 보호하는 효과적인 방법이 필요

- **방화벽(firewall)은 내부 네트워크와 인터넷 사이에 삽입되어 제어된 링크를 형성해주며, 외부 보안벽을 강화

- 추가적인 방어 계층을 형성함으로써 주변으로부터의 방어에 이용  
![firewall][def]
  - 인터넷 기반 공격으로부터 방어하고, 보안 및 감시에 이용하는 **choke point(관문)** 역할 수행
  - 외부 네트워크(Internet)로부터 내부 네트워크(LAN)를 보호 -> **심층 방어(Defense in Depth)**

<br>

### 2. 방화벽의 특징
- 설계 목표
  - 외부에서 내부로의, 내부에서 외부로의 **모든 트래픽이 방화벽을 통과**하도록 설계
  - 내부 보안 정책에 의해 **인증된 트래픽만 통과**하도록 설계
  - 방화벽 자체가 **침투하기 어려운 시스템**이도록 설계

  <br>

- 방화벽 접근 정책
  - 방화벽 시스템을 기획/구현할 때 **접근 정책**을 명시해야 함
    - 방화벽을 통과하도록 **허용할 트래픽 유형** 명시
    - 트래픽 유형 : Address range, Protocol, Application, Content type, ...

  - 접근 정책은 해당 기관의 **정책 가이드라인**을 참조해야 함
  - 또한, 접근 정책은 해당 기관이 지원해야 할 **트래픽 유형**에 기반하여 설계되어야 함
  - 필터링 요소를 세밀하게 정의한 후 적절한 방화벽 토폴로지 내에서 구현  

  <br>

- 방화벽의 기능과 한계
  - **기능**
    - **choke point** 형성
    - 보안 관련 **이벤트 감시**
    - **IPSec**을 위한 플랫폼 제공
    - 보안과 관련 없는 **인터넷 기능 구현**을 위한 플랫폼

  <br>

  - **한계**
    - 방화벽을 **우회하는 공격**으로부터 보호 불가능
    - **내부 공격자**로부터 완전하게 보호할 수 없음
    - 보안이 불안전한 **무선 LAN**을 통해 접근할 수도 있음
    - **감염된 장치**가 내부 네트워크에 연결될 수 있음

  <br>

### 3. 방화벽의 종류
![firewall types][def2]
  - **패킷 필터링 방화벽** (Packet Filtering Firewall)
    - 들어오고 나가는 **각 IP 패킷**에 규칙을 적용
      - **IP** 또는 **TCP 헤더** 매칭에 기반한 **규칙 리스트** (source/destination IP, port, protocol)
      - 규칙 매치를 기반으로 패킷 전송을 **허용**하거나 **거부**
    - default policy에 따라 **허용** 또는 **거부** (default policy는 보안 정책에 따라 다름)
    - 장점
      - 단순하고, 빠르다
    - 단점
      - 상위 계층 데이터를 검사하지 않아, 특정 응용프로그램의 취약점이나 기능을 이용한 공격을 막지 못함
      - 로깅 기능이 제한적임
      - 고급 사용자 인증 방식을 지원하지 않음
      - TCP/IP 프로토콜 버그에 취약
      - 설정 실수로 인해 거부되어야 할 트래픽이 허용될 수 있음

  - **상태 기반 방화벽** (Stateful Inspection Firewall)
    - 아웃바운드 **TCP 연결 디렉토리**를 유지하면서 더 엄격한 규칙 필터링을 적용
      - **설정된 연결 마다** 하나의 항목 생성
      - 패킷 필터는 디렉터리에서 일치하는 항목이 있는 트래픽만 허용
    - 패킷 정보를 검사할 뿐만 아니라, 추가로 **TCP 연결에 관한 정보를 기록**
      - 패킷 하이재킹을 방지하기 위해 **TCP 시퀀스 넘버를 기록**
      - 특정 프로토콜의 데이터 일부를 검사하여 **연관된 연결**을 알아내고 추적

  - **애플리케이션 프록시 방화벽** (Application Proxy Firewall)
    - 애플리케이션의 **트래픽을 중계**하는 역할
      - 사용자가 TCP/IP 응용 프로그램으로 요청을 보내면, **ID와 인증 정보**로 인증 후 게이트웨이는 데이터를 중계
    - 각 응용 프로그램에 대한 **프록시 코드**가 있어야 함
      - 게이트웨이는 안전하다고 생각되는 특정 기능만 허용
    - 장점 : 패킷 필터 방화벽보다 더 안전함
    - 단점 : 각 연결에 대한 추가 처리 오버헤드
  
  - **서킷 레벨 프록시 방화벽** (Circuit Level Proxy Firewall)
    - **두 개의 TCP 연결**을 설정 : 자신과 내부 시스템 + 자신과 외부 시스템
    - 두 연결이 생성되면, 게이트웨이는 내용을 분석하지 않고 **TCP segments**를 중계
    - 보안 기능은 **어떤 연결을 허용할 지**를 결정
    - 주로 시스템 관리자가 **내부 사용자를 신뢰할 때** 사용

    <br>

### 4. 방화벽 기반과 Bastion Host
- **배스쳔 호스트(Bastion Host)**
  - **애플리케이션 레벨** 혹은 **서킷 레벨** 게이트웨이를 제공하는 플랫폼
  - 특징
    - **보안이 강화된 OS**를 실행; **필수적인 서비스**(DNS, FTP, HTTP 등의 proxy application)만 설치
    - 배스쳔 호스트에서 제공하는 프록시 서비스를 사용하려면 **추가적인 사용자 인증 절차** 필요
    - 각 프록시 서비스는 각 응용 프로그램의 기능 중 **일부만 지원**
    - 각 프록시 서비스는 **특정 호스트에만 접속**하도록 설정
    - 각 프록시 서비스는 모든 연결을 **로깅**하고 **감사 정보를 유지**
    - 각 프록시 모듈은 네트워크 **보안을 위한 작은 SW 패키지**
    - 각 프록시 서비스는 서로 독립적
    - 일반적으로 프록시는 부팅 시 외에 **디스크를 사용하지 않음**
    - 각 **프록시**는 배스쳔 호스트 내 **private하고 안전한 디렉토리**에서 **nonprivilgedged** 사용자로 실행  

    <br>

- **호스트 기반 방화벽**
  - 각각의 **개별 호스트**를 보호하는데 사용하는 **SW 모듈**
  - 방화벽 SW 모듈은 운영체제 자체에서 제공하거나 별도의 애드온 패키지로 제공
  - 패킷의 흐름을 필터링하고 제한
  - 일반적으로 **서버**에 설치
  - 필터링 규칙을 **호스트 환경에 맞게** 설정 가능

<br>

- **개인용 방화벽**
  - **개인 컴퓨터/워크스테이션**과 인터넷/기업 네트워크 간의 트래픽을 제어
  - 가정에서도 사용 가능
  - 일반적으로 **개인 컴퓨터의 소프트웨어 모듈**로 제공됨
  - 홈 네트워크의 **라우터**에 설치하여 사용 가능
  - 일반적으로 훨씬 덜 복잡함
  - 주요 역할
    - **허가되지 않은 외부 접근 차단**
    - **외부로 나가는 트래픽 모니터링**

    <br>

### 5. 방화벽의 위치와 구조
- 배스쳔 호스트, 호스트 기반 방화벽, 개인용 방화벽을 조합하여 **분산 방화벽** 구조를 형성할 수 있다.  
![distributed_firewall_structure][def3]  

<br>

### 6. 침입 방지 시스템
- 침입 방지 시스템(IPS, Intrusion Prevention System)
  - IDS의 확장이며, 악의적인 활동을 **차단하거나 방지하는** 기능을 추가한 시스템
  - 호스트 기반, 네트워크 기반, 또는 분산/하이브리드 방식으로 구현 가능
  - **이상 탐지 방식**과 **시그니처/휴리스틱 탐지 방식** 모두 사용 가능
  - IPS는 방화벽처럼 트래픽을 차단할 수 있지만, **차단 방식은 IDS를 위해 개발된 알고리즘**을 사용

  <br>

- **호스트 기반 IPS** (HIPS)  
  - **악성 탐지 방식**과 **시그니처/휴리스틱 탐지 방식** 모두 사용 가능
    - 추가로 **sandbox 방식**도 사용 -> 주로 **모바일 코드**에 사용 (격리된 시스템 영역에서 실행, 감시)  
  - HIPS가 다루는 악성 행동 패턴 Example
    - **시스템 리소스 변경**
    - **권한 상승 공격**(Privilege Escalation)
    - **버퍼 오버플로우 공격**(Buffer Overflow)
    - **이메일 주소록 접근**
    - **디렉토리 탐색**
  - HIPS가 desktop 보호를 제공하는 분야
    - System call
    - File system access
    - System registry settings
    - Host input/output
  - 보안 기능들을 **통합된 하나의 제품**으로 제공
  - **Endpoint** 보안 역할을 수행 (점차 중요해지는 중)  

  <br>

- **네트워크 기반 IPS** (NIPS)
  - NIPS는 **패킷의 수정/폐기와 TCP 연결 차단의 권한**을 갖고 있는 **inline NIDS**  
  - **악성 탐지 방식**과 **시그니처/휴리스틱 탐지 방식** 모두 사용 가능
  - 방화벽에서는 흔히 볼 수 없는 **flow data protection** 기능을 제공
    - **패킷**들에 분산된 application payload가 **재조립**되어 복구되어야 함
  - 악성 패킷 감지 방법
    - **Pattern matching** : 알려진 시그니처 감지
    - **Stateful matching** : 패킷이 아닌 트래픽 스트림에서 시그니처 감지
    - **Protocol anomaly** : RFC 표준과 다른 변형된 형태 감지
    - **Traffic anomaly** : 비정상적인 트래픽 패턴 감지
    - **Statistical anomaly** : 정상적인 트래픽/throughput과 다른 패턴 감지  

    <br>

- **분산 또는 하이브리드 IPS**
  - 악성 코드의 악의적인 행동에 대한 포괄적인 방어 시스템
  - 개발 동기 : 인터넷 기반 악성 코드 위협의 증가, 전파 속도의 상승, 전반적인 상황 파악 필요성
  - 창의적인 악성 코드 유형을 탐지하는 분석 성능이 중요
  - Example - 웜 모니터  
  ![worm_monitor][def4]  

<br>

- **Snort Inline**
  - Snort는 경량의 침입 탐지 시스템
  - **Snort Inline**은 **Snort에 침입 방지 기능**을 추가한 것
  - Snort Inline은 사용자가 패킷을 수정할 수 있도록 **replace 옵션**을 제공
    - **honeypot** 구현에 유용 (by replacing)
    - 공격자는 실패는 알 수 있어도 이유를 알 수 없음  

    <br>

### 7. 예제: 통합 위협 관리 제품  
![UTM][def5]  
  - (1) 도착한 트래픽은 우선 **복호화** 수행.
  - (2) **방화벽 모듈**에서 규칙에 따라 **패킷 필터링** 수행
  - (3) **데이터 분석 엔진**이 패킷 플로우 분석
  - (4) 데이터 분석 엔진은 **multipacket payload 재조립**
  - (5) 일부는 네트워크 내부 플로우 보안을 위해 **재 암호화**
  - (6) 탐지된 모든 위협은 **logging and reporting module**에 보고, alert 발생
  - (7) **Bacdwidth shaping module**은 성능 최적화를 위해 우선순위 / 서비스 품질(QoS) 알고리즘 사용  

<br>
<br>
<br>
<br>
<details>
<summary>주의사항</summary>
<div markdown="1">

이 포스팅은 강원대학교 이헌길 교수님의 컴퓨터시스템보안 수업을 들으며 내용을 정리 한 것입니다.  
수업 내용에 대한 저작권은 교수님께 있으니,  
다른 곳으로의 무분별한 내용 복사를 자제해 주세요.

</div>
</details>

[def]: https://i.imgur.com/bFapDDD.png
[def2]: https://i.imgur.com/E8YuRLF.png
[def3]: https://i.imgur.com/hSxmtUU.png
[def4]: https://i.imgur.com/nNJ3S84.png
[def5]: https://i.imgur.com/z22Bw57.png